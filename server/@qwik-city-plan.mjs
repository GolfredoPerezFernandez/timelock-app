import{c as te,i as g,u as b,b as Se,d as e,e as d,S as Me,f as w,g as P,h as y,r as V,j as X,k as Xe,l as a,L as be,m as we,n as A,o as O,s as Ne,p as $e,q as Y,F as ee,z as ne,t as ce,w as Kt,x as We}from"./q-BYK0silP.js";import{createClient as Fe}from"@libsql/client";import{PDFDocument as Xt,StandardFonts as el,rgb as tl}from"pdf-lib";import et from"path";import Ye from"fs";import{readFile as ll,mkdir as tt,writeFile as qe}from"node:fs/promises";import Re,{join as De}from"node:path";import{randomBytes as lt}from"node:crypto";import{z as U}from"zod";import{DateTime as sl}from"luxon";import{createPublicClient as al,http as nl}from"viem";import{base as Ve}from"viem/chains";const rl=()=>{const t=b(!1);return Se(w("s_kMIkvtDqkEU",[t])),e("div",null,{class:"min-h-screen flex flex-col items-center justify-center transition-colors duration-300 bg-transparent",style:{paddingTop:"calc(env(safe-area-inset-top))"}},[e("div",null,{class:"fixed inset-0 pointer-events-none overflow-hidden opacity-40"},[e("div",null,{class:"w-20 h-20 bg-teal-500/20 rounded-full absolute top-[10%] left-[15%] animate-[float_15s_infinite]"},null,3,null),e("div",null,{class:"w-32 h-32 bg-slate-500/20 rounded-full absolute top-[30%] left-[65%] animate-[float_18s_infinite]",style:"animation-delay: 0.5s;"},null,3,null),e("div",null,{class:"w-16 h-16 bg-amber-400/20 rounded-full absolute top-[70%] left-[25%] animate-[float_12s_infinite]",style:"animation-delay: 1s;"},null,3,null)],3,null),e("div",null,{class:"pt-safe"},d(Me,null,3,"GY_0"),1,null),e("style",null,null,`
        @keyframes float {
          0% { transform: translate(0, 0); }
          25% { transform: translate(5px, -15px); }
          50% { transform: translate(10px, 0); }
          75% { transform: translate(5px, 15px); }
          100% { transform: translate(0, 0); }
        }
        @keyframes pulse {
          0%, 100% { opacity: 0.5; transform: scale(1); }
          50% { opacity: 1; transform: scale(1.05); }
        }
      `,3,null)],1,"GY_1")},ol=te(g(rl,"s_9ToU0mvTu94")),il=Object.freeze(Object.defineProperty({__proto__:null,default:ol},Symbol.toStringTag,{value:"Module"})),H=async t=>{var i,o;const l=(i=t.cookie.get("auth_token"))==null?void 0:i.value,s=(o=t.cookie.get("user_type"))==null?void 0:o.value;if(!l||!s)return{isAuthenticated:!1,userId:null,role:null,is_admin:!1,email:null};let n=!1,r=s;try{const m=await Fe({url:t.env.get("PRIVATE_TURSO_DATABASE_URL"),authToken:t.env.get("PRIVATE_TURSO_AUTH_TOKEN")}).execute({sql:"SELECT email, type FROM users WHERE id = ?",args:[l]});if(m.rows.length===0)return Be(t),{isAuthenticated:!1,userId:null,role:null,is_admin:!1,email:null};const c=m.rows[0];return c.email==="admin@gmail.com"?(n=!0,r="admin"):(n=!1,(s==="admin"||s==="super_admin")&&(r="freelancer")),{isAuthenticated:!0,userId:l,role:r,is_admin:n,email:c.email??null}}catch(u){return console.error("Session validation DB error:",u),{isAuthenticated:!1,userId:null,role:null,is_admin:!1,email:null}}};function st(t){return new TextEncoder().encode(t).buffer}function _e(t){return Array.from(new Uint8Array(t)).map(l=>l.toString(16).padStart(2,"0")).join("")}async function ul(t){const l=st(t),s=crypto.getRandomValues(new Uint8Array(16)),n=await crypto.subtle.importKey("raw",l,{name:"PBKDF2"},!1,["deriveBits"]),r=await crypto.subtle.deriveBits({name:"PBKDF2",salt:s,iterations:1e5,hash:"SHA-256"},n,256),i=new Uint8Array(s.length+32);i.set(s),i.set(new Uint8Array(r),s.length);const o=_e(i.buffer);return console.log("[hashPassword] password:",t),console.log("[hashPassword] salt:",_e(s.buffer)),console.log("[hashPassword] derivedKey:",_e(r)),console.log("[hashPassword] combined hex:",o),o}async function dl(t,l){const s=new Uint8Array(l.match(/.{1,2}/g).map(p=>parseInt(p,16))),n=s.slice(0,16),r=s.slice(16),i=st(t),o=await crypto.subtle.importKey("raw",i,{name:"PBKDF2"},!1,["deriveBits"]),u=await crypto.subtle.deriveBits({name:"PBKDF2",salt:n,iterations:1e5,hash:"SHA-256"},o,256),m=_e(u),c=_e(r.buffer);return console.log("[verifyPassword] password:",t),console.log("[verifyPassword] salt:",_e(n.buffer)),console.log("[verifyPassword] derivedKey:",m),console.log("[verifyPassword] storedKey:",c),m===c}const at=(t,l,s)=>{const n=String(l),r={path:"/",httpOnly:!0,sameSite:"strict",secure:t.url.protocol==="https:",maxAge:3600};t.cookie.set("auth_token",n,r),t.cookie.set("user_type",s,r)},Be=t=>{const l={path:"/"};t.cookie.delete("auth_token",l),t.cookie.delete("user_type",l)},cl=t=>P("svg",{...t,children:[e("circle",null,{cx:"12",cy:"12",r:"10"},null,3,null),e("line",null,{x1:"12",x2:"12",y1:"8",y2:"12"},null,3,null),e("line",null,{x1:"12",x2:"12.01",y1:"16",y2:"16"},null,3,null)]},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"Ui_0"),ae=t=>P("svg",{...t,children:[e("path",null,{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"},null,3,null),e("path",null,{d:"M12 9v4"},null,3,null),e("path",null,{d:"M12 17h.01"},null,3,null)]},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"zY_0"),Qe=t=>P("svg",{...t,children:[e("path",null,{d:"m12 19-7-7 7-7"},null,3,null),e("path",null,{d:"M19 12H5"},null,3,null)]},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"VY_0"),Ee=t=>P("svg",{...t,children:[e("rect",null,{height:"14",rx:"2",ry:"2",width:"20",x:"2",y:"7"},null,3,null),e("path",null,{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"},null,3,null)]},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"sZ_0"),ml=t=>P("svg",{...t,children:[e("rect",null,{height:"20",rx:"2",ry:"2",width:"16",x:"4",y:"2"},null,3,null),e("path",null,{d:"M9 22v-4h6v4"},null,3,null),e("path",null,{d:"M8 6h.01"},null,3,null),e("path",null,{d:"M16 6h.01"},null,3,null),e("path",null,{d:"M12 6h.01"},null,3,null),e("path",null,{d:"M12 10h.01"},null,3,null),e("path",null,{d:"M12 14h.01"},null,3,null),e("path",null,{d:"M16 10h.01"},null,3,null),e("path",null,{d:"M16 14h.01"},null,3,null),e("path",null,{d:"M8 10h.01"},null,3,null),e("path",null,{d:"M8 14h.01"},null,3,null)]},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"t9_0"),nt=t=>P("svg",{...t,children:[e("rect",null,{height:"18",rx:"2",ry:"2",width:"18",x:"3",y:"4"},null,3,null),e("line",null,{x1:"16",x2:"16",y1:"2",y2:"6"},null,3,null),e("line",null,{x1:"8",x2:"8",y1:"2",y2:"6"},null,3,null),e("line",null,{x1:"3",x2:"21",y1:"10",y2:"10"},null,3,null)]},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"34_0"),Ge=t=>P("svg",{...t,children:[e("path",null,{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"},null,3,null),e("polyline",null,{points:"22 4 12 14.01 9 11.01"},null,3,null)]},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"Jy_0"),rt=t=>P("svg",{...t,children:e("path",null,{d:"m15 18-6-6 6-6"},null,3,null)},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"5O_0"),ot=t=>P("svg",{...t,children:e("path",null,{d:"m9 18 6-6-6-6"},null,3,null)},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"Rc_0"),it=t=>P("svg",{...t,children:[e("circle",null,{cx:"12",cy:"12",r:"10"},null,3,null),e("polyline",null,{points:"12 6 12 12 16 14"},null,3,null)]},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"PM_0"),pl=t=>P("svg",{...t,children:[e("rect",null,{height:"14",rx:"2",width:"20",x:"2",y:"5"},null,3,null),e("line",null,{x1:"2",x2:"22",y1:"10",y2:"10"},null,3,null)]},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"UR_0"),ut=t=>P("svg",{...t,children:[e("line",null,{x1:"12",x2:"12",y1:"2",y2:"22"},null,3,null),e("path",null,{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"},null,3,null)]},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"0T_0"),fl=t=>P("svg",{...t,children:[e("path",null,{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"},null,3,null),e("polyline",null,{points:"7 10 12 15 17 10"},null,3,null),e("line",null,{x1:"12",x2:"12",y1:"15",y2:"3"},null,3,null)]},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"f4_0"),dt=t=>P("svg",{...t,children:[e("path",null,{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"},null,3,null),e("polyline",null,{points:"15 3 21 3 21 9"},null,3,null),e("line",null,{x1:"10",x2:"21",y1:"14",y2:"3"},null,3,null)]},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"Oq_0"),Ce=t=>P("svg",{...t,children:[e("path",null,{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"},null,3,null),e("circle",null,{cx:"12",cy:"12",r:"3"},null,3,null)]},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"jA_0"),he=t=>P("svg",{...t,children:[e("path",null,{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"},null,3,null),e("polyline",null,{points:"14 2 14 8 20 8"},null,3,null),e("line",null,{x1:"16",x2:"8",y1:"13",y2:"13"},null,3,null),e("line",null,{x1:"16",x2:"8",y1:"17",y2:"17"},null,3,null),e("line",null,{x1:"10",x2:"8",y1:"9",y2:"9"},null,3,null)]},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"gd_0"),ct=t=>P("svg",{...t,children:[e("path",null,{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"},null,3,null),e("polyline",null,{points:"14 2 14 8 20 8"},null,3,null),e("path",null,{d:"M12 12v6"},null,3,null),e("path",null,{d:"m15 15-3-3-3 3"},null,3,null)]},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"Wk_0"),xl=t=>P("svg",{...t,children:e("polygon",null,{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"},null,3,null)},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"bo_0"),Ze=t=>P("svg",{...t,children:[e("circle",null,{cx:"7.5",cy:"15.5",r:"5.5"},null,3,null),e("path",null,{d:"m21 2-9.6 9.6"},null,3,null),e("path",null,{d:"m15.5 7.5 3 3L22 7l-3-3"},null,3,null)]},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"Wf_0"),oe=t=>P("svg",{...t,children:e("path",null,{d:"M21 12a9 9 0 1 1-6.219-8.56"},null,3,null)},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"nT_0"),Ie=t=>P("svg",{...t,children:[e("line",null,{x1:"12",x2:"12",y1:"2",y2:"6"},null,3,null),e("line",null,{x1:"12",x2:"12",y1:"18",y2:"22"},null,3,null),e("line",null,{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76"},null,3,null),e("line",null,{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07"},null,3,null),e("line",null,{x1:"2",x2:"6",y1:"12",y2:"12"},null,3,null),e("line",null,{x1:"18",x2:"22",y1:"12",y2:"12"},null,3,null),e("line",null,{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24"},null,3,null),e("line",null,{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93"},null,3,null)]},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"kT_0"),Oe=t=>P("svg",{...t,children:[e("rect",null,{height:"11",rx:"2",ry:"2",width:"18",x:"3",y:"11"},null,3,null),e("path",null,{d:"M7 11V7a5 5 0 0 1 10 0v4"},null,3,null)]},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"WS_0"),mt=t=>P("svg",{...t,children:[e("path",null,{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"},null,3,null),e("polyline",null,{points:"16 17 21 12 16 7"},null,3,null),e("line",null,{x1:"21",x2:"9",y1:"12",y2:"12"},null,3,null)]},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"0h_0"),gl=t=>P("svg",{...t,children:[e("rect",null,{height:"16",rx:"2",width:"20",x:"2",y:"4"},null,3,null),e("path",null,{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"},null,3,null)]},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"n4_0"),bl=t=>P("svg",{...t,children:[e("line",null,{x1:"4",x2:"20",y1:"12",y2:"12"},null,3,null),e("line",null,{x1:"4",x2:"20",y1:"6",y2:"6"},null,3,null),e("line",null,{x1:"4",x2:"20",y1:"18",y2:"18"},null,3,null)]},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"f1_0"),hl=t=>P("svg",{...t,children:e("path",null,{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"},null,3,null)},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"Oe_0"),vl=t=>P("svg",{...t,children:[e("circle",null,{cx:"13.5",cy:"6.5",r:".5"},null,3,null),e("circle",null,{cx:"17.5",cy:"10.5",r:".5"},null,3,null),e("circle",null,{cx:"8.5",cy:"7.5",r:".5"},null,3,null),e("circle",null,{cx:"6.5",cy:"12.5",r:".5"},null,3,null),e("path",null,{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z"},null,3,null)]},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"60_0"),Pe=t=>P("svg",{...t,children:[e("path",null,{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"},null,3,null),e("path",null,{d:"m15 5 4 4"},null,3,null)]},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"eG_0"),wl=t=>P("svg",{...t,children:[e("path",null,{d:"M21.21 15.89A10 10 0 1 1 8 2.83"},null,3,null),e("path",null,{d:"M22 12A10 10 0 0 0 12 2v10z"},null,3,null)]},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"HH_0"),Ae=t=>P("svg",{...t,children:[e("path",null,{d:"M5 12h14"},null,3,null),e("path",null,{d:"M12 5v14"},null,3,null)]},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"Z7_0"),kl=t=>P("svg",{...t,children:[e("path",null,{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"},null,3,null),e("path",null,{d:"M3 3v5h5"},null,3,null),e("path",null,{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"},null,3,null),e("path",null,{d:"M16 16h5v5"},null,3,null)]},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"CE_0"),Te=t=>P("svg",{...t,children:[e("path",null,{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"},null,3,null),e("polyline",null,{points:"17 21 17 13 7 13 7 21"},null,3,null),e("polyline",null,{points:"7 3 7 8 15 8"},null,3,null)]},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"Jw_0"),ze=t=>P("svg",{...t,children:[e("circle",null,{cx:"11",cy:"11",r:"8"},null,3,null),e("path",null,{d:"m21 21-4.3-4.3"},null,3,null)]},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"OE_0"),yl=t=>P("svg",{...t,children:[e("path",null,{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"},null,3,null),e("circle",null,{cx:"12",cy:"12",r:"3"},null,3,null)]},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"xG_0"),_l=t=>P("svg",{...t,children:[e("path",null,{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"},null,3,null),e("path",null,{d:"m9 12 2 2 4-4"},null,3,null)]},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"oN_0"),Tl=t=>P("svg",{...t,children:[e("path",null,{d:"M19.7 14a6.9 6.9 0 0 0 .3-2V5l-8-3-3.2 1.2"},null,3,null),e("path",null,{d:"m2 2 20 20"},null,3,null),e("path",null,{d:"M4.7 4.7 4 5v7c0 6 8 10 8 10a20.3 20.3 0 0 0 5.62-4.38"},null,3,null)]},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"Ij_0"),Sl=t=>P("svg",{...t,children:[e("circle",null,{cx:"12",cy:"12",r:"4"},null,3,null),e("path",null,{d:"M12 2v2"},null,3,null),e("path",null,{d:"M12 20v2"},null,3,null),e("path",null,{d:"m4.93 4.93 1.41 1.41"},null,3,null),e("path",null,{d:"m17.66 17.66 1.41 1.41"},null,3,null),e("path",null,{d:"M2 12h2"},null,3,null),e("path",null,{d:"M20 12h2"},null,3,null),e("path",null,{d:"m6.34 17.66-1.41 1.41"},null,3,null),e("path",null,{d:"m19.07 4.93-1.41 1.41"},null,3,null)]},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"Qm_0"),ke=t=>P("svg",{...t,children:[e("path",null,{d:"M3 6h18"},null,3,null),e("path",null,{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"},null,3,null),e("path",null,{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"},null,3,null),e("line",null,{x1:"10",x2:"10",y1:"11",y2:"17"},null,3,null),e("line",null,{x1:"14",x2:"14",y1:"11",y2:"17"},null,3,null)]},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"Eb_0"),ye=t=>P("svg",{...t,children:[e("path",null,{d:"M3 6h18"},null,3,null),e("path",null,{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"},null,3,null),e("path",null,{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"},null,3,null)]},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"St_0"),El=t=>P("svg",{...t,children:[e("path",null,{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"},null,3,null),e("circle",null,{cx:"12",cy:"7",r:"4"},null,3,null)]},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"sX_0"),ve=t=>P("svg",{...t,children:[e("path",null,{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"},null,3,null),e("circle",null,{cx:"9",cy:"7",r:"4"},null,3,null),e("path",null,{d:"M22 21v-2a4 4 0 0 0-3-3.87"},null,3,null),e("path",null,{d:"M16 3.13a4 4 0 0 1 0 7.75"},null,3,null)]},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"pI_0"),Cl=t=>P("svg",{...t,children:[e("path",null,{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4"},null,3,null),e("path",null,{d:"M3 5v14a2 2 0 0 0 2 2h16v-5"},null,3,null),e("path",null,{d:"M18 12a2 2 0 0 0 0 4h4v-4Z"},null,3,null)]},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"lt_0"),fe=t=>P("svg",{...t,children:[e("path",null,{d:"M18 6 6 18"},null,3,null),e("path",null,{d:"m6 6 12 12"},null,3,null)]},{"data-qwikest-icon":!0,fill:"none",height:"1em",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24",width:"1em",xmlns:"http://www.w3.org/2000/svg"},0,"CN_0"),Dl=t=>{const l={xs:{width:24,height:24,text:"text-sm",subtext:"text-xs"},sm:{width:32,height:32,text:"text-lg",subtext:"text-xs"},md:{width:40,height:40,text:"text-xl",subtext:"text-sm"},lg:{width:56,height:56,text:"text-2xl",subtext:"text-base"}},s=t.responsive??!1?{width:"w-6 sm:w-8 md:w-10",height:"h-6 sm:h-8 md:h-10",text:"text-sm sm:text-lg md:text-xl",subtext:"text-xs sm:text-xs md:text-sm"}:null,{width:n,height:r,text:i,subtext:o}=t.responsive??!1?s:l[t.size??"md"];return e("div",null,{class:y(u=>`inline-flex items-center ${u.className??""}`,[t],'`inline-flex items-center ${p0.className??""}`')},[e("div",{style:{width:n,height:r}},null,e("svg",null,{viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg",class:"w-full h-full"},[e("defs",null,null,e("linearGradient",null,{id:"logoGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%"},[e("stop",null,{offset:"0%",style:{stopColor:"#0f766e",stopOpacity:1}},null,3,null),e("stop",null,{offset:"50%",style:{stopColor:"#14b8a6",stopOpacity:1}},null,3,null),e("stop",null,{offset:"100%",style:{stopColor:"#5eead4",stopOpacity:1}},null,3,null)],3,null),3,null),e("circle",null,{cx:"50",cy:"50",r:"42",fill:"url(#logoGradient)",stroke:"#0f766e","stroke-width":"2"},null,3,null),e("text",null,{x:"50%",y:"50%","dominant-baseline":"central","text-anchor":"middle","font-family":"'Poppins', sans-serif","font-size":"28","font-weight":"bold",fill:"#ffffff","letter-spacing":"-1"},"STL",3,null)],3,null),3,null),e("div",{class:`ml-2 sm:ml-3 font-bold ${t.responsive??!1?s.text:i} flex flex-col leading-none`},null,[e("span",null,{class:"text-slate-800 dark:text-slate-100"},"Saave",3,null),e("span",{class:`text-teal-600 dark:text-teal-400 ${t.responsive??!1?s.subtext:o}`},null,"TimeLock",3,null)],1,null)],1,"2o_0")},Rl=te(g(Dl,"s_jTI0vSQg3mw")),je=t=>d(Rl,{...t},0,"S3_0"),Il=async t=>H(t),pt=V(g(Il,"s_kPZv5zqFaP4")),Al=()=>{const[t]=O();t.value=!t.value,t.value?(document.documentElement.classList.add("dark"),localStorage.setItem("theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("theme","light"))},Ll=()=>{const[t]=O();t.value=!t.value},Ml=()=>{const[t]=O();return t.value=!1},Ol=()=>{const[t]=O();return t.value=!1},Pl=()=>{const[t]=O();return t.value=!1},jl=()=>{X();const t=pt(),l=Xe(),s=b(!1),n=b(!1),r=b(!0),i=[...t.value.role==="admin"||t.value.role==="super_admin"?[{name:"Dashboard",href:"/",icon:wl,description:"Overview of key metrics"},{name:"Professionals",href:"/professionals",icon:ve,description:"Manage professional profiles"},{name:"Contracts",href:"/contracts",icon:Ee,description:"Administer service contracts"},{name:"Invoices",href:"/invoices",icon:he,description:"Track and manage invoices"},{name:"Settlements",href:"/settlements",icon:ut,description:"Process payment settlements"},{name:"Planner",href:"/planner",icon:nt,description:"View payment schedules"},...t.value.role==="super_admin"?[{name:"User Admin",href:"/user-admin",icon:ve,description:"Manage system users"}]:[]]:[{name:"Contracts",href:"/contracts",icon:Ee,description:"Administer service contracts"},{name:"Invoices",href:"/invoices",icon:he,description:"Track and manage invoices"},{name:"Settlements",href:"/settlements",icon:it,description:"Automate payment schedules"}]],o=t.value.isAuthenticated?{name:"Logout",href:"/auth/logout",icon:mt,description:"Sign out of your account"}:{name:"Login",href:"/auth",icon:El,description:"Access your account"};Se(w("s_PXmMQHEJxdA",[s]));const u=g(Al,"s_gdjDhvPXj4E",[s]),m=g(Ll,"s_B99zaGvTXxk",[r]);return l.url.pathname==="/auth/"?e("main",null,{class:"flex-1 p-4 sm:p-6 lg:p-8 overflow-y-auto"},d(Me,null,3,"S3_1"),1,"S3_2"):e("div",null,{class:"flex h-screen bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-200"},[e("aside",{class:`hidden lg:flex flex-col transition-all duration-300 ease-in-out bg-white dark:bg-slate-800/50 border-r border-slate-200 dark:border-slate-700/50
        ${r.value?"w-64":"w-20"}`},null,[e("div",null,{class:y(c=>`flex items-center h-16 px-4 ${c.value?"justify-between":"justify-center"}`,[r],'`flex items-center h-16 px-4 ${p0.value?"justify-between":"justify-center"}`')},[d(be,{href:"/",get class(){return`flex items-center gap-2 ${!r.value&&"w-full justify-center"}`},children:[d(je,{className:"w-8 h-8 text-teal-500",[a]:{className:a}},3,"S3_3"),r.value&&e("span",null,{class:"font-bold text-lg"},"SaveeTimelock",3,"S3_4")],[a]:{href:a,class:y(c=>`flex items-center gap-2 ${!c.value&&"w-full justify-center"}`,[r],'`flex items-center gap-2 ${!p0.value&&"w-full justify-center"}`')}},1,"S3_5"),r.value&&e("button",null,{class:"p-1 rounded-md hover:bg-slate-100 dark:hover:bg-slate-700",onClick$:m},d(rt,{class:"w-5 h-5",[a]:{class:a}},3,"S3_6"),1,"S3_7")],1,null),!r.value&&e("div",null,{class:"flex justify-center my-2"},e("button",null,{class:"p-1 rounded-md hover:bg-slate-100 dark:hover:bg-slate-700",onClick$:m},d(ot,{class:"w-5 h-5",[a]:{class:a}},3,"S3_8"),1,null),1,"S3_9"),e("nav",null,{class:"flex-1 px-2 py-4 space-y-2"},t.value.isAuthenticated&&i.map(c=>{const p=l.url.pathname===c.href||c.href!=="/"&&l.url.pathname.startsWith(c.href);return d(be,{get href(){return c.href},get title(){return c.name},class:`flex items-center gap-3 rounded-md transition-colors
                ${r.value?"px-3 py-2":"p-3 justify-center"}
                ${p?"bg-teal-500/10 text-teal-500 dark:bg-teal-400/20 dark:text-teal-400":"hover:bg-slate-100 dark:hover:bg-slate-700/50"}`,children:[d(c.icon,{class:"w-5 h-5 shrink-0",[a]:{class:a}},3,"S3_10"),r.value&&e("span",null,{class:"text-sm font-medium"},A(c,"name"),1,"S3_11")],[a]:{href:we(c,"href"),title:we(c,"name")}},1,c.name)}),1,null),e("div",null,{class:"px-2 py-4 mt-auto"},d(be,{get href(){return o.href},get title(){return o.name},class:`flex items-center gap-3 rounded-md transition-colors
            ${r.value?"px-3 py-2":"p-3 justify-center"}
            hover:bg-slate-100 dark:hover:bg-slate-700/50`,children:[d(o.icon,{class:"w-5 h-5 shrink-0",[a]:{class:a}},3,"S3_12"),r.value&&e("span",null,{class:"text-sm font-medium"},A(o,"name"),1,"S3_13")],[a]:{href:we(o,"href"),title:we(o,"name")}},1,"S3_14"),1,null)],1,null),e("header",null,{class:"lg:hidden fixed top-0 left-0 right-0 z-40 flex items-center justify-between h-16 px-4 bg-white/80 dark:bg-slate-900/80 backdrop-blur-sm border-b border-slate-200 dark:border-slate-800"},[e("button",null,{class:"p-2",onClick$:w("s_CqXkyDmMGuc",[n])},d(bl,{class:"w-6 h-6",[a]:{class:a}},3,"S3_15"),1,null),d(be,{href:"/",class:"flex items-center gap-2",children:d(je,{className:"w-8 h-8 text-teal-500",[a]:{className:a}},3,"S3_16"),[a]:{href:a,class:a}},1,"S3_17"),e("button",null,{class:"p-2",onClick$:u},s.value?d(Sl,{class:"w-6 h-6",[a]:{class:a}},3,"S3_18"):d(hl,{class:"w-6 h-6",[a]:{class:a}},3,"S3_19"),1,null)],1,null),n.value&&e("div",null,{class:"lg:hidden fixed inset-0 z-50",role:"dialog","aria-modal":"true"},[e("div",null,{class:"fixed inset-0 bg-black/25 backdrop-blur-sm",onClick$:w("s_29h0Cs0YvUk",[n])},null,3,null),e("div",null,{class:"fixed inset-y-0 left-0 w-64 bg-white dark:bg-slate-800 p-4"},[e("div",null,{class:"flex items-center justify-between h-12 mb-4"},[d(be,{href:"/",class:"flex items-center gap-2",onClick$:g(Ml,"s_Lgh2fELhsxw",[n]),children:e("span",null,{class:"font-bold text-lg"},"SaveeTimelock",3,null),[a]:{href:a,class:a,onClick$:a}},3,"S3_20"),e("button",null,{class:"p-2",onClick$:w("s_tUdpu55U93Q",[n])},d(fe,{class:"w-6 h-6",[a]:{class:a}},3,"S3_21"),1,null)],1,null),e("nav",null,{class:"flex flex-col h-full"},[e("div",null,{class:"flex-1 space-y-2"},t.value.isAuthenticated&&i.map(c=>{const p=l.url.pathname===c.href||c.href!=="/"&&l.url.pathname.startsWith(c.href);return d(be,{get href(){return c.href},onClick$:g(Ol,"s_rHbc3bvvZ1E",[n]),class:`flex items-center gap-3 px-3 py-2 rounded-md text-sm font-medium
                      ${p?"bg-teal-500/10 text-teal-500 dark:bg-teal-400/20 dark:text-teal-400":"hover:bg-slate-100 dark:hover:bg-slate-700"}`,children:[d(c.icon,{class:"w-5 h-5",[a]:{class:a}},3,"S3_22"),A(c,"name")],[a]:{href:we(c,"href"),onClick$:a}},1,c.name)}),1,null),e("div",null,{class:"mt-auto"},d(be,{get href(){return o.href},onClick$:g(Pl,"s_NhVnMTaOGeI",[n]),class:"flex items-center gap-3 px-3 py-2 rounded-md text-sm font-medium hover:bg-slate-100 dark:hover:bg-slate-700",children:[d(o.icon,{class:"w-5 h-5",[a]:{class:a}},3,"S3_23"),A(o,"name")],[a]:{href:we(o,"href"),onClick$:a,class:a}},1,"S3_24"),1,null)],1,null)],1,null)],1,"S3_25"),e("main",null,{class:"flex-1 overflow-y-auto pt-16 lg:pt-0"},e("div",null,{class:"p-4 sm:p-6 lg:p-8"},d(Me,null,3,"S3_26"),1,null),1,null)],1,"S3_27")},Ul=te(g(jl,"s_7u8M1ps3cz0")),Nl=Object.freeze(Object.defineProperty({__proto__:null,Logo:je,default:Ul,useAuthSession:pt},Symbol.toStringTag,{value:"Module"}));Fe({url:process.env.PRIVATE_TURSO_DATABASE_URL||"file:./local.db",authToken:process.env.PRIVATE_TURSO_AUTH_TOKEN});function F(t){var n,r;const l=(n=t.env.get("PRIVATE_TURSO_DATABASE_URL"))==null?void 0:n.trim();if(l===void 0)throw new Error("PRIVATE_TURSO_DATABASE_URL is not defined");const s=(r=t.env.get("PRIVATE_TURSO_AUTH_TOKEN"))==null?void 0:r.trim();if(s===void 0&&!l.includes("file:"))throw new Error("PRIVATE_TURSO_AUTH_TOKEN is not defined");return Fe({url:l,authToken:s})}const $l=async t=>{const l=await H(t);if(!l.isAuthenticated)throw t.redirect(302,"/auth");return l},ft=V(g($l,"s_euvihm1OmHg")),Fl=async t=>{var s,n,r,i,o,u,m,c;const l=F(t);try{const p=await l.execute("SELECT COUNT(*) as count FROM professionals"),h=await l.execute("SELECT COUNT(*) as count FROM contracts WHERE status = 'active'"),v=await l.execute("SELECT COUNT(*) as count, SUM(amount) as total FROM invoices WHERE status = 'pending'"),_=await l.execute({sql:`
        SELECT COUNT(*) as count 
        FROM payments 
        WHERE status = 'scheduled' AND payment_date BETWEEN date('now') AND date('now', '+7 days')
      `,args:[]}),T=await l.execute("SELECT COUNT(*) as count FROM settlements"),E=await l.execute("SELECT SUM(total_amount) as total FROM settlements WHERE status = 'paid'"),I=await l.execute({sql:`
        SELECT id, name, role, created_at 
        FROM professionals 
        ORDER BY created_at DESC 
        LIMIT 5
      `,args:[]}),D=await l.execute({sql:`
        SELECT 
          i.id, 
          i.amount, 
          i.currency, 
          i.status, 
          i.issue_date, 
          p.name as professional_name 
        FROM invoices i
        JOIN professionals p ON i.professional_id = p.id
        ORDER BY i.created_at DESC 
        LIMIT 5
      `,args:[]});return{professionals:((s=p.rows[0])==null?void 0:s.count)||0,activeContracts:((n=h.rows[0])==null?void 0:n.count)||0,pendingInvoices:{count:((r=v.rows[0])==null?void 0:r.count)||0,total:((i=v.rows[0])==null?void 0:i.total)||0},upcomingPayments:((o=_.rows[0])==null?void 0:o.count)||0,totalSettled:((u=E.rows[0])==null?void 0:u.total)||0,settlementsTotal:((m=T.rows[0])==null?void 0:m.count)||0,settlementsPaid:((c=E.rows[0])==null?void 0:c.total)||0,recentProfessionals:I.rows||[],recentInvoices:D.rows||[]}}catch(p){return console.error("Dashboard data loading error:",p),{professionals:0,activeContracts:0,pendingInvoices:{count:0,total:0},upcomingPayments:0,totalSettled:0,recentProfessionals:[],recentInvoices:[]}}},xt=V(g(Fl,"s_FQa6Zhzh4t0")),ql=(t,l="USD")=>{const s=l==="KNRT",n=s?"USD":l,r=new Intl.NumberFormat("en-US",{style:"currency",currency:n,minimumFractionDigits:2,maximumFractionDigits:2}).format(t);return s?`${r} KNRT`:r},Bl=()=>{var r,i;X(),ft();const t=xt();Xe();const l=new Date().toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),s=g(ql,"s_W1w5p9RjLGU"),n={totalProfessionals:Number(t.value.professionals)||0,activeContracts:Number(t.value.activeContracts)||0,pendingInvoices:Number((r=t.value.pendingInvoices)==null?void 0:r.count)||0,upcomingPayments:Number(t.value.upcomingPayments)||0,totalSettled:Number(t.value.totalSettled)||0,pendingAmount:Number((i=t.value.pendingInvoices)==null?void 0:i.total)||0,settlementsTotal:Number(t.value.settlementsTotal)||0,settlementsPaid:Number(t.value.settlementsPaid)||0};return e("div",null,{class:"min-h-screen bg-white dark:bg-slate-900 flex flex-col"},e("div",null,{class:"container mx-auto px-4 py-8 flex-1 flex flex-col"},[e("header",null,{class:"mb-8 bg-gradient-to-r from-slate-100 to-slate-50 dark:from-slate-800 dark:to-slate-700 rounded-xl shadow-sm p-6"},[e("h1",null,{class:"text-2xl md:text-3xl font-bold mb-2 text-slate-800 dark:text-slate-100"},"Dashboard",3,null),e("p",null,{class:"text-sm md:text-base text-slate-500 dark:text-slate-400"},l,1,null)],1,null),e("div",null,{class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"},[e("div",null,{class:"bg-white dark:bg-slate-800 rounded-xl shadow-elegant p-6 border border-slate-100 dark:border-slate-700 transition-all hover:shadow-elegant-lg"},e("div",null,{class:"flex justify-between items-center"},[e("div",null,null,[e("p",null,{class:"text-sm font-medium text-slate-500 dark:text-slate-400"},"Total Professionals",3,null),e("p",null,{class:"text-2xl font-bold mt-1 text-slate-800 dark:text-slate-100"},A(n,"totalProfessionals"),1,null)],1,null),e("div",null,{class:"w-12 h-12 rounded-full bg-gradient-to-br from-slate-100 to-slate-200 dark:from-slate-700 dark:to-slate-600 flex items-center justify-center text-slate-700 dark:text-slate-300 shadow-sm"},d(ve,{class:"w-6 h-6",[a]:{class:a}},3,"Pz_0"),1,null)],1,null),1,null),e("div",null,{class:"bg-white dark:bg-slate-800 rounded-xl shadow-elegant p-6 border border-slate-100 dark:border-slate-700 transition-all hover:shadow-elegant-lg"},e("div",null,{class:"flex justify-between items-center"},[e("div",null,null,[e("p",null,{class:"text-sm font-medium text-slate-500 dark:text-slate-400"},"Active Contracts",3,null),e("p",null,{class:"text-2xl font-bold mt-1 text-slate-800 dark:text-slate-100"},A(n,"activeContracts"),1,null)],1,null),e("div",null,{class:"w-12 h-12 rounded-full bg-gradient-to-br from-teal-100 to-teal-200 dark:from-teal-800/30 dark:to-teal-700/30 flex items-center justify-center text-teal-600 dark:text-teal-400 shadow-sm"},d(Ee,{class:"w-6 h-6",[a]:{class:a}},3,"Pz_1"),1,null)],1,null),1,null),e("div",null,{class:"bg-white dark:bg-slate-800 rounded-xl shadow-elegant p-6 border border-slate-100 dark:border-slate-700 transition-all hover:shadow-elegant-lg"},e("div",null,{class:"flex justify-between items-center"},[e("div",null,null,[e("p",null,{class:"text-sm font-medium text-slate-500 dark:text-slate-400"},"Pending Invoices",3,null),e("p",null,{class:"text-2xl font-bold mt-1 text-slate-800 dark:text-slate-100"},A(n,"pendingInvoices"),1,null)],1,null),e("div",null,{class:"w-12 h-12 rounded-full bg-gradient-to-br from-amber-100 to-amber-200 dark:from-amber-800/30 dark:to-amber-700/30 flex items-center justify-center text-amber-600 dark:text-amber-400 shadow-sm"},d(he,{class:"w-6 h-6",[a]:{class:a}},3,"Pz_2"),1,null)],1,null),1,null),e("div",null,{class:"bg-white dark:bg-slate-800 rounded-xl shadow-elegant p-6 border border-slate-100 dark:border-slate-700 transition-all hover:shadow-elegant-lg"},e("div",null,{class:"flex justify-between items-center"},[e("div",null,null,[e("p",null,{class:"text-sm font-medium text-slate-500 dark:text-slate-400"},"Total Settlements",3,null),e("p",null,{class:"text-2xl font-bold mt-1 text-slate-800 dark:text-slate-100"},A(n,"settlementsTotal"),1,null),e("p",null,{class:"text-sm font-medium text-slate-500 dark:text-slate-400 mt-2"},["Paid: ",e("span",null,{class:"font-bold text-green-600 dark:text-green-400"},s(n.settlementsPaid,"KNRT"),1,null)],1,null)],1,null),e("div",null,{class:"w-12 h-12 rounded-full bg-gradient-to-br from-green-100 to-green-200 dark:from-green-800/30 dark:to-green-700/30 flex items-center justify-center text-green-600 dark:text-green-400 shadow-sm"},d(ut,{class:"w-6 h-6",[a]:{class:a}},3,"Pz_3"),1,null)],1,null),1,null)],1,null),e("div",null,{class:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8"},[e("div",null,{class:"lg:col-span-2 bg-white dark:bg-slate-800 rounded-xl shadow-elegant p-6 border border-slate-100 dark:border-slate-700"},[e("div",null,{class:"flex justify-between items-center mb-4"},e("h2",null,{class:"text-lg font-semibold text-slate-800 dark:text-slate-100"},"Financial Summary",3,null),3,null),e("div",null,{class:"grid grid-cols-1 md:grid-cols-2 gap-6"},[e("div",null,null,[e("p",null,{class:"text-sm font-medium text-slate-500 dark:text-slate-400"},"Total Settled",3,null),e("div",null,{class:"flex items-center mt-2"},e("span",null,{class:"text-2xl font-bold text-slate-800 dark:text-slate-100"},s(n.totalSettled,"KNRT"),1,null),1,null)],1,null),e("div",null,null,[e("p",null,{class:"text-sm font-medium text-slate-500 dark:text-slate-400"},"Pending Amount",3,null),e("div",null,{class:"flex items-center mt-2"},e("span",null,{class:"text-2xl font-bold text-slate-800 dark:text-slate-100"},s(n.pendingAmount,"KNRT"),1,null),1,null)],1,null)],1,null),e("div",null,{class:"mt-6 bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-700/50 dark:to-slate-800/50 rounded-lg h-48 flex items-center justify-center shadow-elegant-sm"},e("p",null,{class:"text-slate-500 dark:text-slate-400 text-sm font-medium"},"Monthly payments chart",3,null),3,null)],1,null),e("div",null,{class:"bg-white dark:bg-slate-800 rounded-xl shadow-elegant p-6 border border-slate-100 dark:border-slate-700"},[e("div",null,{class:"flex justify-between items-center mb-4"},e("h2",null,{class:"text-lg font-semibold text-slate-800 dark:text-slate-100"},"Recent Professionals",3,null),3,null),e("div",null,{class:"space-y-4"},t.value.recentProfessionals.length>0?t.value.recentProfessionals.map(o=>e("div",null,{class:"flex items-center p-2 hover:bg-slate-50 dark:hover:bg-slate-700/50 rounded-lg transition-colors"},[e("div",null,{class:"w-10 h-10 rounded-full bg-gradient-to-br from-slate-100 to-slate-200 dark:from-slate-700 dark:to-slate-600 flex items-center justify-center text-slate-700 dark:text-slate-300 shadow-sm"},o.name.charAt(0).toUpperCase(),1,null),e("div",null,{class:"ml-3"},[e("p",null,{class:"font-medium text-sm text-slate-800 dark:text-slate-200"},A(o,"name"),1,null),e("p",null,{class:"text-xs text-slate-500 dark:text-slate-400"},A(o,"role"),1,null)],1,null)],1,o.id)):e("div",null,{class:"text-center py-6 text-slate-500 dark:text-slate-400"},[e("div",null,{class:"inline-flex items-center justify-center w-12 h-12 rounded-full bg-slate-100 dark:bg-slate-700/50 mb-3"},d(ve,{class:"w-6 h-6 text-slate-400 dark:text-slate-500",[a]:{class:a}},3,"Pz_4"),1,null),e("p",null,null,"No professionals registered",3,null)],1,"Pz_5"),1,null)],1,null)],1,null),e("div",null,{class:"bg-white dark:bg-slate-800 rounded-xl shadow-elegant border border-slate-100 dark:border-slate-700 overflow-hidden"},[e("div",null,{class:"p-6"},e("h2",null,{class:"text-lg font-semibold mb-4 text-slate-800 dark:text-slate-100"},"Recent Invoices",3,null),3,null),e("div",null,{class:"overflow-x-auto"},e("table",null,{class:"w-full"},[e("thead",null,null,e("tr",null,{class:"text-left bg-gradient-to-r from-slate-50 to-slate-100 dark:from-slate-700 dark:to-slate-800"},[e("th",null,{class:"px-6 py-3 text-xs font-medium text-slate-600 dark:text-slate-300 uppercase tracking-wider"},"Professional",3,null),e("th",null,{class:"px-6 py-3 text-xs font-medium text-slate-600 dark:text-slate-300 uppercase tracking-wider"},"Date",3,null),e("th",null,{class:"px-6 py-3 text-xs font-medium text-slate-600 dark:text-slate-300 uppercase tracking-wider"},"Amount",3,null),e("th",null,{class:"px-6 py-3 text-xs font-medium text-slate-600 dark:text-slate-300 uppercase tracking-wider"},"Status",3,null)],3,null),3,null),e("tbody",null,{class:"divide-y divide-gray-200 dark:divide-gray-700"},t.value.recentInvoices.length>0?t.value.recentInvoices.map(o=>e("tr",null,null,[e("td",null,{class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},A(o,"professional_name"),1,null),e("td",null,{class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400"},new Date(o.issue_date).toLocaleDateString(),1,null),e("td",null,{class:"px-6 py-4 whitespace-nowrap text-sm"},[new Intl.NumberFormat("es-ES",{style:"currency",currency:o.currency==="KNRT"?"USD":o.currency}).format(o.amount)," ",o.currency==="KNRT"?"KNRT":""],1,null),e("td",null,{class:"px-6 py-4 whitespace-nowrap"},e("span",{class:`inline-flex rounded-full px-2 text-xs font-semibold leading-5 ${o.status==="paid"?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":o.status==="awaiting_release"?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300":"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300"}`},null,o.status==="paid"?"Pagado":o.status==="awaiting_release"?"Esperando liberación":"Pendiente",1,null),1,null)],1,o.id)):e("tr",null,null,e("td",null,{colSpan:4,class:"px-6 py-8 text-center text-sm text-slate-500 dark:text-slate-400"},[e("div",null,{class:"inline-flex items-center justify-center w-12 h-12 rounded-full bg-slate-100 dark:bg-slate-700/50 mb-3"},d(he,{class:"w-6 h-6 text-slate-400 dark:text-slate-500",[a]:{class:a}},3,"Pz_6"),1,null),e("p",null,null,"No recent invoices",3,null)],1,null),1,"Pz_7"),1,null)],1,null),1,null)],1,null)],1,null),1,"Pz_8")},zl=te(g(Bl,"s_G4PaHCacZj0")),Hl=Object.freeze(Object.defineProperty({__proto__:null,default:zl,useAuthLoader:ft,useDashboardDataLoader:xt},Symbol.toStringTag,{value:"Module"})),Wl=$e(async t=>{const s=new URL(t.request.url).searchParams.get("professionalId");if(!s)return t.json(400,{error:"Missing professionalId"});if(!(await H(t)).isAuthenticated)return t.json(401,{error:"Unauthorized"});const r=F(t),i=await r.execute({sql:"SELECT id, name, email, wallet FROM professionals WHERE id = ?",args:[s]});if(!i.rows.length)return t.json(404,{error:"Professional not found"});const o=i.rows[0],u=await r.execute({sql:'SELECT * FROM contracts WHERE professional_id = ? AND status = "active"',args:[s]}),m=await r.execute({sql:"SELECT * FROM invoices WHERE professional_id = ?",args:[s]}),c=await r.execute({sql:"SELECT * FROM settlements WHERE professional_id = ?",args:[s]}),p=await Xt.create(),h=p.addPage([595,842]),v=await p.embedFont(el.Helvetica);let _=800;h.drawText("Resumen de Settlement",{x:50,y:_,size:20,font:v,color:tl(0,.5,.7)}),_-=30,h.drawText(`Profesional: ${o.name} (${o.email})`,{x:50,y:_,size:14,font:v}),_-=20,h.drawText(`Wallet: ${o.wallet||"-"}`,{x:50,y:_,size:12,font:v}),_-=30,h.drawText("Contratos Activos:",{x:50,y:_,size:14,font:v}),_-=18,u.rows.forEach(E=>{h.drawText(`- ${E.status} (${E.start_date} - ${E.end_date||"Presente"})`,{x:60,y:_,size:12,font:v}),_-=16}),_-=10,h.drawText("Facturas:",{x:50,y:_,size:14,font:v}),_-=18,m.rows.forEach(E=>{h.drawText(`- ${E.status} | ${E.amount} ${E.currency} | Emitida: ${E.issue_date}${E.paid_date?" | Pagada: "+E.paid_date:""}`,{x:60,y:_,size:12,font:v}),_-=16}),_-=10,h.drawText("Settlements:",{x:50,y:_,size:14,font:v}),_-=18,c.rows.forEach(E=>{h.drawText(`- ${E.status} | ${E.total_amount} ${E.currency} | Mes: ${E.month}/${E.year} | Fecha pago: ${E.payment_date||"-"}`,{x:60,y:_,size:12,font:v}),_-=16});const T=await p.save();return t.headers.set("Content-Type","application/pdf"),t.headers.set("Content-Disposition",`inline; filename=settlement_${s}.pdf`),new Response(new Uint8Array(T),{status:200})},"Cidn5V1IA0c"),Yl=Ne(g(Wl,"s_Cidn5V1IA0c")),Vl=Object.freeze(Object.defineProperty({__proto__:null,onGet:Yl},Symbol.toStringTag,{value:"Module"})),Ql=et.join(process.cwd(),"private_uploads"),Gl=async t=>{const{params:l,redirect:s,headers:n,error:r}=t;if(!(await H(t)).isAuthenticated)throw s(303,"/auth");const o=l.fileName;if(!o||o.includes("..")||o.includes("/"))throw r(400,"Invalid filename");const u=et.join(Ql,o);try{await Ye.promises.access(u)}catch{throw r(404,"File not found")}try{const m=await Ye.promises.readFile(u);n.set("Content-Type","application/pdf"),n.set("Content-Length",m.length.toString()),n.set("Content-Disposition",`inline; filename="${o}"`),t.send(new Response(m));return}catch(m){throw console.error("Failed to read file:",m),r(500,"Could not read file")}},Zl=Object.freeze(Object.defineProperty({__proto__:null,onGet:Gl},Symbol.toStringTag,{value:"Module"})),Jl=De(process.cwd(),"private_uploads","invoices"),Kl=async t=>{var i;const{params:l,error:s,headers:n}=t;if(!(await H(t)).isAuthenticated)throw s(401,"Unauthorized");try{const o=l.fileName;if(o.includes("..")||o.includes("/"))throw s(400,"Invalid file name");const u=De(Jl,o),m=await ll(u),c=(i=o.split(".").pop())==null?void 0:i.toLowerCase();let p="application/octet-stream";c==="pdf"?p="application/pdf":["png","jpg","jpeg","gif","webp"].includes(c||"")&&(p=`image/${c}`),n.set("Content-Type",p),n.set("Content-Length",m.length.toString()),n.set("Content-Disposition",`inline; filename="${o}"`);const h=new Response(new Uint8Array(m),{headers:n});t.send(h)}catch(o){throw console.error("File serving failed:",o),s(404,"File not found")}},Xl=Object.freeze(Object.defineProperty({__proto__:null,onGet:Kl},Symbol.toStringTag,{value:"Module"})),es=async t=>{const{json:l,error:s}=t;if(!(await H(t)).isAuthenticated)throw s(401,"Unauthorized");try{const i=(await t.request.formData()).get("contract");if(!i)throw s(400,"No file uploaded.");if(i.type!=="application/pdf")throw s(400,"Only PDF files are allowed.");const o=lt(8).toString("hex"),u=Re.extname(i.name)||".pdf",m=`${Re.basename(i.name,u)}-${Date.now()}-${o}${u}`,c=Re.join(process.cwd(),"private_uploads");await tt(c,{recursive:!0});const p=Re.join(c,m),h=Buffer.from(await i.arrayBuffer());await qe(p,h),l(200,{success:!0,fileName:m})}catch(r){const i=r&&typeof r=="object"&&"message"in r&&typeof r.message=="string"?r.message:String(r);throw console.error("File upload error:",i),r&&typeof r.status<"u"?r:s(500,i||"An unexpected error occurred during file upload.")}},ts=Object.freeze(Object.defineProperty({__proto__:null,onPost:es},Symbol.toStringTag,{value:"Module"})),ls=async t=>{const s=(await t.request.formData()).get("file");if(!s||typeof s=="string"){t.json(400,{error:"No file uploaded"});return}const n=await s.arrayBuffer(),r=Buffer.from(n),i=s.type.split("/")[1]||"jpg",o=`tree-${Date.now()}-${Math.random().toString(36).slice(2,8)}.${i}`,u=De(process.cwd(),"public","uploads",o);await qe(u,r),t.json(200,{url:`/uploads/${o}`})},ss=Object.freeze(Object.defineProperty({__proto__:null,onPost:ls},Symbol.toStringTag,{value:"Module"})),Je=De(process.cwd(),"private_uploads","invoices"),as=async t=>{const{request:l,error:s,json:n}=t;if(!(await H(t)).isAuthenticated){n(401,{success:!1,error:"Unauthorized"});return}try{await tt(Je,{recursive:!0});const o=(await l.formData()).get("file");if(!o){n(400,{success:!1,error:"File not provided"});return}if(!o.type.startsWith("application/pdf")&&!o.type.startsWith("image/")){n(400,{success:!1,error:"Invalid file type. Only PDF and images are allowed."});return}if(o.size>10485760){n(400,{success:!1,error:"File is too large. Max size is 10MB."});return}const u=Buffer.from(await o.arrayBuffer()),m=`${Date.now()}-${lt(6).toString("hex")}`,c=o.name.split(".").pop()||"file",p=`invoice-${m}.${c}`,h=De(Je,p);await qe(h,u),n(200,{success:!0,fileName:p});return}catch(i){console.error("File upload failed:",i),n(500,{success:!1,error:`Upload failed: ${i.message||"Unknown error"}`});return}},ns=Object.freeze(Object.defineProperty({__proto__:null,onPost:as},Symbol.toStringTag,{value:"Module"})),rs=({cookie:t,redirect:l})=>{throw t.delete("auth_token",{path:"/"}),t.delete("user_type",{path:"/"}),l(302,"/auth")},os=async(t,l)=>{try{console.log("[LOGOUT] Starting logout process"),Be(l),await new Promise(r=>setTimeout(r,100));const s=l.cookie.get("auth_token"),n=l.cookie.get("user_type");if(s||n)throw console.error("[LOGOUT] Cookies not cleared properly:",{authToken:s,userType:n}),new Error("Failed to clear authentication cookies");return console.log("[LOGOUT] Successfully cleared all cookies"),l.redirect(302,"/auth"),{success:!0}}catch(s){return console.error("Logout error:",s),{success:!1,error:s instanceof Error?s.message:"Logout failed"}}},gt=Y(g(os,"s_lYyU40i0tiI")),is=()=>{var s,n;X();const t=gt(),l=((s=t.value)==null?void 0:s.success)===!1;return e("div",null,{class:"min-h-screen w-full flex items-center justify-center transition-colors duration-300 bg-gradient-to-b from-blue-50 to-indigo-100 dark:from-gray-950 dark:to-blue-950 py-6 px-4 sm:px-6 lg:px-8 overflow-hidden relative"},[e("div",null,{class:"fixed inset-0 pointer-events-none overflow-hidden"},[e("div",null,{class:"w-20 h-20 bg-blue-500/10 rounded-full absolute top-[10%] left-[15%] animate-[float_15s_infinite]"},null,3,null),e("div",null,{class:"w-32 h-32 bg-indigo-500/10 rounded-full absolute top-[30%] left-[65%] animate-[float_18s_infinite]",style:"animation-delay: 0.5s;"},null,3,null),e("div",null,{class:"w-16 h-16 bg-teal-500/10 rounded-full absolute top-[70%] left-[25%] animate-[float_12s_infinite]",style:"animation-delay: 1s;"},null,3,null)],3,null),e("div",null,{class:"absolute top-6 left-1/2 transform -translate-x-1/2"},e("div",null,{class:"flex items-center"},[e("div",null,{class:"relative"},e("div",null,{class:"w-10 h-10 rounded-full bg-gradient-to-r from-blue-600 to-indigo-600 flex items-center justify-center text-white shadow-lg"},e("svg",null,{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6"},e("path",null,{"stroke-linecap":"round","stroke-linejoin":"round",d:"m9 9 10.5-3m0 6.553v3.75a2.25 2.25 0 0 1-1.632 2.163l-1.32.377a1.803 1.803 0 1 1-.99-3.467l2.31-.66a2.25 2.25 0 0 0 1.632-2.163Zm0 0V2.25L9 5.25v10.303m0 0v3.75a2.25 2.25 0 0 1-1.632 2.163l-1.32.377a1.803 1.803 0 0 1-.99-3.467l2.31-.66A2.25 2.25 0 0 0 9 15.553Z"},null,3,null),3,null),3,null),3,null),e("h1",null,{class:"ml-2 text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-indigo-600 dark:from-blue-400 dark:to-indigo-400"},"Move On Challenge",3,null)],3,null),3,null),e("div",null,{class:"max-w-md w-full z-10"},[e("div",null,{class:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl border border-gray-200 dark:border-gray-700 overflow-hidden backdrop-blur-sm p-8 animate-[fade-in_0.5s_ease-out]"},[e("div",null,{class:"text-center mb-8"},[e("h2",null,{class:"text-3xl font-bold mb-3 text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-indigo-600 dark:from-blue-400 dark:to-indigo-400"},"Log Out",3,null),e("p",null,{class:"text-gray-600 dark:text-gray-400"},"Are you sure you want to log out?",3,null)],3,null),d(ee,{action:t,class:"space-y-6",spaReset:!0,get"preventdefault:submit"(){return t.isRunning},children:[e("button",null,{type:"submit",disabled:y(r=>r.isRunning,[t],"p0.isRunning"),class:"w-full flex justify-center items-center py-3 px-4 rounded-xl text-white bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 dark:from-blue-500 dark:to-indigo-500 dark:hover:from-blue-600 dark:hover:to-indigo-600 font-medium shadow-md hover:shadow-lg transition-all duration-200 disabled:opacity-70 disabled:cursor-not-allowed"},t.isRunning?e("span",null,{class:"flex items-center"},[d(Ie,{class:"animate-spin mr-2 h-5 w-5",[a]:{class:a}},3,"6d_0"),"Logging out..."],1,"6d_1"):e("span",null,{class:"flex items-center"},[d(mt,{class:"mr-2 h-5 w-5",[a]:{class:a}},3,"6d_2"),"Confirm Logout"],1,null),1,null),l&&e("div",null,{class:"p-3 bg-red-100 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-lg text-red-700 dark:text-red-300 text-sm mt-4"},[e("p",null,null,"There was a problem logging you out. Please try again.",3,null),((n=t.value)==null?void 0:n.error)&&e("p",null,{class:"mt-1 text-xs opacity-80"},y(r=>r.value.error,[t],"p0.value.error"),3,"6d_3")],1,"6d_4"),e("a",null,{href:"/challenges",class:"block w-full text-center mt-4 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors duration-200"},"Cancel",3,null)],[a]:{action:a,class:a,spaReset:a,"preventdefault:submit":y(r=>r.isRunning,[t],"p0.isRunning")}},1,"6d_5")],1,null),e("div",null,{class:"mt-6 text-center text-sm text-gray-600 dark:text-gray-400"},"Thank you for using Move On Challenge",3,null)],1,null),e("style",null,null,`
        @keyframes fadeIn {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes float {
          0% { transform: translate(0, 0); }
          25% { transform: translate(5px, -15px); }
          50% { transform: translate(10px, 0); }
          75% { transform: translate(5px, 15px); }
          100% { transform: translate(0, 0); }
        }
        
        @keyframes fade-in {
          0% { opacity: 0; }
          100% { opacity: 1; }
        }
      `,3,null)],1,"6d_6")},us=te(g(is,"s_zqPwfW3jn0I")),ds=Object.freeze(Object.defineProperty({__proto__:null,default:us,onGet:rs,useLogout:gt},Symbol.toStringTag,{value:"Module"})),cs=async(t,l)=>{try{return console.log("[LOGOUT] Starting logout process"),Be(l),l.redirect(302,"/auth"),{success:!0}}catch(s){return console.error("Logout error:",s),{success:!1,error:s instanceof Error?s.message:"Logout failed"}}},ms=Y(g(cs,"s_uyYPcWOxv4U")),ps=async(t,l)=>{const s=F(l),{email:n}=t;try{return{success:!0,isRegistered:(await s.execute({sql:"SELECT id FROM users WHERE email = ?",args:[n]})).rows.length>0}}catch(r){return console.error("Email check error:",r),{success:!1,error:r instanceof Error?r.message:"Failed to check email"}}},bt=Y(g(ps,"s_DmU9OP9DRTo")),fs=async(t,l)=>{const s=F(l),{email:n,password:r,username:i}=t;try{const o=await ul(r),m=(await s.execute({sql:"SELECT COUNT(*) as count FROM users",args:[]})).rows[0].count===0,c=n==="golfredo.pf@gmail.com"||m?"admin":"freelancer";let p;if(p=(await s.execute({sql:"INSERT INTO users (email, password_hash, type, username) VALUES (?, ?, ?, ?)",args:[n,o,c,i||n.split("@")[0]]})).lastInsertRowid,!p)throw new Error("Registration failed: userId is undefined");return at(l,p,c),l.redirect(302,"/"),{success:!0}}catch(o){return console.error("Registration error:",o),{success:!1,error:o instanceof Error?o.message:"Registration failed"}}},ht=Y(g(fs,"s_ifiWVdoZ0cQ")),xs=async t=>({success:!0}),Ue=V(g(xs,"s_0gRwIEUvq0E")),gs=async(t,l)=>{const s=F(l),{email:n,password:r}=t;try{console.log("[LOGIN] Intentando login para email:",n);const i=await s.execute({sql:"SELECT * FROM users WHERE email = ?",args:[n]});console.log("[LOGIN] Resultado de búsqueda en DB:",i.rows);const o=i.rows[0];if(!o)return console.error("[LOGIN] Usuario no encontrado para email:",n),{success:!1,error:"Usuario no encontrado"};if(typeof o.password_hash!="string")return console.error("[LOGIN] password_hash inválido:",o.password_hash),{success:!1,error:"password_hash inválido"};if(!o.id)return console.error("[LOGIN] user.id inválido:",o.id),{success:!1,error:"user.id inválido"};console.log("[LOGIN] password ingresada:",r),console.log("[LOGIN] hash guardado:",o.password_hash);const u=await dl(r,o.password_hash);if(console.log("[LOGIN] resultado de verifyPassword:",u),!u)return console.error("[LOGIN] Contraseña incorrecta para email:",n),{success:!1,error:"Contraseña incorrecta"};const m=String(o.id);try{await s.execute({sql:"UPDATE users SET session_expires = ? WHERE id = ?",args:[new Date(Date.now()+36e5),m]}),console.log("[LOGIN] session_expires actualizado para user:",m)}catch(p){console.error("[LOGIN] Error actualizando session_expires:",p)}const c=o.type==="admin"?"admin":o.type==="super_admin"?"super_admin":"freelancer";return at(l,m,c),console.log("[LOGIN] Cookies seteadas para user:",m,c),l.redirect(302,"/"),{success:!0}}catch(i){return console.error("[LOGIN] Error general en login:",i),{success:!1,error:"Login failed"}}},vt=Y(g(gs,"s_YXIc7hgvWuM")),bs=async()=>{var i,o;const[t,l,s,n,r]=O();n.value=!0,s.value="",await new Promise(u=>setTimeout(u,500)),(i=t.value)!=null&&i.success?(r.value=t.value.isRegistered?"password":"register",l.value=document.getElementById("email").value):s.value=((o=t.value)==null?void 0:o.error)||"Failed to check email",n.value=!1},hs=async()=>{var n,r;const[t,l,s]=O();l.value=!0,t.value="",await new Promise(i=>setTimeout(i,500)),(n=s.value)!=null&&n.success||(t.value=((r=s.value)==null?void 0:r.error)||"Login failed"),l.value=!1},vs=async()=>{var n,r;const[t,l,s]=O();l.value=!0,t.value="",await new Promise(i=>setTimeout(i,500)),(n=s.value)!=null&&n.success||(t.value=((r=s.value)==null?void 0:r.error)||"Registration failed"),l.value=!1},ws=()=>{var c;X(),Ue();const t=Ue(),l=bt(),s=ht(),n=vt(),r=b("email"),i=b(""),o=b(""),u=b(""),m=b(!1);return(c=t.value)!=null&&c.success&&console.log("Tables initialized successfully"),e("main",null,{class:"min-h-screen bg-gradient-to-br from-slate-50 to-white dark:from-slate-900 dark:via-slate-800 dark:to-slate-900 flex flex-col items-center justify-center"},[e("header",null,{class:"w-full flex flex-col items-center py-8 mb-2"},[e("h1",null,{class:"text-3xl md:text-4xl font-extrabold text-slate-700 dark:text-teal-400 mb-2 flex items-center gap-2 animate-slide-down"},[e("span",null,{role:"img","aria-label":"clock"},"⏱️",3,null)," Welcome to SaveeTimelock"],3,null),e("p",null,{class:"text-center text-lg text-slate-600 dark:text-slate-300 max-w-2xl animate-fade-in"},"Sign in or register to start tracking your time and managing your projects.",3,null)],3,null),e("section",null,{class:"w-full flex flex-col items-center"},e("div",null,{class:"w-full max-w-md rounded-3xl overflow-hidden shadow-2xl bg-white/90 dark:bg-gray-900/90 backdrop-blur-sm p-2 md:p-6 animate-grow-in transition-transform duration-700"},[r.value==="email"&&d(ee,{action:l,class:"space-y-6",onSubmit$:g(bs,"s_xydvnoO3NQo",[l,i,u,m,r]),children:[e("div",null,{class:"space-y-2"},[e("label",null,{for:"email",class:"block text-sm font-medium text-slate-700 dark:text-slate-200"},"Email address",3,null),e("div",null,{class:"relative"},[e("div",null,{class:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"},d(gl,{class:"h-5 w-5 text-slate-400 dark:text-slate-500",[a]:{class:a}},3,"eD_0"),1,null),e("input",null,{id:"email",name:"email",type:"email",required:!0,class:"pl-10 block w-full rounded-xl border-0 py-3 text-slate-700 dark:text-white shadow-sm ring-1 ring-inset ring-slate-300 dark:ring-slate-600 placeholder:text-slate-400 dark:placeholder:text-slate-500 focus:ring-2 focus:ring-inset focus:ring-teal-500 dark:focus:ring-teal-400 bg-white dark:bg-gray-800",placeholder:"your@email.com"},null,3,null)],1,null),e("p",null,{class:"text-xs text-slate-500 dark:text-slate-400 mt-1"},"We'll check if you already have an account",3,null)],1,null),e("button",null,{type:"submit",disabled:y(p=>p.value,[m],"p0.value"),class:"w-full flex justify-center items-center py-3 px-4 rounded-xl text-white bg-gradient-to-r from-slate-700 to-teal-500 hover:from-slate-800 hover:to-teal-600 dark:from-slate-700 dark:to-teal-600 font-medium shadow-md hover:shadow-lg transition-all duration-200 disabled:opacity-70 disabled:cursor-not-allowed"},m.value?e("span",null,{class:"flex items-center"},[d(Ie,{class:"animate-spin mr-2 h-5 w-5 text-white",[a]:{class:a}},3,"eD_1"),"Verifying..."],1,"eD_2"):"Continue",1,null)],[a]:{action:a,class:a,onSubmit$:a}},1,"eD_3"),r.value==="password"&&d(ee,{action:n,class:"space-y-6",onSubmit$:g(hs,"s_90k8QQrQSdk",[u,m,n]),children:[e("input",null,{type:"hidden",name:"email",value:y(p=>p.value,[i],"p0.value")},null,3,null),e("div",null,{class:"space-y-2"},[e("label",null,{for:"password",class:"block text-sm font-medium text-slate-700 dark:text-slate-200"},"Password",3,null),e("div",null,{class:"relative"},[e("div",null,{class:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"},d(Oe,{class:"h-5 w-5 text-slate-400 dark:text-slate-500",[a]:{class:a}},3,"eD_4"),1,null),e("input",null,{id:"password",name:"password",type:"password",required:!0,class:"pl-10 block w-full rounded-xl border-0 py-3 text-slate-700 dark:text-white shadow-sm ring-1 ring-inset ring-slate-300 dark:ring-slate-600 placeholder:text-slate-400 dark:placeholder:text-slate-500 focus:ring-2 focus:ring-inset focus:ring-teal-500 dark:focus:ring-teal-400 bg-white dark:bg-gray-800",placeholder:"••••••••"},null,3,null)],1,null)],1,null),e("div",null,{class:"flex justify-between items-center"},[e("button",null,{type:"button",class:"flex items-center px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-800 transition-all duration-200 text-sm",onClick$:w("s_SkMVgm4N03A",[u,o,r])},[d(Qe,{class:"mr-2 h-4 w-4",[a]:{class:a}},3,"eD_5"),"Back"],1,null),e("button",null,{type:"submit",disabled:y(p=>p.value,[m],"p0.value"),class:"flex justify-center items-center py-2 px-6 rounded-lg text-white bg-gradient-to-r from-slate-700 to-teal-500 hover:from-slate-800 hover:to-teal-600 dark:from-slate-700 dark:to-teal-600 font-medium shadow-md hover:shadow-lg transition-all duration-200 disabled:opacity-70 disabled:cursor-not-allowed"},m.value?e("span",null,{class:"flex items-center"},[d(Ie,{class:"animate-spin mr-2 h-5 w-5 text-white",[a]:{class:a}},3,"eD_6"),"Signing in..."],1,"eD_7"):"Sign in",1,null)],1,null)],[a]:{action:a,class:a,onSubmit$:a}},1,"eD_8"),r.value==="register"&&d(ee,{action:s,class:"space-y-6",onSubmit$:g(vs,"s_3ewRqCLfpMg",[u,m,s]),children:[e("input",null,{type:"hidden",name:"email",value:y(p=>p.value,[i],"p0.value")},null,3,null),e("div",null,{class:"space-y-2"},[e("label",null,{for:"password",class:"block text-sm font-medium text-slate-700 dark:text-slate-200"},"Create a password",3,null),e("div",null,{class:"relative"},[e("div",null,{class:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"},d(Oe,{class:"h-5 w-5 text-slate-400 dark:text-slate-500",[a]:{class:a}},3,"eD_9"),1,null),e("input",null,{id:"password",name:"password",type:"password",required:!0,class:"pl-10 block w-full rounded-xl border-0 py-3 text-slate-700 dark:text-white shadow-sm ring-1 ring-inset ring-slate-300 dark:ring-slate-600 placeholder:text-slate-400 dark:placeholder:text-slate-500 focus:ring-2 focus:ring-inset focus:ring-teal-500 dark:focus:ring-teal-400 bg-white dark:bg-gray-800",placeholder:"••••••••",minLength:6},null,3,null)],1,null),e("p",null,{class:"text-xs text-slate-500 dark:text-slate-400 mt-1"},"Password must be at least 6 characters",3,null)],1,null),e("div",null,{class:"flex justify-between items-center"},[e("button",null,{type:"button",class:"flex items-center px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-800 transition-all duration-200 text-sm",onClick$:w("s_sFCb2F6Zv7w",[u,o,r])},[d(Qe,{class:"mr-2 h-4 w-4",[a]:{class:a}},3,"eD_10"),"Back"],1,null),e("button",null,{type:"submit",disabled:y(p=>p.value,[m],"p0.value"),class:"flex justify-center items-center py-2 px-6 rounded-lg text-white bg-gradient-to-r from-slate-700 to-teal-500 hover:from-slate-800 hover:to-teal-600 dark:from-slate-700 dark:to-teal-600 font-medium shadow-md hover:shadow-lg transition-all duration-200 disabled:opacity-70 disabled:cursor-not-allowed"},m.value?e("span",null,{class:"flex items-center"},[d(Ie,{class:"animate-spin mr-2 h-5 w-5 text-white",[a]:{class:a}},3,"eD_11"),"Creating account..."],1,"eD_12"):"Create account",1,null)],1,null)],[a]:{action:a,class:a,onSubmit$:a}},1,"eD_13"),u.value&&e("div",null,{class:"mt-6 p-4 bg-rose-50 dark:bg-rose-900/20 border border-rose-200 dark:border-rose-800 rounded-xl animate-[slide-up_0.3s_ease-out]"},e("div",null,{class:"flex items-start"},[d(cl,{class:"h-5 w-5 text-rose-500 dark:text-rose-400 mt-0.5 mr-2 flex-shrink-0",[a]:{class:a}},3,"eD_14"),e("p",null,{class:"text-sm text-rose-600 dark:text-rose-300"},y(p=>p.value,[u],"p0.value"),3,null)],1,null),1,"eD_15")],1,null),1,null),e("div",null,{class:"mt-6 text-center text-sm text-slate-600 dark:text-slate-400"},["By continuing, you agree to our",e("a",null,{href:"#",class:"text-teal-600 hover:text-teal-500 dark:text-teal-400 dark:hover:text-teal-300 ml-1"},"Terms of Service",3,null),e("span",null,{class:"mx-1"},"and",3,null),e("a",null,{href:"#",class:"text-teal-600 hover:text-teal-500 dark:text-teal-400 dark:hover:text-teal-300"},"Privacy Policy",3,null)],3,null),e("style",null,null,`
        .animate-fade-in { animation: fadeIn 1s both; }
        .animate-slide-down { animation: slideDown 0.8s both; }
        .animate-slide-up { animation: slideUp 0.7s both; }
        .animate-grow-in { animation: growIn 1.2s both; }
        .animate-pop { animation: popIn 0.5s both; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-40px); } to { opacity: 1, transform: translateY(0); } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(40px); } to { opacity: 1, transform: translateY(0); } }
        @keyframes growIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1, transform: scale(1); } }
        @keyframes popIn { 0% { transform: scale(0.7); opacity: 0; } 80% { transform: scale(1.1); opacity: 1; } 100% { transform: scale(1); } }
      `,3,null)],1,"eD_16")},ks=te(g(ws,"s_86Uj5I0HEKo")),ys=Object.freeze(Object.defineProperty({__proto__:null,default:ks,useCheckEmail:bt,useDbInitializer:Ue,useLogin:vt,useLogout:ms,useRegister:ht},Symbol.toStringTag,{value:"Module"}));function ie(t){return t?"is_admin"in t&&typeof t.is_admin=="boolean"?t.is_admin:"role"in t&&typeof t.role=="string"?t.role==="admin"||t.role==="super_admin":!1:!1}const _s=async t=>{const l=await H(t);if(!l.isAuthenticated)return t.fail(401,{error:"Unauthorized"});const s=F(t);let n=`SELECT c.id, c.professional_id, p.name as professional_name, p.email as professional_email, c.start_date, c.end_date, c.status, c.contract_url, c.created_at 
    FROM contracts c
    JOIN professionals p ON c.professional_id = p.id`,r=[];return ie(l)||(n+=" WHERE p.email = ?",r.push(l.email)),n+=" ORDER BY c.start_date DESC",{contracts:(await s.execute({sql:n,args:r})).rows.map(u=>({id:typeof u.id=="number"?u.id:0,professional_id:typeof u.professional_id=="number"?u.professional_id:0,professional_name:typeof u.professional_name=="string"?u.professional_name:"N/A",professional_email:typeof u.professional_email=="string"?u.professional_email:"N/A",start_date:typeof u.start_date=="string"?u.start_date:"",end_date:typeof u.end_date=="string"?u.end_date:"",status:typeof u.status=="string"?u.status:"unknown",contract_url:typeof u.contract_url=="string"?u.contract_url:null,created_at:typeof u.created_at=="string"?u.created_at:""})),session:l}},wt=V(g(_s,"s_pOtMp0xpTww")),Ts=async t=>(await F(t).execute("SELECT id, name, role FROM professionals")).rows,kt=V(g(Ts,"s_f6iI4LuEstI")),Ss=async(t,l)=>{const s=F(l),n=await H(l);if(!n.isAuthenticated||!n.userId)return l.redirect(303,"/auth");let r=t.professionalId;if(!ie(n)){const i=await s.execute({sql:"SELECT id FROM professionals WHERE user_id = ?",args:[n.userId]});if(!i.rows.length)return l.fail(403,{error:"No professional profile found for this user."});r=String(i.rows[0].id)}try{return await s.execute({sql:"INSERT INTO contracts (professional_id, user_id, start_date, end_date, status, contract_url) VALUES (?, ?, ?, ?, ?, ?)",args:[r||"",n.userId,t.startDate,t.endDate,"active",t.contractUrl??null]}),{success:!0}}catch(i){return console.error("Failed to create contract:",i),{success:!1,error:"Failed to create contract."}}},Es=t=>t.object({professionalId:t.string().optional(),startDate:t.string().min(1,"Start date is required."),endDate:t.string().min(1,"End date is required."),contractUrl:t.string().optional().nullable()}),yt=Y(g(Ss,"s_LIYrlyegNzI"),ne(g(Es,"s_JXXcjSD3j1E"))),Cs=async({id:t},l)=>{const s=F(l),n=await H(l);if(!n.isAuthenticated||!ie(n))return{success:!1,error:"Only admin can delete contracts."};try{return await s.execute({sql:"DELETE FROM contracts WHERE id = ?",args:[t]}),{success:!0}}catch{return{success:!1,error:"Failed to delete contract."}}},Ds=t=>({id:t.coerce.number()}),_t=Y(g(Cs,"s_z5Odx0MVSAI"),ne(g(Ds,"s_ZhFTjvFjIow"))),Rs=({track:t})=>{const[l]=O(),s=t(()=>l.value);s&&!("failed"in s&&s.failed)&&!("formErrors"in s&&Array.isArray(s.formErrors)&&s.formErrors.length>0)&&typeof window<"u"&&window.location.reload()},Is=({track:t})=>{const[l,s,n]=O(),r=t(()=>s.value);r!=null&&r.success&&(n.value=!1,l.value=null,typeof window<"u"&&window.location.reload())},As=({track:t})=>{const[l,s,n]=O();let r=t(()=>l);r=[...r].sort((o,u)=>{const m=o.start_date?new Date(o.start_date).getTime():0;return(u.start_date?new Date(u.start_date).getTime():0)-m});const i=t(()=>n.value.trim().toLowerCase());i?s.value=r.filter(o=>o.professional_name.toLowerCase().includes(i)||o.professional_email.toLowerCase().includes(i)||o.id.toString().includes(i)||o.status.toLowerCase().includes(i)):s.value=r},Ls=()=>{const[t,l,s,n,r,i,o,u]=O();i.value="",o.value="",s.value="",l.value=null,t.value="",r.value=!1,u.value="",n.value&&(n.value.value="")},Ms=async t=>{const[l,s,n,r]=O(),i=t.target;if(!i.files||i.files.length===0)return;const o=i.files[0];if(o.type!=="application/pdf"){r.value="Only PDF files are allowed.";return}n.value=!0,r.value="";const u=new FormData;u.append("contract",o);try{const m=await fetch("/api/upload-contract",{method:"POST",body:u});if(!m.ok){let p="Upload failed";try{const h=await m.json();h&&typeof h.error=="string"&&h.error.length>0&&(p=h.error)}catch{}throw new Error(p)}const c=await m.json();s.value=c.fileName||"",l.value=c.fileName?`/api/contracts/view/${c.fileName}`:""}catch(m){r.value=m&&typeof m.message=="string"&&m.message.length>0?m.message:"An unexpected error occurred.",s.value=null,l.value=""}finally{n.value=!1}},Os=()=>{const[t,l]=O();l.value=!1,t()},Ps=()=>{var G,k,L;X();const t=wt(),l=kt(),s=yt(),n=_t(),r=b(!1),i=b(null);ce(g(Rs,"s_vbBz20uaL9Q",[s])),ce(g(Is,"s_0p2McuoVgUs",[i,n,r]));const o=((G=t.value)==null?void 0:G.contracts)??[],u=(k=t.value)==null?void 0:k.session,m=!!u&&ie(u);let c=null;!m&&o.length>0&&(c=String(o[0].professional_id)),typeof window<"u"&&(console.log("[DEBUG contracts] isAdminUser:",m),console.log("[DEBUG contracts] userProfessionalId:",c),console.log("[DEBUG contracts] contracts:",o),console.log("[DEBUG contracts] professionals.value:",l.value));const p=b(""),h=b(!1),v=b(""),_=b(""),T=b(""),E=b(null),I=b(""),D=b(!1),R=b(""),N=b(),S=b(o);ce(g(As,"s_kWuVui609es",[o,S,p]));const $=g(Ls,"s_g0LwifoYHg8",[I,E,T,N,D,v,_,R]),C=g(Ms,"s_cm8OO2jiQek",[I,E,D,R]),z=f=>{if(!f)return"N/A";const q=new Date(f),W=q.getTimezoneOffset()*6e4;return new Date(q.getTime()+W).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})};return e("main",null,{class:"min-h-screen bg-gradient-to-br from-slate-50 via-slate-100 to-slate-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900"},[e("div",null,{class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},[e("header",null,{class:"mb-8 bg-gradient-to-r from-slate-100 to-slate-50 dark:from-slate-800 dark:to-slate-700 rounded-xl shadow-sm p-6"},e("div",null,{class:"flex flex-col sm:flex-row sm:items-center sm:justify-between"},[e("div",null,{class:"flex items-center"},[d(Ee,{class:"h-8 w-8 text-teal-600 dark:text-teal-500 mr-3",[a]:{class:a}},3,"d3_0"),e("div",null,null,[e("h1",null,{class:"text-2xl sm:text-3xl font-bold text-slate-800 dark:text-slate-100"},"Contracts",3,null),e("p",null,{class:"text-slate-500 dark:text-slate-400 mt-1"},"Manage contracts with professionals",3,null)],3,null)],1,null),e("div",null,{class:"mt-4 sm:mt-0 flex flex-col sm:flex-row gap-3"},m&&e("button",{onClick$:w("s_3D44dgnfvmk",[m,h])},{class:"inline-flex items-center justify-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-gradient-to-r from-teal-500 to-teal-600 hover:from-teal-600 hover:to-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 transition-all duration-200"},[d(Ae,{class:"mr-2 h-4 w-4",[a]:{class:a}},3,"d3_1"),"Create Contract"],0,"d3_2"),1,null)],1,null),1,null),e("div",null,{class:"mb-6"},e("div",null,{class:"flex flex-col sm:flex-row gap-4 bg-white dark:bg-slate-800 rounded-lg shadow-sm p-4 border border-slate-100 dark:border-slate-700"},e("div",null,{class:"relative flex-1"},[e("div",null,{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},d(ze,{class:"h-5 w-5 text-slate-400 dark:text-slate-500",[a]:{class:a}},3,"d3_3"),1,null),e("input",null,{type:"text",value:p,class:"block w-full pl-10 pr-3 py-2 border border-slate-200 dark:border-slate-600 rounded-md bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 placeholder-slate-400 shadow-sm hover:border-teal-400 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm transition-all duration-200",placeholder:"Search by professional or ID...",onInput$:w("s_fr6YtxdVoQM",[p])},null,3,null)],1,null),1,null),1,null),e("div",null,{class:"bg-white dark:bg-slate-800 shadow-lg rounded-xl overflow-hidden border border-slate-200 dark:border-slate-700"},[e("div",null,{class:"overflow-x-auto"},e("table",null,{class:"min-w-full divide-y divide-slate-200 dark:divide-slate-700"},[e("thead",null,{class:"bg-gradient-to-r from-slate-100 to-slate-50 dark:from-slate-800 dark:to-slate-700"},e("tr",null,null,[e("th",null,{scope:"col",class:"px-6 py-4 text-left text-xs font-medium text-slate-600 dark:text-slate-300 uppercase tracking-wider"},"ID",3,null),e("th",null,{scope:"col",class:"px-6 py-4 text-left text-xs font-medium text-slate-600 dark:text-slate-300 uppercase tracking-wider"},"Professional",3,null),e("th",null,{scope:"col",class:"px-6 py-4 text-left text-xs font-medium text-slate-600 dark:text-slate-300 uppercase tracking-wider"},"Email",3,null),e("th",null,{scope:"col",class:"px-6 py-4 text-left text-xs font-medium text-slate-600 dark:text-slate-300 uppercase tracking-wider"},"Start Date",3,null),e("th",null,{scope:"col",class:"px-6 py-4 text-left text-xs font-medium text-slate-600 dark:text-slate-300 uppercase tracking-wider"},"End Date",3,null),e("th",null,{scope:"col",class:"px-6 py-4 text-left text-xs font-medium text-slate-600 dark:text-slate-300 uppercase tracking-wider"},"Created At",3,null),e("th",null,{scope:"col",class:"px-6 py-4 text-left text-xs font-medium text-slate-600 dark:text-slate-300 uppercase tracking-wider"},"Status",3,null),e("th",null,{scope:"col",class:"px-6 py-4 text-right text-xs font-medium text-slate-600 dark:text-slate-300 uppercase tracking-wider"},"Actions",3,null)],3,null),3,null),e("tbody",null,{class:"bg-white dark:bg-slate-800 divide-y divide-slate-200 dark:divide-slate-700"},Array.isArray(S.value)?S.value.map(f=>{var W,Q;X();const q=typeof f.contract_url=="string"?f.contract_url:null;return e("tr",null,{class:"hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-all duration-200 group"},[e("td",null,{class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-700 dark:text-slate-200 group-hover:text-teal-600 dark:group-hover:text-teal-500"},["#CONT-",f.id.toString().padStart(3,"0")],1,null),e("td",null,{class:"px-6 py-4 whitespace-nowrap text-sm text-slate-700 dark:text-slate-200 font-medium"},f.professional_name||"N/A",1,null),e("td",null,{class:"px-6 py-4 whitespace-nowrap text-sm text-slate-600 dark:text-slate-300"},f.professional_email||"N/A",1,null),e("td",null,{class:"px-6 py-4 whitespace-nowrap text-sm text-slate-600 dark:text-slate-300"},z(f.start_date),1,null),e("td",null,{class:"px-6 py-4 whitespace-nowrap text-sm text-slate-600 dark:text-slate-300"},z(f.end_date),1,null),e("td",null,{class:"px-6 py-4 whitespace-nowrap text-sm text-slate-600 dark:text-slate-300"},z(f.created_at),1,null),e("td",null,{class:"px-6 py-4 whitespace-nowrap"},e("span",{class:`px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${f.status==="active"?"bg-gradient-to-r from-emerald-50 to-emerald-100 text-emerald-700 dark:from-emerald-900/30 dark:to-emerald-800/30 dark:text-emerald-400":"bg-gradient-to-r from-rose-50 to-rose-100 text-rose-700 dark:from-rose-900/30 dark:to-rose-800/30 dark:text-rose-400"}`},null,((W=f.status)==null?void 0:W.charAt(0).toUpperCase())+((Q=f.status)==null?void 0:Q.slice(1))||"N/A",1,null),1,null),e("td",null,{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},e("div",null,{class:"flex justify-end space-x-2"},[q?e("a",{href:`/api/contracts/view/${q}`},{target:"_blank",rel:"noopener noreferrer",class:"p-1.5 text-slate-600 dark:text-slate-400 hover:text-teal-600 hover:bg-teal-50 dark:hover:text-teal-400 dark:hover:bg-teal-900/20 rounded-full transition-all",title:"View Contract"},d(Ce,{class:"h-5 w-5",[a]:{class:a}},3,"d3_4"),1,"d3_5"):e("button",null,{class:"p-1.5 text-slate-400 dark:text-slate-600 rounded-full transition-all cursor-not-allowed",disabled:!0,title:"No contract uploaded"},d(Ce,{class:"h-5 w-5",[a]:{class:a}},3,"d3_6"),1,null),m&&e("button",{onClick$:w("s_wGZkWESpGhY",[f,i,r])},{class:"p-1.5 text-slate-600 dark:text-slate-400 hover:text-red-600 hover:bg-red-50 dark:hover:text-red-400 dark:hover:bg-red-900/20 rounded-full transition-all",title:"Delete Contract"},d(ke,{class:"h-5 w-5",[a]:{class:a}},3,"d3_7"),0,"d3_8")],1,null),1,null)],1,f.id)}):e("tr",null,null,e("td",null,{colSpan:6,class:"text-center text-red-500 py-8"},"Error loading contracts. Please try again.",3,null),3,"d3_9"),1,null)],1,null),1,null),S.value.length===0&&e("div",null,{class:"px-6 py-12 text-center"},[e("div",null,{class:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-slate-100 dark:bg-slate-700/50 mb-4"},d(Ee,{class:"w-8 h-8 text-slate-400 dark:text-slate-500",[a]:{class:a}},3,"d3_10"),1,null),e("p",null,{class:"text-slate-500 dark:text-slate-400 font-medium"},"No contracts found.",3,null),e("p",null,{class:"text-slate-400 dark:text-slate-500 mt-1 text-sm"},"Create a new contract to get started.",3,null)],1,"d3_11")],1,null),e("div",null,{class:"flex items-center justify-between mt-6 bg-white dark:bg-slate-800 p-4 rounded-lg shadow-sm border border-slate-100 dark:border-slate-700"},e("div",null,{class:"text-sm text-slate-600 dark:text-slate-400"},["Showing ",e("span",null,{class:"font-medium text-teal-600 dark:text-teal-500"},y(f=>f.value.length,[S],"p0.value.length"),3,null)," of ",e("span",null,{class:"font-medium text-teal-600 dark:text-teal-500"},A(o,"length"),1,null)," contracts"],1,null),1,null)],1,null),h.value&&e("div",null,{class:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},e("div",null,{class:"flex items-end sm:items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},[e("div",null,{class:"fixed inset-0 bg-slate-700/70 dark:bg-slate-900/80 backdrop-blur-md transition-opacity","aria-hidden":"true",onClick$:w("s_vbDtEMOt8dg",[h])},null,3,null),e("div",null,{class:"inline-block align-bottom bg-white/95 dark:bg-slate-800/95 backdrop-blur-md rounded-xl text-left overflow-hidden shadow-2xl transform transition-all border border-slate-100/50 dark:border-slate-700/50 sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},d(ee,{action:s,onSubmitCompleted$:g(Os,"s_wxLSoFiDGro",[$,h]),children:[e("div",null,{class:"px-6 pt-5 pb-4 sm:p-6 sm:pb-4"},e("div",null,{class:"sm:flex sm:items-start"},e("div",null,{class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full"},[e("h3",null,{class:"text-xl leading-6 font-medium text-slate-800 dark:text-slate-100",id:"modal-title"},"Create New Contract",3,null),e("div",null,{class:"mt-4"},e("div",null,{class:"space-y-4"},[m?e("div",null,null,[e("label",null,{for:"professional",class:"block text-sm font-medium text-slate-700 dark:text-slate-300"},"Professional",3,null),e("select",null,{name:"professionalId",id:"professional",value:v,class:"mt-1 block w-full pl-3 pr-10 py-3 text-base border border-slate-300 dark:border-slate-600 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm rounded-lg bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 shadow-sm transition-all",required:!0,onInput$:w("s_K0awB0bLaxM",[v])},[e("option",null,{value:""},"Select a professional",3,null),l.value.map(f=>e("option",{value:A(f,"id")},null,`${f.name} - ${f.role}`,1,`prof-${f.id}`))],1,null)],1,"d3_12"):e("input",{value:c??""},{type:"hidden",name:"professionalId"},null,3,null),e("div",null,{class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},[e("div",null,null,[e("label",null,{for:"start-date",class:"block text-sm font-medium text-slate-700 dark:text-slate-300"},"Start Date",3,null),e("input",null,{type:"date",name:"startDate",id:"start-date",value:_,class:"mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm py-3 px-3 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm transition-all",required:!0,onInput$:w("s_MJ0xPQa0QLc",[_])},null,3,null)],3,null),e("div",null,null,[e("label",null,{for:"end-date",class:"block text-sm font-medium text-slate-700 dark:text-slate-300"},"End Date",3,null),e("input",null,{type:"date",name:"endDate",id:"end-date",value:T,class:"mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm py-3 px-3 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm transition-all",required:!0,onInput$:w("s_PFNm876R0OE",[T])},null,3,null)],3,null)],3,null),e("div",null,null,[e("label",null,{class:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1"},"Contract PDF",3,null),I.value?e("div",null,{class:"mt-2"},[e("div",null,{class:"relative h-64 w-full rounded-lg border border-slate-300 dark:border-slate-600 overflow-hidden group"},[e("iframe",null,{src:y(f=>f.value,[I],"p0.value"),class:"h-full w-full",title:"Contract Preview"},null,3,null),e("a",null,{href:y(f=>f.value,[I],"p0.value"),target:"_blank",rel:"noopener noreferrer",class:"absolute top-2 right-2 p-2 bg-slate-700/50 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",title:"Open in new tab"},d(dt,{class:"h-5 w-5",[a]:{class:a}},3,"d3_13"),1,null)],1,null),e("button",null,{type:"button",class:"mt-2 inline-flex items-center text-sm font-medium text-red-600 hover:text-red-800 dark:text-red-500 dark:hover:text-red-400",onClick$:w("s_QAjq0gRc9qQ",[I,E,N])},[d(ke,{class:"mr-1.5 h-4 w-4",[a]:{class:a}},3,"d3_14"),"Remove PDF"],1,null)],1,"d3_15"):e("div",null,{class:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-slate-300 dark:border-slate-600 border-dashed rounded-lg"},e("div",null,{class:"space-y-1 text-center"},[D.value?d(oe,{class:"mx-auto h-12 w-12 text-slate-400 animate-spin",[a]:{class:a}},3,"d3_16"):d(ct,{class:"mx-auto h-12 w-12 text-slate-400",[a]:{class:a}},3,"d3_17"),e("div",null,{class:"flex text-sm text-slate-600 dark:text-slate-400"},[e("label",null,{for:"file-upload",class:"relative cursor-pointer bg-white dark:bg-slate-800 rounded-md font-medium text-teal-600 dark:text-teal-500 hover:text-teal-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-teal-500"},[e("span",null,null,"Upload a file",3,null),e("input",{ref:N},{id:"file-upload",name:"file-upload",type:"file",class:"sr-only",accept:"application/pdf",disabled:y(f=>f.value,[D],"p0.value"),onChange$:C},null,3,null)],1,null),e("p",null,{class:"pl-1"},"or drag and drop",3,null)],1,null),e("p",null,{class:"text-xs text-slate-500 dark:text-slate-500"},"PDF up to 10MB",3,null)],1,null),1,null),R.value&&e("p",null,{class:"mt-2 text-sm text-red-600 dark:text-red-500"},y(f=>f.value,[R],"p0.value"),3,"d3_18"),e("input",null,{type:"hidden",name:"contractUrl",value:y(f=>f.value??"",[E],'p0.value??""')},null,3,null)],1,null)],1,null),1,null)],1,null),1,null),1,null),e("div",null,{class:"bg-gradient-to-r from-slate-50 to-slate-100 dark:from-slate-700 dark:to-slate-800 px-6 py-4 sm:flex sm:flex-row-reverse"},[e("button",null,{type:"submit",disabled:y((f,q)=>f.isRunning||q.value,[s,D],"p0.isRunning||p1.value"),class:"w-full inline-flex justify-center items-center rounded-lg border border-transparent shadow-sm px-5 py-2.5 bg-gradient-to-r from-teal-500 to-teal-600 text-base font-medium text-white hover:from-teal-600 hover:to-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 sm:ml-3 sm:w-auto sm:text-sm transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed"},[s.isRunning?d(oe,{class:"animate-spin h-5 w-5 mr-2",[a]:{class:a}},3,"d3_19"):d(Te,{class:"h-5 w-5 mr-2",[a]:{class:a}},3,"d3_20"),"Save Contract"],1,null),e("button",null,{type:"button",class:"mt-3 w-full inline-flex justify-center items-center rounded-lg border border-slate-200 dark:border-slate-600 shadow-sm px-5 py-2.5 bg-white dark:bg-slate-800 text-base font-medium text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm transition-all duration-200",onClick$:w("s_C788vIi2DC8",[$,h])},[d(fe,{class:"h-5 w-5 mr-2",[a]:{class:a}},3,"d3_21"),"Cancel"],1,null)],1,null),s.value&&("success"in s.value&&s.value.success===!1||"failed"in s.value&&s.value.failed)&&e("div",null,{class:"p-4 bg-red-100 text-red-800 rounded-b-lg"},[d(ae,{class:"inline h-5 w-5 mr-2",[a]:{class:a}},3,"d3_22"),"error"in s.value&&typeof s.value.error=="string"&&s.value.error.length>0?e("span",null,null,y(f=>f.value.error,[s],"p0.value.error"),3,"d3_23"):null,Array.isArray(s.value.formErrors)&&s.value.formErrors.length>0&&e("ul",null,{class:"mt-2 list-disc list-inside text-sm"},s.value.formErrors.map(f=>e("li",null,null,f,1,"d3_24")),1,"d3_25"),typeof s.value.fieldErrors=="object"&&s.value.fieldErrors!==null&&e("ul",null,{class:"mt-2 list-disc list-inside text-sm"},Object.entries(s.value.fieldErrors).map(([f,q])=>Array.isArray(q)&&q.length>0?e("li",null,null,[e("b",null,null,[f,":"],1,null)," ",q.join(", ")],1,f):null),1,"d3_26")],1,"d3_27")],[a]:{action:a,onSubmitCompleted$:a}},1,"d3_28"),1,null)],1,null),1,"d3_29"),r.value&&e("div",null,{class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"},e("div",null,{class:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl w-full max-w-md mx-4 sm:mx-auto z-10 overflow-hidden"},[e("div",null,{class:"bg-gradient-to-r from-red-500 to-red-600 py-6 px-6"},[e("h3",null,{class:"text-xl font-semibold text-white flex items-center"},[d(ke,{class:"h-5 w-5 mr-2",[a]:{class:a}},3,"d3_30"),"Confirm Delete"],1,null),e("p",null,{class:"text-red-100 text-sm mt-1"},"This action cannot be undone",3,null)],1,null),d(ee,{action:n,children:[e("div",null,{class:"p-6"},[e("input",null,{type:"hidden",name:"id",value:y(f=>f.value,[i],"p0.value")},null,3,null),e("div",null,{class:"text-center mb-6"},[e("div",null,{class:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 dark:bg-red-900/30"},d(ke,{class:"h-6 w-6 text-red-600 dark:text-red-500",[a]:{class:a}},3,"d3_31"),1,null),e("h3",null,{class:"mt-3 text-lg font-medium text-slate-900 dark:text-slate-100"},"Delete Contract",3,null),e("p",null,{class:"mt-2 text-sm text-slate-500 dark:text-slate-400"},"Are you sure you want to delete this contract? This action cannot be undone.",3,null)],1,null)],1,null),e("div",null,{class:"bg-gradient-to-r from-slate-50 to-slate-100 dark:from-slate-700 dark:to-slate-800 px-6 py-4 sm:flex sm:flex-row-reverse"},[e("button",null,{type:"submit",disabled:y(f=>f.isRunning,[n],"p0.isRunning"),class:"w-full inline-flex justify-center items-center rounded-lg border border-transparent shadow-sm px-5 py-2.5 bg-gradient-to-r from-red-500 to-red-600 text-base font-medium text-white hover:from-red-600 hover:to-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm transition-all duration-200 disabled:opacity-50"},[n.isRunning?d(oe,{class:"animate-spin h-5 w-5 mr-2",[a]:{class:a}},3,"d3_32"):d(ke,{class:"h-5 w-5 mr-2",[a]:{class:a}},3,"d3_33"),"Delete"],1,null),e("button",null,{type:"button",class:"mt-3 w-full inline-flex justify-center items-center rounded-lg border border-slate-200 dark:border-slate-600 shadow-sm px-5 py-2.5 bg-white dark:bg-slate-800 text-base font-medium text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm transition-all duration-200",onClick$:w("s_sOKtep2iToA",[r])},[d(fe,{class:"h-5 w-5 mr-2",[a]:{class:a}},3,"d3_34"),"Cancel"],1,null)],1,null),((L=n.value)==null?void 0:L.success)===!1&&e("div",null,{class:"p-4 bg-red-100 text-red-800 rounded-b-lg"},[d(ae,{class:"inline h-5 w-5 mr-2",[a]:{class:a}},3,"d3_35"),y(f=>f.value.error,[n],"p0.value.error")],1,"d3_36")],[a]:{action:a}},1,"d3_37")],1,null),1,"d3_38")],1,"d3_39")},js=te(g(Ps,"s_bsFwD0XY188")),Us=Object.freeze(Object.defineProperty({__proto__:null,default:js,useContractsLoader:wt,useCreateContract:yt,useDeleteContract:_t,useProfessionalsLoader:kt},Symbol.toStringTag,{value:"Module"})),Ns=async t=>{const l=await H(t);if(!(l!=null&&l.isAuthenticated))throw t.redirect(302,"/auth");return l},Tt=V(g(Ns,"s_0RlA56KjQ2c")),$s=async t=>{const l=F(t),s=await H(t);let n;s.isAuthenticated&&s.role==="admin"?n=await l.execute(`
      SELECT i.id, i.professional_id, p.name as professional_name, i.contract_id, i.amount, i.currency, i.status, i.issue_date, i.paid_date, i.invoice_url, i.created_date 
      FROM invoices i
      JOIN professionals p ON i.professional_id = p.id
      ORDER BY i.created_date DESC
    `):s.isAuthenticated&&s.email?n=await l.execute({sql:`SELECT i.id, i.professional_id, p.name as professional_name, i.contract_id, i.amount, i.currency, i.status, i.issue_date, i.paid_date, i.invoice_url, i.created_date 
            FROM invoices i
            JOIN professionals p ON i.professional_id = p.id
            JOIN contracts c ON i.contract_id = c.id
            WHERE p.email = ?
            ORDER BY i.created_date DESC`,args:[s.email]}):n={rows:[]};const r=await l.execute("SELECT id, name, role FROM professionals ORDER BY name"),i=await l.execute(`
    SELECT c.id, c.professional_id, p.name as professional_name, c.start_date, c.end_date
    FROM contracts c
    JOIN professionals p ON c.professional_id = p.id
    WHERE c.status = 'active'
    ORDER BY p.name, c.start_date DESC
  `);return{invoices:n.rows.map(o=>({...o,amount:Number(o.amount)})),professionals:r.rows,contracts:i.rows}},St=V(g($s,"s_ZuT2HY9zmpM")),Fs=async(t,l)=>{const s=F(l),n=await H(l);if(!n.isAuthenticated||!n.userId)return{success:!1,error:"Authentication required."};const r=await s.execute({sql:"SELECT professional_id FROM contracts WHERE id = ?",args:[t.contractId]});if(r.rows.length===0)return{success:!1,error:"Contract not found."};const i=r.rows[0].professional_id;try{const o=new Date().toISOString();return await s.execute({sql:"INSERT INTO invoices (contract_id, professional_id, user_id, issue_date, amount, currency, status, paid_date, invoice_url, created_date) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)",args:[t.contractId,i,n.userId,t.issueDate,t.amount,t.currency,t.status,t.status==="paid"?new Date().toISOString().split("T")[0]:null,t.invoiceUrl,o]}),{success:!0}}catch(o){return console.error("Failed to add invoice:",o),{success:!1,error:"Failed to add invoice."}}},qs={contractId:U.coerce.number().int().positive(),issueDate:U.string().regex(/^\d{4}-\d{2}-\d{2}$/),amount:U.coerce.number().positive(),currency:U.string(),status:U.enum(["pending","paid"]),invoiceUrl:U.string().optional().nullable()},Et=Y(g(Fs,"s_8G0MNZu2NZ0"),ne(g(qs,"s_H13o942bCtI"))),Bs=async({id:t,status:l},s)=>{const n=F(s),r=l==="paid"?"pending":"paid",i=r==="paid"?new Date().toISOString().split("T")[0]:null;try{return await n.execute({sql:"UPDATE invoices SET status = ?, paid_date = ? WHERE id = ?",args:[r,i,t]}),{success:!0}}catch(o){return console.error("Failed to update invoice status:",o),{success:!1,error:"Failed to update status."}}},zs={id:U.coerce.number(),status:U.enum(["pending","paid"])},Ct=Y(g(Bs,"s_Ti9m9weHHSs"),ne(g(zs,"s_CVqZ0lQFoCg"))),Hs=async({id:t},l)=>{const s=F(l);try{return await s.execute({sql:"DELETE FROM invoices WHERE id = ?",args:[t]}),{success:!0}}catch(n){return console.error("Failed to delete invoice:",n),{success:!1,error:"Failed to delete invoice."}}},Ws={id:U.coerce.number()},Dt=Y(g(Hs,"s_c4Qyl0s0PVo"),ne(g(Ws,"s_4ZbqH5h4Ri4"))),Ys=({track:t})=>{const[l,s,n]=O();t(()=>s.value.invoices),t(()=>n.value);const r=n.value.toLowerCase();let i=s.value.invoices;r&&(i=i.filter(o=>o.professional_name.toLowerCase().includes(r))),l.value=[...i].sort((o,u)=>{const m=o.created_date?new Date(o.created_date).getTime():0;return(u.created_date?new Date(u.created_date).getTime():0)-m})},Vs=({track:t})=>{const[l,s,n]=O();t(()=>l.value.invoices),n.value=l.value.invoices.filter(r=>r.status==="pending").reduce((r,i)=>r+i.amount,0),s.value=l.value.invoices.filter(r=>r.status==="paid").reduce((r,i)=>r+i.amount,0)},Qs=()=>{const[t,l,s,n,r,i,o,u,m,c,p]=O();l.value="",m.value=new Date().toISOString().split("T")[0],t.value="",s.value="USD",c.value="pending",o.value=null,i.value="",u.value=!1,p.value="",r.value=null,n.value&&(n.value.value="")},Gs=async t=>{const[l,s,n,r,i]=O(),o=t.target;if(!o.files||o.files.length===0)return;const u=o.files[0];r.value=!0,i.value="";const m=new FormData;m.append("file",u);try{const c=await fetch("/api/upload-invoice",{method:"POST",body:m});if(!c.ok){const h=await c.json();throw new Error(h.error||`HTTP error! ${c.status}`)}const p=await c.json();if(p.success)n.value=p.fileName,s.value=URL.createObjectURL(u);else throw new Error(p.error||"Upload failed")}catch(c){i.value=c.message||"An unknown error occurred during upload.",l.value&&(l.value.value="")}finally{r.value=!1}},Zs=t=>{const[l,s,n,r,i,o]=O(),u={};s.value||(u.contractId="Contract is required."),(!i.value||!/^\d{4}-\d{2}-\d{2}$/.test(i.value))&&(u.issueDate="Valid issue date is required."),(!l.value||isNaN(Number(l.value))||Number(l.value)<=0)&&(u.amount="Amount must be a positive number."),n.value||(u.currency="Currency is required."),(!o.value||!["pending","paid"].includes(o.value))&&(u.status="Status must be pending or paid."),r.value=Object.keys(u).length?u:null,Object.keys(u).length&&t.preventDefault()},Js=()=>{var n;const[t,l,s]=O();(n=t.value)!=null&&n.success&&(s.value=!1,l())},Ks=()=>{var G,k,L,f,q,W,Q,Z,le,re,M,xe;X();const t=b(null),l=Tt(),s=St(),n=Et();Ct();const r=Dt(),i=b(!1),o=b(""),u=b(""),m=b(new Date().toISOString().split("T")[0]),c=b(""),p=b("USD"),h=b("pending"),v=b(null),_=b(""),T=b(!1),E=b(""),I=b(),D=b([]);ce(g(Ys,"s_09zgfJk3cKE",[D,s,o]));const R=b(0),N=b(0);ce(g(Vs,"s_Gb41b109yVk",[s,N,R]));const S=g(Qs,"s_GwAboejWJWc",[c,u,p,I,t,_,v,T,m,h,E]),$=g(Gs,"s_gJ13e1jvr0M",[I,_,v,T,E]),C=x=>{if(!x)return"-";const j=new Date(x),me=j.getTimezoneOffset()*6e4;return new Date(j.getTime()+me).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})},z=(x,j)=>j==="KNRT"?`${x.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})} KNRT`:new Intl.NumberFormat("en-US",{style:"currency",currency:j}).format(x);return e("main",null,{class:"min-h-screen bg-gradient-to-br from-slate-50 via-slate-100 to-slate-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900"},[e("div",null,{class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},[e("header",null,{class:"mb-8 bg-gradient-to-r from-slate-100 to-slate-50 dark:from-slate-800 dark:to-slate-700 rounded-xl shadow-sm p-6"},e("div",null,{class:"flex flex-col sm:flex-row sm:items-center sm:justify-between"},[e("div",null,{class:"flex items-center"},[d(he,{class:"h-8 w-8 text-teal-600 dark:text-teal-500 mr-3",[a]:{class:a}},3,"T3_0"),e("div",null,null,[e("h1",null,{class:"text-2xl sm:text-3xl font-bold text-slate-800 dark:text-slate-100"},"Invoices",3,null),e("p",null,{class:"text-slate-500 dark:text-slate-400 mt-1"},"Track and manage all payments",3,null)],3,null)],1,null),l.value.role==="admin"&&e("button",null,{class:"mt-4 sm:mt-0 inline-flex items-center justify-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-gradient-to-r from-teal-500 to-teal-600 hover:from-teal-600 hover:to-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 transition-all duration-200",onClick$:w("s_Xh7yKGgpt0Y",[i])},[d(Ae,{class:"mr-2 h-4 w-4",[a]:{class:a}},3,"T3_1"),"Add Invoice"],1,"T3_2")],1,null),1,null),e("div",null,{class:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8"},[e("div",null,{class:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-5 border border-slate-100 dark:border-slate-700"},[e("h3",null,{class:"text-sm font-medium text-slate-500 dark:text-slate-400"},"Total Invoices",3,null),e("p",null,{class:"text-2xl font-bold text-slate-800 dark:text-slate-200"},y(x=>x.value.invoices.length,[s],"p0.value.invoices.length"),3,null)],3,null),e("div",null,{class:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-5 border border-slate-100 dark:border-slate-700"},[e("h3",null,{class:"text-sm font-medium text-slate-500 dark:text-slate-400"},"Pending Payment",3,null),e("p",null,{class:"text-2xl font-bold text-amber-600 dark:text-amber-400"},z(R.value,"USD"),1,null)],1,null),e("div",null,{class:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-5 border border-slate-100 dark:border-slate-700"},[e("h3",null,{class:"text-sm font-medium text-slate-500 dark:text-slate-400"},"Total Paid",3,null),e("p",null,{class:"text-2xl font-bold text-emerald-600 dark:text-emerald-400"},z(N.value,"USD"),1,null)],1,null)],1,null),e("div",null,{class:"mb-6"},e("div",null,{class:"flex flex-col sm:flex-row gap-4 bg-white dark:bg-slate-800 rounded-lg shadow-sm p-4 border border-slate-100 dark:border-slate-700"},e("div",null,{class:"relative flex-1"},[e("div",null,{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},d(ze,{class:"h-5 w-5 text-slate-400 dark:text-slate-500",[a]:{class:a}},3,"T3_3"),1,null),e("input",null,{type:"text",value:o,class:"block w-full pl-10 pr-3 py-2 border border-slate-200 dark:border-slate-600 rounded-md bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 placeholder-slate-400 shadow-sm hover:border-teal-400 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm transition-all duration-200",placeholder:"Search by professional...",onInput$:w("s_tpWw3z3lXmM",[o])},null,3,null)],1,null),1,null),1,null),e("div",null,{class:"bg-white dark:bg-slate-800 shadow-lg rounded-xl overflow-hidden border border-slate-200 dark:border-slate-700"},[e("div",null,{class:"overflow-x-auto"},e("table",null,{class:"min-w-full divide-y divide-slate-200 dark:divide-slate-700"},[e("thead",null,{class:"bg-gradient-to-r from-slate-100 to-slate-50 dark:from-slate-800 dark:to-slate-700"},e("tr",null,null,[e("th",null,{class:"px-6 py-4 text-left text-xs font-medium text-slate-600 dark:text-slate-300 uppercase tracking-wider"},"Professional",3,null),e("th",null,{class:"px-6 py-4 text-left text-xs font-medium text-slate-600 dark:text-slate-300 uppercase tracking-wider"},"Created",3,null),e("th",null,{class:"px-6 py-4 text-left text-xs font-medium text-slate-600 dark:text-slate-300 uppercase tracking-wider"},"Issue Date",3,null),e("th",null,{class:"px-6 py-4 text-left text-xs font-medium text-slate-600 dark:text-slate-300 uppercase tracking-wider"},"Amount",3,null),e("th",null,{class:"px-6 py-4 text-left text-xs font-medium text-slate-600 dark:text-slate-300 uppercase tracking-wider"},"Status",3,null),e("th",null,{class:"px-6 py-4 text-right text-xs font-medium text-slate-600 dark:text-slate-300 uppercase tracking-wider"},"Actions",3,null)],3,null),3,null),e("tbody",null,{class:"bg-white dark:bg-slate-800 divide-y divide-slate-200 dark:divide-slate-700"},D.value.map(x=>X(e("tr",null,{class:"hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-all duration-200 group"},[e("td",null,{class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-800 dark:text-slate-100"},A(x,"professional_name"),1,null),e("td",null,{class:"px-6 py-4 whitespace-nowrap text-sm text-slate-600 dark:text-slate-300"},C(x.created_date??null),1,null),e("td",null,{class:"px-6 py-4 whitespace-nowrap text-sm text-slate-600 dark:text-slate-300"},C(x.issue_date),1,null),e("td",null,{class:"px-6 py-4 whitespace-nowrap text-sm text-slate-800 dark:text-slate-100 font-semibold"},z(x.amount,x.currency),1,null),e("td",null,{class:"px-6 py-4 whitespace-nowrap"},e("span",{class:`px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${x.status==="paid"?"bg-gradient-to-r from-emerald-50 to-emerald-100 text-emerald-700 dark:from-emerald-900/30 dark:to-emerald-800/30 dark:text-emerald-400":"bg-gradient-to-r from-amber-50 to-amber-100 text-amber-700 dark:from-amber-900/30 dark:to-amber-800/30 dark:text-amber-400"}`},null,x.status.charAt(0).toUpperCase()+x.status.slice(1),1,null),1,null),e("td",null,{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},e("div",null,{class:"flex justify-end space-x-2"},[x.invoice_url?e("a",{href:`/api/invoices/view/${x.invoice_url}`},{target:"_blank",rel:"noopener noreferrer",class:"p-1.5 text-slate-600 dark:text-slate-400 hover:text-teal-600 hover:bg-teal-50 dark:hover:text-teal-400 dark:hover:bg-teal-900/20 rounded-full transition-all",title:"View Invoice"},d(Ce,{class:"h-5 w-5",[a]:{class:a}},3,"T3_4"),1,"T3_5"):e("button",null,{class:"p-1.5 text-slate-400 dark:text-slate-600 rounded-full transition-all cursor-not-allowed",disabled:!0,title:"No invoice uploaded"},d(Ce,{class:"h-5 w-5",[a]:{class:a}},3,"T3_6"),1,null),l.value.role==="admin"&&d(ee,{action:r,children:[e("input",{value:A(x,"id")},{type:"hidden",name:"id"},null,3,null),e("button",null,{type:"submit",class:"p-1.5 text-slate-600 dark:text-slate-400 hover:text-red-600 hover:bg-red-50 dark:hover:text-red-400 dark:hover:bg-red-900/20 rounded-full transition-all",title:"Delete Invoice"},d(ye,{class:"h-5 w-5",[a]:{class:a}},3,"T3_7"),1,null)],[a]:{action:a}},1,"T3_8")],1,null),1,null)],1,x.id))),1,null)],1,null),1,null),D.value.length===0&&e("div",null,{class:"px-6 py-12 text-center"},e("p",null,{class:"text-slate-500 dark:text-slate-400 font-medium"},"No invoices found.",3,null),3,"T3_9")],1,null)],1,null),i.value&&e("div",null,{class:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},e("div",null,{class:"flex items-end sm:items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},[e("div",null,{class:"fixed inset-0 bg-slate-700/70 dark:bg-slate-900/80 backdrop-blur-md transition-opacity","aria-hidden":"true",onClick$:w("s_uGSf4oJ6SJQ",[i])},null,3,null),e("div",null,{class:"inline-block align-bottom bg-white/95 dark:bg-slate-800/95 backdrop-blur-md rounded-xl text-left overflow-hidden shadow-2xl transform transition-all border border-slate-100/50 dark:border-slate-700/50 sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},d(ee,{action:n,onSubmit$:g(Zs,"s_UgBnfcdTxj4",[c,u,p,t,m,h]),onSubmitCompleted$:g(Js,"s_EU50MZy0BNs",[n,S,i]),children:[e("div",null,{class:"px-6 pt-5 pb-4 sm:p-6 sm:pb-4"},[e("h3",null,{class:"text-xl leading-6 font-medium text-slate-800 dark:text-slate-100",id:"modal-title"},"Add New Invoice",3,null),e("div",null,{class:"mt-4 space-y-4"},[e("div",null,null,[e("label",null,{for:"contractId",class:"block text-sm font-medium text-slate-700 dark:text-slate-300"},"Contract",3,null),e("select",null,{name:"contractId",id:"contractId",value:u,class:"mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm py-3 px-3 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm transition-all",onInput$:w("s_gV4M91Oagjs",[u])},[e("option",null,{value:""},"Select a contract",3,null),s.value.contracts.map(x=>e("option",{value:A(x,"id")},null,`${x.professional_name} (${C(x.start_date)})`,1,x.id))],1,null),((G=t.value)==null?void 0:G.contractId)&&e("p",null,{class:"text-red-500 text-sm mt-1"},y(x=>x.value.contractId,[t],"p0.value.contractId"),3,"T3_10"),((L=(k=n.value)==null?void 0:k.fieldErrors)==null?void 0:L.contractId)&&e("p",null,{class:"text-red-500 text-sm mt-1"},y(x=>x.value.fieldErrors.contractId[0],[n],"p0.value.fieldErrors.contractId[0]"),3,"T3_11")],1,null),e("div",null,{class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},[e("div",null,null,[e("label",null,{for:"issueDate",class:"block text-sm font-medium text-slate-700 dark:text-slate-300"},"Issue Date",3,null),e("input",null,{type:"date",name:"issueDate",id:"issueDate",value:m,class:"mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm py-3 px-3 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm transition-all",onInput$:w("s_ae1ZGRqvTnM",[m])},null,3,null),((f=t.value)==null?void 0:f.issueDate)&&e("p",null,{class:"text-red-500 text-sm mt-1"},y(x=>x.value.issueDate,[t],"p0.value.issueDate"),3,"T3_12"),((W=(q=n.value)==null?void 0:q.fieldErrors)==null?void 0:W.issueDate)&&e("p",null,{class:"text-red-500 text-sm mt-1"},y(x=>x.value.fieldErrors.issueDate[0],[n],"p0.value.fieldErrors.issueDate[0]"),3,"T3_13")],1,null),e("div",null,null,[e("label",null,{for:"amount",class:"block text-sm font-medium text-slate-700 dark:text-slate-300"},"Amount",3,null),e("input",null,{type:"number",name:"amount",id:"amount",value:c,class:"mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm py-3 px-3 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm transition-all",onInput$:w("s_oqM2x05LSOg",[c])},null,3,null),((Q=t.value)==null?void 0:Q.amount)&&e("p",null,{class:"text-red-500 text-sm mt-1"},y(x=>x.value.amount,[t],"p0.value.amount"),3,"T3_14"),((le=(Z=n.value)==null?void 0:Z.fieldErrors)==null?void 0:le.amount)&&e("p",null,{class:"text-red-500 text-sm mt-1"},y(x=>x.value.fieldErrors.amount[0],[n],"p0.value.fieldErrors.amount[0]"),3,"T3_15")],1,null)],1,null),e("div",null,{class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},[e("div",null,null,[e("label",null,{for:"currency",class:"block text-sm font-medium text-slate-700 dark:text-slate-300"},"Currency",3,null),e("select",null,{name:"currency",id:"currency",value:p,class:"mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm py-3 px-3 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm transition-all",onInput$:w("s_5or9uINNTRc",[p])},[e("option",null,null,"USD",3,null),e("option",null,null,"EUR",3,null),e("option",null,null,"KNRT",3,null)],3,null),((re=t.value)==null?void 0:re.currency)&&e("p",null,{class:"text-red-500 text-sm mt-1"},y(x=>x.value.currency,[t],"p0.value.currency"),3,"T3_16")],1,null),e("div",null,null,[e("label",null,{for:"status",class:"block text-sm font-medium text-slate-700 dark:text-slate-300"},"Status",3,null),e("select",null,{name:"status",id:"status",value:h,class:"mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm py-3 px-3 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm transition-all",onInput$:w("s_6e4iQEdCYJU",[h])},[e("option",null,{value:"pending"},"Pending",3,null),e("option",null,{value:"paid"},"Paid",3,null)],3,null),((M=t.value)==null?void 0:M.status)&&e("p",null,{class:"text-red-500 text-sm mt-1"},y(x=>x.value.status,[t],"p0.value.status"),3,"T3_17")],1,null)],1,null),e("div",null,null,[e("label",null,{class:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1"},"Invoice Document (PDF/Image)",3,null),_.value?e("div",null,{class:"mt-2"},[e("div",null,{class:"relative h-64 w-full rounded-lg border border-slate-300 dark:border-slate-600 overflow-hidden group"},[_.value.startsWith("blob:http")&&e("iframe",null,{src:y(x=>x.value,[_],"p0.value"),class:"h-full w-full",title:"Invoice Preview"},null,3,"T3_18"),e("a",null,{href:y(x=>x.value,[_],"p0.value"),target:"_blank",rel:"noopener noreferrer",class:"absolute top-2 right-2 p-2 bg-slate-700/50 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",title:"Open in new tab"},d(dt,{class:"h-5 w-5",[a]:{class:a}},3,"T3_19"),1,null)],1,null),e("button",null,{type:"button",class:"mt-2 inline-flex items-center text-sm font-medium text-red-600 hover:text-red-800 dark:text-red-500 dark:hover:text-red-400",onClick$:w("s_fM3VT6rrliw",[I,_,v])},[d(ke,{class:"mr-1.5 h-4 w-4",[a]:{class:a}},3,"T3_20"),"Remove Document"],1,null)],1,"T3_21"):e("div",null,{class:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-slate-300 dark:border-slate-600 border-dashed rounded-lg"},e("div",null,{class:"space-y-1 text-center"},[T.value?d(oe,{class:"mx-auto h-12 w-12 text-slate-400 animate-spin",[a]:{class:a}},3,"T3_22"):d(ct,{class:"mx-auto h-12 w-12 text-slate-400",[a]:{class:a}},3,"T3_23"),e("div",null,{class:"flex text-sm text-slate-600 dark:text-slate-400"},[e("label",null,{for:"file-upload",class:"relative cursor-pointer bg-white dark:bg-slate-800 rounded-md font-medium text-teal-600 dark:text-teal-500 hover:text-teal-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-teal-500"},[e("span",null,null,"Upload a file",3,null),e("input",{ref:I},{id:"file-upload",name:"file-upload",type:"file",class:"sr-only",accept:"application/pdf,image/*",disabled:y(x=>x.value,[T],"p0.value"),onChange$:$},null,3,null)],1,null),e("p",null,{class:"pl-1"},"or drag and drop",3,null)],1,null),e("p",null,{class:"text-xs text-slate-500 dark:text-slate-500"},"PDF, PNG, JPG up to 10MB",3,null)],1,null),1,null),E.value&&e("p",null,{class:"mt-2 text-sm text-red-600 dark:text-red-500"},y(x=>x.value,[E],"p0.value"),3,"T3_24"),e("input",null,{type:"hidden",name:"invoiceUrl",value:y(x=>x.value??"",[v],'p0.value??""')},null,3,null)],1,null)],1,null)],1,null),e("div",null,{class:"bg-gradient-to-r from-slate-50 to-slate-100 dark:from-slate-700 dark:to-slate-800 px-6 py-4 sm:flex sm:flex-row-reverse"},[e("button",null,{type:"submit",disabled:y((x,j,me)=>x.isRunning||me.value||!!j.value,[n,t,T],"p0.isRunning||p2.value||!!p1.value"),class:"w-full inline-flex justify-center items-center rounded-lg border border-transparent shadow-sm px-5 py-2.5 bg-gradient-to-r from-teal-500 to-teal-600 text-base font-medium text-white hover:from-teal-600 hover:to-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 sm:ml-3 sm:w-auto sm:text-sm transition-all duration-200 disabled:opacity-50"},[n.isRunning?d(oe,{class:"animate-spin h-5 w-5 mr-2",[a]:{class:a}},3,"T3_25"):d(Te,{class:"h-5 w-5 mr-2",[a]:{class:a}},3,"T3_26"),"Save Invoice"],1,null),e("button",null,{type:"button",class:"mt-3 w-full inline-flex justify-center items-center rounded-lg border border-slate-200 dark:border-slate-600 shadow-sm px-5 py-2.5 bg-white dark:bg-slate-800 text-base font-medium text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm transition-all duration-200",onClick$:w("s_SUoZcR3RUO0",[S,i])},[d(fe,{class:"h-5 w-5 mr-2",[a]:{class:a}},3,"T3_27"),"Cancel"],1,null)],1,null),((xe=n.value)==null?void 0:xe.success)===!1&&e("div",null,{class:"p-4 bg-red-100 text-red-800 rounded-b-lg"},[d(ae,{class:"inline h-5 w-5 mr-2",[a]:{class:a}},3,"T3_28"),y(x=>x.value.error,[n],"p0.value.error")],1,"T3_29")],[a]:{action:a,onSubmit$:a,onSubmitCompleted$:a}},1,"T3_30"),1,null)],1,null),1,"T3_31")],1,"T3_32")},Xs=te(g(Ks,"s_a5XSqTax3Rc")),ea=Object.freeze(Object.defineProperty({__proto__:null,default:Xs,useAddInvoice:Et,useAuthLoader:Tt,useDeleteInvoice:Dt,useInvoicesLoader:St,useUpdateInvoiceStatus:Ct},Symbol.toStringTag,{value:"Module"})),ta=$e(async function(t){return await F(this).execute({sql:"DELETE FROM timelocks WHERE id = ?",args:[t]}),{success:!0}},"O0kxQdwIoZU"),Rt=Ne(g(ta,"s_O0kxQdwIoZU")),la=$e(async function(){return await F(this).execute({sql:"DELETE FROM timelocks",args:[]}),{success:!0}},"qBcpedqx7iM"),It=Ne(g(la,"s_qBcpedqx7iM")),sa=async t=>{const l=F(t),s=new URL(t.request.url),n=new Date,r=parseInt(s.searchParams.get("year")||n.getFullYear().toString()),i=parseInt(s.searchParams.get("month")||(n.getMonth()+1).toString()),o=`${r}-${String(i).padStart(2,"0")}-01`,u=new Date(r,i,0),m=`${r}-${String(i).padStart(2,"0")}-${String(u.getDate()).padStart(2,"0")}`,c=`
    SELECT t.id, t.payment_id, t.invoice_id as facturaId, t.release_timestamp, t.status,
           i.invoice_url, i.amount, i.currency, i.status as invoice_status,
           prof.name, prof.email, prof.wallet,
           c.contract_url, c.id as contract_id
    FROM timelocks t
    LEFT JOIN invoices i ON t.invoice_id = i.id
    LEFT JOIN professionals prof ON i.professional_id = prof.id
    LEFT JOIN contracts c ON i.contract_id = c.id
    WHERE t.release_timestamp >= ? AND t.release_timestamp <= ?
    ORDER BY t.release_timestamp ASC
  `,p=Math.floor(new Date(o).getTime()/1e3),h=Math.floor(new Date(m+"T23:59:59").getTime()/1e3),_=(await l.execute({sql:c,args:[p,h]})).rows.map(D=>{let R="pending";return(D.invoice_status==="paid"||D.status==="released")&&(R="released"),{id:D.id,token:D.payment_id,invoice_id:D.facturaId,amount:Number(D.amount),currency:D.currency,status:R,release_date:new Date(Number(D.release_timestamp)*1e3).toISOString().split("T")[0],recipient:D.wallet,professional_name:D.name,email:D.email,contract_id:D.contract_id,contract_url:D.contract_url,invoice_url:D.invoice_url}}),T=u.getDate(),E=new Date(r,i-1,1).getDay(),I=[];for(let D=0;D<E;D++)I.push({day:null,locks:[]});for(let D=1;D<=T;D++){const R=`${r}-${String(i).padStart(2,"0")}-${String(D).padStart(2,"0")}`,N=_.filter(S=>S.release_date===R);I.push({day:D,locks:N})}return{locks:_,calendarData:I,currentMonth:i,currentYear:r}},At=V(g(sa,"s_KLgGdYv9ffA")),aa=async t=>{const[l]=O();await Rt(t),l.value++},na=({track:t})=>{const[l,s,n,r]=O();t(()=>s.month),t(()=>s.year),t(()=>s.currency),t(()=>s.status),t(()=>r.value),l.value=n.value.locks.filter(i=>{const o=Number(i.release_date.split("-")[1]),u=Number(i.release_date.split("-")[0]),m=!s.currency||i.currency===s.currency,c=!s.status||i.status===s.status;return o===Number(s.month)&&u===Number(s.year)&&m&&c})},ra=t=>{const[l,s]=O();let n=Number(l.month),r=Number(l.year);t==="prev"?(n--,n<1&&(n=12,r--)):(n++,n>12&&(n=1,r++)),l.month=n,l.year=r,s.value=1},oa=async()=>{const[t]=O();await It(),t.value++},ia=()=>{var z,G;const t=At(),l=Kt({month:t.value.currentMonth,year:t.value.currentYear,currency:"",status:""}),s=b("month"),n=b(1),r=b(0),i=[{value:1,label:"Enero"},{value:2,label:"Febrero"},{value:3,label:"Marzo"},{value:4,label:"Abril"},{value:5,label:"Mayo"},{value:6,label:"Junio"},{value:7,label:"Julio"},{value:8,label:"Agosto"},{value:9,label:"Septiembre"},{value:10,label:"Octubre"},{value:11,label:"Noviembre"},{value:12,label:"Diciembre"}],o=Array.from({length:6},(k,L)=>{const f=new Date().getFullYear()-3+L;return{value:f.toString(),label:f.toString()}}),u=g(aa,"s_XyQAGNw8Gdo",[r]),m=b(t.value.locks);ce(g(na,"s_leMdkb83P3w",[m,l,t,r]));const c=[],p={};m.value.forEach(k=>{const L=Number(k.release_date.split("-")[2]);p[L]||(p[L]=[]),p[L].push(k)});const h=new Date(l.year,l.month-1,1).getDay(),v=new Date(l.year,l.month,0).getDate(),_=h===0?6:h-1;for(let k=0;k<_;k++)c.push({day:null,locks:[]});for(let k=1;k<=v;k++)c.push({day:k,locks:p[k]||[]});for(;c.length%7!==0;)c.push({day:null,locks:[]});const E=((k,L)=>{const f=[],q=new Date(k,L,0);let W=1,Q=[];for(let Z=1;Z<=q.getDate();Z++){const re=new Date(k,L-1,Z).getDay(),M=p[Z]||[];Q.push({day:Z,locks:M}),(re===0||Z===q.getDate())&&(f.push({week:W,days:Q}),W++,Q=[])}return f})(l.year,l.month),I=(k,L)=>{const f={};return k.forEach(q=>{if(L&&q.status!==L)return;const W=q.currency||"USD";f[W]=(f[W]||0)+q.amount}),f},D=I(m.value),R=I(m.value,"pending"),N=g(ra,"s_SydKp69OxJo",[l,n]),S=k=>{var L;return((L=i.find(f=>f.value===k))==null?void 0:L.label)||""},$=(k,L)=>{if(k===null)return"bg-slate-50 dark:bg-slate-800/50 opacity-50";const f=new Date;f.setHours(0,0,0,0);const q=new Date(l.year,l.month-1,k||1);let W="bg-white dark:bg-slate-800";q.getTime()<f.getTime()&&(W="bg-slate-100 dark:bg-slate-800/70"),q.getTime()===f.getTime()&&(W="bg-teal-50 dark:bg-teal-900/30 border-teal-400 dark:border-teal-600");const Q=L.some(le=>le.status==="pending"),Z=L.some(le=>le.status==="released");return Q?`${W} border-l-4 border-amber-400 dark:border-amber-500`:Z?`${W} border-l-4 border-emerald-400 dark:border-emerald-500`:W},C=g(oa,"s_evhh93SaLJg",[r]);return e("main",null,{class:"min-h-screen bg-gradient-to-br from-slate-50 via-slate-100 to-slate-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900"},e("div",null,{class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},[e("header",null,{class:"mb-8 bg-gradient-to-r from-slate-100 to-slate-50 dark:from-slate-800 dark:to-slate-700 rounded-xl shadow-sm p-6"},e("div",null,{class:"flex flex-col sm:flex-row sm:items-center sm:justify-between"},[e("div",null,{class:"flex items-center"},[d(nt,{class:"h-8 w-8 text-teal-600 dark:text-teal-500 mr-3",[a]:{class:a}},3,"Zl_0"),e("div",null,null,[e("h1",null,{class:"text-2xl sm:text-3xl font-bold text-slate-800 dark:text-slate-100"},"Locks Planner",3,null),e("p",null,{class:"text-slate-500 dark:text-slate-400 mt-1"},"Visualiza los pagos automatizados (locks) del mes",3,null)],3,null)],1,null),e("div",null,{class:"flex items-center space-x-2 mt-4 sm:mt-0"},[e("div",null,{class:"inline-flex items-center space-x-1.5 text-xs"},[e("span",null,{class:"w-3 h-3 inline-block bg-amber-400 rounded-full"},null,3,null),e("span",null,{class:"text-slate-600 dark:text-slate-300"},"Pendiente",3,null)],3,null),e("div",null,{class:"inline-flex items-center space-x-1.5 text-xs"},[e("span",null,{class:"w-3 h-3 inline-block bg-emerald-400 rounded-full"},null,3,null),e("span",null,{class:"text-slate-600 dark:text-slate-300"},"Liberado",3,null)],3,null)],3,null)],1,null),1,null),e("div",null,{class:"flex flex-wrap gap-3 mb-6"},[e("select",null,{value:y(k=>k.month,[l],"p0.month"),class:"px-2 py-2 rounded border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200",onChange$:w("s_5eiIp5j07qE",[l])},i.map(k=>e("option",{value:A(k,"value")},null,k.label,1,k.value)),1,null),e("select",null,{value:y(k=>k.year.toString(),[l],"p0.year.toString()"),class:"px-2 py-2 rounded border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200",onChange$:w("s_ZI8ECs4Zn08",[l])},o.map(k=>e("option",{value:A(k,"value")},null,k.label,1,k.value)),1,null),e("select",null,{value:y(k=>k.currency,[l],"p0.currency"),class:"px-2 py-2 rounded border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200",onChange$:w("s_Ywbe2iM0boA",[l])},[e("option",null,{value:""},"Moneda",3,null),e("option",null,{value:"USDC"},"USDC",3,null),e("option",null,{value:"USDT"},"USDT",3,null),e("option",null,{value:"DAI"},"DAI",3,null),e("option",null,{value:"KNRT"},"KNRT",3,null)],3,null),e("select",null,{value:y(k=>k.status,[l],"p0.status"),class:"px-2 py-2 rounded border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200",onChange$:w("s_30knRFxAQiA",[l])},[e("option",null,{value:""},"Estado",3,null),e("option",null,{value:"pending"},"Pendiente",3,null),e("option",null,{value:"released"},"Liberado",3,null)],3,null)],1,null),e("div",null,{class:"flex gap-2 mb-6 items-center"},[e("button",{class:`px-4 py-2 rounded-lg font-semibold border transition-colors ${s.value==="month"?"bg-teal-600 text-white border-teal-600":"bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 border-slate-200 dark:border-slate-700"}`},{onClick$:w("s_ZjtNUDXEnQM",[s])},"Vista Mensual",3,null),e("button",{class:`px-4 py-2 rounded-lg font-semibold border transition-colors ${s.value==="week"?"bg-teal-600 text-white border-teal-600":"bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 border-slate-200 dark:border-slate-700"}`},{onClick$:w("s_gdkezAlkPqk",[s])},"Vista Semanal",3,null),e("button",null,{class:"ml-auto px-4 py-2 rounded-lg font-semibold border border-red-500 bg-red-500 text-white hover:bg-red-600 transition-colors",title:"Borrar todos los timelocks",onClick$:C},"Borrar todos",3,null)],1,null),e("div",null,{class:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8"},[e("div",null,{class:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-5 border border-slate-100 dark:border-slate-700"},[e("h3",null,{class:"text-sm font-medium text-slate-500 dark:text-slate-400"},"Total Locks Este Mes",3,null),e("p",null,{class:"text-2xl font-bold text-slate-800 dark:text-slate-200"},y(k=>k.value.length,[m],"p0.value.length"),3,null)],3,null),e("div",null,{class:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-5 border border-slate-100 dark:border-slate-700"},[e("h3",null,{class:"text-sm font-medium text-slate-500 dark:text-slate-400"},"Monto Pendiente",3,null),e("div",null,null,[Object.entries(R).map(([k,L])=>e("span",null,{class:"block text-amber-600 dark:text-amber-400 text-lg font-bold"},[L.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})," ",k],1,k)),Object.keys(R).length===0&&e("span",null,{class:"text-amber-600 dark:text-amber-400 text-lg font-bold"},"0,00 USD",3,"Zl_1")],1,null)],1,null),e("div",null,{class:"bg-white dark:bg-slate-800 rounded-lg shadow-sm p-5 border border-slate-100 dark:border-slate-700"},[e("h3",null,{class:"text-sm font-medium text-slate-500 dark:text-slate-400"},"Monto Total",3,null),e("div",null,null,[Object.entries(D).map(([k,L])=>e("span",null,{class:"block text-emerald-600 dark:text-emerald-400 text-lg font-bold"},[L.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})," ",k],1,k)),Object.keys(D).length===0&&e("span",null,{class:"text-emerald-600 dark:text-emerald-400 text-lg font-bold"},"0,00 USD",3,"Zl_2")],1,null)],1,null)],1,null),e("div",null,{class:"bg-white dark:bg-slate-800 shadow-lg rounded-xl overflow-hidden border border-slate-200 dark:border-slate-700"},[e("div",null,{class:"flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-700"},[e("button",null,{class:"p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors",onClick$:w("s_yEUHrZlk7e8",[N])},d(rt,{class:"h-5 w-5 text-slate-600 dark:text-slate-300",[a]:{class:a}},3,"Zl_3"),1,null),e("h2",null,{class:"text-lg font-semibold text-slate-800 dark:text-slate-100"},[S(l.month)," ",y(k=>k.year,[l],"p0.year")],1,null),e("button",null,{class:"p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors",onClick$:w("s_9lirksKinnQ",[N])},d(ot,{class:"h-5 w-5 text-slate-600 dark:text-slate-300",[a]:{class:a}},3,"Zl_4"),1,null)],1,null),s.value==="month"?e("div",null,{class:"overflow-x-auto"},[e("div",null,{class:"grid grid-cols-7 bg-slate-100 dark:bg-slate-900 text-xs font-semibold text-slate-600 dark:text-slate-300"},[e("div",null,{class:"p-2 text-center"},"Lun",3,null),e("div",null,{class:"p-2 text-center"},"Mar",3,null),e("div",null,{class:"p-2 text-center"},"Mié",3,null),e("div",null,{class:"p-2 text-center"},"Jue",3,null),e("div",null,{class:"p-2 text-center"},"Vie",3,null),e("div",null,{class:"p-2 text-center"},"Sáb",3,null),e("div",null,{class:"p-2 text-center"},"Dom",3,null)],3,null),e("div",null,{class:"grid grid-cols-7"},c.map((k,L)=>e("div",{class:`h-32 sm:h-36 md:h-40 border border-slate-100 dark:border-slate-700 p-2 align-top transition-colors duration-300 ${$(k.day,k.locks)}`},null,[e("div",null,{class:"text-xs font-bold text-slate-700 dark:text-slate-200 mb-1"},k.day?k.day:"",1,null),e("div",null,{class:"space-y-1"},k.locks.map(f=>e("div",{class:`text-[10px] p-1 rounded shadow-sm ${f.status==="released"?"bg-emerald-50 text-emerald-800 dark:bg-emerald-900/50 dark:text-emerald-300":"bg-amber-50 text-amber-800 dark:bg-amber-900/50 dark:text-amber-300"}`,title:`Token: ${f.token||""}
Monto: ${f.amount.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})} ${f.currency||"USD"}
Fecha: ${f.release_date}
Estado: ${f.status}
Destinatario: ${f.recipient||""}
Profesional: ${f.professional_name}
Email: ${f.email||""}`},null,[e("div",null,{class:"font-bold truncate"},A(f,"professional_name"),1,null),e("div",null,{class:"font-medium"},[f.amount.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})," ",f.currency||"USD"],1,null),e("button",{onClick$:w("s_mN0Ws0ppGJ4",[u,f])},{class:"mt-1 px-2 py-0.5 rounded text-xs bg-red-500 text-white hover:bg-red-600",title:"Borrar este timelock"},"Borrar",2,null)],1,f.id)),1,null)],1,L)),1,null),c.filter(k=>k.day!==null).length===0&&e("div",null,{class:"p-4 text-center text-slate-400"},"No hay locks creados este mes.",3,"Zl_5")],1,"Zl_6"):e("div",null,{class:"p-4"},[e("div",null,{class:"flex gap-2 mb-4 flex-wrap"},[E.map(k=>e("button",{class:`px-3 py-1 rounded border font-semibold text-xs transition-colors ${n.value===k.week?"bg-teal-600 text-white border-teal-600":"bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 border-slate-200 dark:border-slate-700"}`,onClick$:w("s_k0MtGjQcW30",[n,k])},null,["Semana ",A(k,"week")],0,k.week)),e("button",null,{class:"ml-auto px-4 py-2 rounded-lg font-semibold border border-red-500 bg-red-500 text-white hover:bg-red-600 transition-colors",title:"Borrar todos los timelocks",onClick$:C},"Borrar todos",3,null)],1,null),((z=E.find(k=>k.week===n.value))==null?void 0:z.days.length)===0&&e("div",null,{class:"p-4 text-center text-slate-400"},"No hay locks esta semana.",3,"Zl_7"),(G=E.find(k=>k.week===n.value))==null?void 0:G.days.map((k,L)=>e("div",{class:`p-4 border-b border-slate-100 dark:border-slate-700 min-h-[120px] transition-colors duration-300 ${$(k.day,k.locks)}`},null,[e("div",null,{class:"text-sm font-semibold text-slate-700 dark:text-slate-200"},["Día ",A(k,"day")],1,null),e("div",null,{class:"mt-2 space-y-2"},k.locks.map(f=>e("div",{class:`text-xs p-2 rounded-lg shadow-sm ${f.status==="released"?"bg-emerald-50 text-emerald-800 dark:bg-emerald-900/50 dark:text-emerald-300":"bg-amber-50 text-amber-800 dark:bg-amber-900/50 dark:text-amber-300"}`,title:`Token: ${f.token||""}
Monto: ${f.amount.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})} ${f.currency||"USD"}
Fecha: ${f.release_date}
Estado: ${f.status}
Destinatario: ${f.recipient||""}
Profesional: ${f.professional_name}
Email: ${f.email||""}`},null,[e("div",null,{class:"font-bold truncate"},A(f,"professional_name"),1,null),e("div",null,{class:"font-medium"},[f.amount.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})," ",f.currency||"USD"],1,null),e("div",null,{class:"text-xs text-slate-500"},f.token?`Token: ${f.token}`:"",1,null),e("div",null,{class:"text-xs text-slate-500"},f.recipient?`Wallet: ${f.recipient}`:"",1,null),e("div",null,{class:"text-xs text-slate-500"},f.email?f.email:"",1,null),e("button",{onClick$:w("s_wHL7qA0hdK8",[u,f])},{class:"mt-1 px-2 py-0.5 rounded text-xs bg-red-500 text-white hover:bg-red-600",title:"Borrar este timelock"},"Borrar",2,null)],1,f.id)),1,null)],1,L))],1,null)],1,null)],1,null),1,"Zl_8")},ua=te(g(ia,"s_SibSP8O5TQA")),da=Object.freeze(Object.defineProperty({__proto__:null,default:ua,deleteAllTimelocksQrl:It,deleteTimelockQrl:Rt,usePaymentPlannerLoader:At},Symbol.toStringTag,{value:"Module"})),ca=async t=>{const l=await H(t);if(!(l!=null&&l.isAuthenticated))throw t.redirect(302,"/auth");return l},Lt=V(g(ca,"s_6l7uYMCB50c")),ma=async t=>(await F(t).execute("SELECT id, name, role, email, phone, wallet FROM professionals ORDER BY name")).rows,Mt=V(g(ma,"s_9ghkRguhPB4")),pa=async(t,l)=>{const s=F(l),n=await H(l);if(!n.isAuthenticated||!n.userId)return{success:!1,error:"Authentication required."};try{return await s.execute({sql:"INSERT INTO professionals (user_id, name, role, email, phone, wallet) VALUES (?, ?, ?, ?, ?, ?)",args:[n.userId,t.name??"",t.role??"",t.email??"",t.phone??"",t.wallet??""]}),{success:!0}}catch(r){return console.error("Failed to add professional:",r),{success:!1,error:"Failed to add professional."}}},fa={name:U.string().min(3,"Name must be at least 3 characters."),role:U.string().min(3,"Role must be at least 3 characters."),email:U.string().email("Please enter a valid email.").optional().or(U.literal("")),phone:U.string().optional(),wallet:U.string().optional()},Ot=Y(g(pa,"s_ewYr998vpGU"),ne(g(fa,"s_W0H0hD8VHsM"))),xa=async(t,l)=>{var r,i,o,u,m,c;const s=F(l),n=await H(l);if(!n.isAuthenticated||!n.userId)return{success:!1,error:"Authentication required."};try{const p=await s.execute({sql:"SELECT user_id FROM professionals WHERE id = ?",args:[t.id]});if(p.rows.length===0)return{success:!1,error:"Professional not found."};const v=(r=(await s.execute({sql:"SELECT email FROM users WHERE id = ?",args:[n.userId]})).rows[0])==null?void 0:r.email,_=p.rows[0].user_id;if(v!=="admin@gmail.com"&&_!==n.userId)return{success:!1,error:"You do not have permission to delete this professional."};const T=await s.execute({sql:"SELECT COUNT(*) as count FROM payments WHERE professional_id = ?",args:[t.id]});if(Number(((i=T.rows[0])==null?void 0:i.count)||0)>0)return{success:!1,error:"Cannot delete a professional with associated payments."};await s.execute({sql:"DELETE FROM payments WHERE professional_id = ?",args:[t.id]});const I=await s.execute({sql:`SELECT COUNT(*) as count
              FROM timelocks t
              JOIN payments p ON t.payment_id = p.id
              WHERE p.professional_id = ?`,args:[t.id]});if(Number(((o=I.rows[0])==null?void 0:o.count)||0)>0)return{success:!1,error:"Cannot delete a professional with associated timelocks."};await s.execute({sql:"DELETE FROM timelocks WHERE payment_id IN (SELECT id FROM payments WHERE professional_id = ?)",args:[t.id]});const R=await s.execute({sql:"SELECT COUNT(*) as count FROM contracts WHERE professional_id = ?",args:[t.id]});if(Number(((u=R.rows[0])==null?void 0:u.count)||0)>0)return{success:!1,error:"Cannot delete a professional with associated contracts."};await s.execute({sql:"DELETE FROM contracts WHERE professional_id = ?",args:[t.id]});const S=await s.execute({sql:"SELECT COUNT(*) as count FROM invoices WHERE professional_id = ?",args:[t.id]});if(Number(((m=S.rows[0])==null?void 0:m.count)||0)>0)return{success:!1,error:"Cannot delete a professional with associated invoices."};await s.execute({sql:"DELETE FROM invoices WHERE professional_id = ?",args:[t.id]});const C=await s.execute({sql:"SELECT COUNT(*) as count FROM settlements WHERE professional_id = ?",args:[t.id]});return Number(((c=C.rows[0])==null?void 0:c.count)||0)>0?{success:!1,error:"Cannot delete a professional with associated settlements."}:(await s.execute({sql:"DELETE FROM settlements WHERE professional_id = ?",args:[t.id]}),await s.execute({sql:"DELETE FROM professionals WHERE id = ?",args:[t.id]}),{success:!0})}catch(p){console.error("Failed to delete professional:",p);const h=typeof p=="object"&&p!==null&&"code"in p?p.code:void 0;return h==="SQLITE_CONSTRAINT"?{success:!1,error:"Cannot delete professional due to existing references (payments, timelocks, invoices, contracts)."}:h==="SQL_INPUT_ERROR"?{success:!1,error:"Database column name error. Please check your schema for correct column names in payments/timelocks."}:{success:!1,error:"Failed to delete professional."}}},ga={id:U.coerce.number()},Pt=Y(g(xa,"s_PF9CMJpbl0s"),ne(g(ga,"s_T3PAvZb0J0k"))),ba=async(t,l)=>{var r;const s=F(l),n=await H(l);if(!n.isAuthenticated||!n.userId)return{success:!1,error:"Authentication required."};try{const i=await s.execute({sql:"SELECT user_id FROM professionals WHERE id = ?",args:[t.id]});if(i.rows.length===0)return{success:!1,error:"Professional not found."};const u=(r=(await s.execute({sql:"SELECT email FROM users WHERE id = ?",args:[n.userId]})).rows[0])==null?void 0:r.email,m=i.rows[0].user_id;return u!=="admin@gmail.com"&&m!==n.userId?{success:!1,error:"You do not have permission to edit this professional."}:(await s.execute({sql:"UPDATE professionals SET name = ?, role = ?, email = ?, phone = ?, wallet = ? WHERE id = ?",args:[t.name??"",t.role??"",t.email??"",t.phone??"",t.wallet??"",t.id]}),{success:!0})}catch(i){return console.error("Failed to edit professional:",i),{success:!1,error:"Failed to edit professional."}}},ha={id:U.coerce.number(),name:U.string().min(3,"Name must be at least 3 characters."),role:U.string().min(3,"Role must be at least 3 characters."),email:U.string().email("Please enter a valid email.").optional().or(U.literal("")),phone:U.string().optional(),wallet:U.string().optional()},jt=Y(g(ba,"s_dOwNrTSENvc"),ne(g(ha,"s_HBjaONcPEVA"))),va=({track:t})=>{const[l,s]=O();t(()=>s.value),l.value=s.value},wa=t=>{const[l,s,n,r,i,o,u]=O();s.value=t.id,n.value=t.name,i.value=t.role,l.value=t.email||"",r.value=t.phone||"",o.value=t.wallet||"",u.value=!0},ka=()=>{const[t,l,s]=O();if(!s.value){t.value=l.value;return}const n=s.value.toLowerCase();t.value=l.value.filter(r=>r.name.toLowerCase().includes(n)||r.role.toLowerCase().includes(n))},ya=({track:t})=>{var r;const[l,s,n]=O();t(()=>l.value),(r=l.value)!=null&&r.success&&(n.value=!1,s.value=null,typeof window<"u"&&window.location.reload())},_a=()=>{var u;const[t,l,s,n,r,i,o]=O();(u=t.value)!=null&&u.success&&(i.value=!1,s.value="",r.value="",l.value="",n.value="",o.value="")},Ta=()=>{var s;const[t,l]=O();(s=t.value)!=null&&s.success&&(l.value=!1)},Sa=()=>{var n;const[t,l,s]=O();(n=t.value)!=null&&n.success&&(s.value=!1,l.value=null,typeof window<"u"&&window.location.reload())},Ea=()=>{var z,G,k,L,f,q,W,Q,Z,le,re;X(),Lt();const t=Mt(),l=Ot(),s=jt(),n=Pt(),r=b(""),i=b(!1),o=b(!1),u=b(!1),m=b(null),c=b(""),p=b(""),h=b(""),v=b(""),_=b(""),T=b(null),E=b(""),I=b(""),D=b(""),R=b(""),N=b(""),S=b(t.value);ce(g(va,"s_kB3Dg4UqAn0",[S,t]));const $=g(wa,"s_NpfzvKQlomg",[D,T,E,R,I,N,o]),C=g(ka,"s_gzBsbP7L8is",[S,t,r]);return ce(g(ya,"s_7sFC2IvQ6Zg",[n,m,u])),e("main",null,{class:"min-h-screen bg-gradient-to-br from-slate-50 via-slate-100 to-slate-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900"},[e("div",null,{class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},[e("header",null,{class:"mb-8 bg-gradient-to-r from-slate-100 to-slate-50 dark:from-slate-800 dark:to-slate-700 rounded-xl shadow-sm p-6"},e("div",null,{class:"flex flex-col sm:flex-row sm:items-center sm:justify-between"},[e("div",null,{class:"flex items-center"},[d(ve,{class:"h-8 w-8 text-teal-600 dark:text-teal-500 mr-3",[a]:{class:a}},3,"3n_0"),e("div",null,null,[e("h1",null,{class:"text-2xl sm:text-3xl font-bold text-slate-800 dark:text-slate-100"},"Professionals",3,null),e("p",null,{class:"text-slate-500 dark:text-slate-400 mt-1"},"Freelancer management",3,null)],3,null)],1,null),e("div",null,{class:"mt-4 sm:mt-0 flex flex-col sm:flex-row gap-3"},[e("button",null,{class:"inline-flex items-center justify-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-gradient-to-r from-teal-500 to-teal-600 hover:from-teal-600 hover:to-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 transition-all duration-200",onClick$:w("s_eoeiqcBEHfA",[i])},[d(Ae,{class:"mr-2 h-4 w-4",[a]:{class:a}},3,"3n_1"),"Add Professional"],1,null),e("button",null,{class:"inline-flex items-center justify-center px-4 py-2 border border-slate-200 dark:border-slate-600 rounded-md shadow-sm text-sm font-medium text-slate-700 dark:text-slate-200 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 transition-all duration-200"},[d(fl,{class:"mr-2 h-4 w-4",[a]:{class:a}},3,"3n_2"),"Export"],1,null)],1,null)],1,null),1,null),e("div",null,{class:"mb-6"},e("div",null,{class:"flex flex-col sm:flex-row gap-4 bg-white dark:bg-slate-800 rounded-lg shadow-sm p-4 border border-slate-100 dark:border-slate-700"},[e("div",null,{class:"relative flex-1"},[e("div",null,{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},d(ze,{class:"h-5 w-5 text-slate-400 dark:text-slate-500",[a]:{class:a}},3,"3n_3"),1,null),e("input",null,{type:"text",value:y(M=>M.value,[r],"p0.value"),class:"block w-full pl-10 pr-3 py-2 border border-slate-200 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 placeholder-slate-400 shadow-sm hover:border-teal-400 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm transition-all duration-200",placeholder:"Search by name or role...",onInput$:w("s_pQ7saR2vT2Q",[r,C])},null,3,null)],1,null),e("div",null,{class:"flex-shrink-0"},e("button",null,{class:"inline-flex items-center px-4 py-2 border border-slate-200 dark:border-slate-600 rounded-md shadow-sm text-sm font-medium text-slate-700 dark:text-slate-200 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 transition-all duration-200"},[d(xl,{class:"mr-2 h-4 w-4",[a]:{class:a}},3,"3n_4"),"Filter"],1,null),1,null)],1,null),1,null),e("div",null,{class:"bg-white dark:bg-slate-800 shadow-lg rounded-xl overflow-hidden border border-slate-200 dark:border-slate-700"},[e("div",null,{class:"overflow-x-auto"},e("table",null,{class:"min-w-full divide-y divide-slate-200 dark:divide-slate-700"},[e("thead",null,{class:"bg-gradient-to-r from-slate-100 to-slate-50 dark:from-slate-800 dark:to-slate-700"},e("tr",null,null,[e("th",null,{scope:"col",class:"px-6 py-4 text-left text-xs font-medium text-slate-600 dark:text-slate-300 uppercase tracking-wider"},"Name",3,null),e("th",null,{scope:"col",class:"px-6 py-4 text-left text-xs font-medium text-slate-600 dark:text-slate-300 uppercase tracking-wider"},"Role",3,null),e("th",null,{scope:"col",class:"px-6 py-4 text-left text-xs font-medium text-slate-600 dark:text-slate-300 uppercase tracking-wider"},"Contact",3,null),e("th",null,{scope:"col",class:"px-6 py-4 text-right text-xs font-medium text-slate-600 dark:text-slate-300 uppercase tracking-wider"},"Actions",3,null)],3,null),3,null),e("tbody",null,{class:"bg-white dark:bg-slate-800 divide-y divide-slate-200 dark:divide-slate-700"},S.value.map(M=>e("tr",null,{class:"hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-all duration-200 group"},[e("td",null,{class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-800 dark:text-slate-100"},A(M,"name"),1,null),e("td",null,{class:"px-6 py-4 whitespace-nowrap text-sm text-slate-600 dark:text-slate-300"},A(M,"role"),1,null),e("td",null,{class:"px-6 py-4 whitespace-nowrap text-sm text-slate-600 dark:text-slate-300"},[e("div",null,null,A(M,"email"),1,null),e("div",null,null,A(M,"phone"),1,null)],1,null),e("td",null,{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},e("div",null,{class:"flex justify-end space-x-2"},[e("button",null,{class:"p-1.5 text-slate-600 dark:text-slate-400 hover:text-teal-600 hover:bg-teal-50 dark:hover:text-teal-400 dark:hover:bg-teal-900/20 rounded-full transition-all"},d(Ce,{class:"h-5 w-5",[a]:{class:a}},3,"3n_5"),1,null),e("button",{onClick$:w("s_yNzzDuBT0os",[$,M])},{class:"p-1.5 text-slate-600 dark:text-slate-400 hover:text-blue-600 hover:bg-blue-50 dark:hover:text-blue-400 dark:hover:bg-blue-900/20 rounded-full transition-all"},d(Pe,{class:"h-5 w-5",[a]:{class:a}},3,"3n_6"),0,null),e("button",{onClick$:w("s_76pej4xkv8c",[M,m,u])},{class:"p-1.5 text-slate-600 dark:text-slate-400 hover:text-red-600 hover:bg-red-50 dark:hover:text-red-400 dark:hover:bg-red-900/20 rounded-full transition-all"},d(ye,{class:"h-5 w-5",[a]:{class:a}},3,"3n_7"),0,null)],1,null),1,null)],1,M.id)),1,null)],1,null),1,null),S.value.length===0&&e("div",null,{class:"px-6 py-12 text-center"},[e("div",null,{class:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-slate-100 dark:bg-slate-700/50 mb-4"},d(ve,{class:"w-8 h-8 text-slate-400 dark:text-slate-500",[a]:{class:a}},3,"3n_8"),1,null),e("p",null,{class:"text-slate-500 dark:text-slate-400 font-medium"},"No professionals found.",3,null),e("p",null,{class:"text-slate-400 dark:text-slate-500 mt-1 text-sm"},"Add a new professional to get started.",3,null)],1,"3n_9")],1,null),e("div",null,{class:"flex items-center justify-between mt-6 bg-white dark:bg-slate-800 p-4 rounded-lg shadow-sm border border-slate-100 dark:border-slate-700"},e("div",null,{class:"text-sm text-slate-600 dark:text-slate-400"},["Showing ",e("span",null,{class:"font-medium text-teal-600 dark:text-teal-500"},y(M=>M.value.length,[S],"p0.value.length"),3,null)," of ",e("span",null,{class:"font-medium text-teal-600 dark:text-teal-500"},y(M=>M.value.length,[t],"p0.value.length"),3,null)," professionals"],3,null),3,null)],1,null),i.value&&e("div",null,{class:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},e("div",null,{class:"flex items-end sm:items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},[e("div",null,{class:"fixed inset-0 bg-slate-700/70 dark:bg-slate-900/80 backdrop-blur-md transition-opacity","aria-hidden":"true",onClick$:w("s_TmJ39fMCzuM",[i])},null,3,null),e("div",null,{class:"inline-block align-bottom bg-white/95 dark:bg-slate-800/95 backdrop-blur-md rounded-xl text-left overflow-hidden shadow-2xl transform transition-all border border-slate-100/50 dark:border-slate-700/50 sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},d(ee,{action:l,onSubmitCompleted$:g(_a,"s_9kOa6fjVAlU",[l,h,c,v,p,i,_]),children:[e("div",null,{class:"px-6 pt-5 pb-4 sm:p-6 sm:pb-4"},e("div",null,{class:"sm:flex sm:items-start"},e("div",null,{class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full"},[e("h3",null,{class:"text-xl leading-6 font-medium text-slate-800 dark:text-slate-100",id:"modal-title"},"Add New Professional",3,null),e("div",null,{class:"mt-4"},e("div",null,{class:"space-y-4"},[e("div",null,null,[e("label",null,{for:"name",class:"block text-sm font-medium text-slate-700 dark:text-slate-300"},"Full Name",3,null),e("input",null,{type:"text",name:"name",id:"name",value:c,class:"mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm py-3 px-3 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm transition-all",required:!0,onInput$:w("s_GVdHcpX68tA",[c])},null,3,null),((G=(z=l.value)==null?void 0:z.fieldErrors)==null?void 0:G.name)&&e("p",null,{class:"text-red-500 text-sm mt-1"},y(M=>M.value.fieldErrors.name,[l],"p0.value.fieldErrors.name"),3,"3n_10")],1,null),e("div",null,null,[e("label",null,{for:"role",class:"block text-sm font-medium text-slate-700 dark:text-slate-300"},"Role",3,null),e("input",null,{type:"text",name:"role",id:"role",value:p,class:"mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm py-3 px-3 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm transition-all",placeholder:"e.g., Frontend Developer",required:!0,onInput$:w("s_jAxO9x2uMs4",[p])},null,3,null),((L=(k=l.value)==null?void 0:k.fieldErrors)==null?void 0:L.role)&&e("p",null,{class:"text-red-500 text-sm mt-1"},y(M=>M.value.fieldErrors.role,[l],"p0.value.fieldErrors.role"),3,"3n_11")],1,null),e("div",null,null,[e("div",null,null,[e("label",null,{for:"wallet",class:"block text-sm font-medium text-slate-700 dark:text-slate-300"},"Wallet (optional)",3,null),e("input",null,{type:"text",name:"wallet",id:"wallet",value:_,class:"mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm py-3 px-3 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm transition-all",placeholder:"Wallet address or ID",onInput$:w("s_lbSNTM5SAhM",[_])},null,3,null),((q=(f=l.value)==null?void 0:f.fieldErrors)==null?void 0:q.wallet)&&e("p",null,{class:"text-red-500 text-sm mt-1"},y(M=>M.value.fieldErrors.wallet,[l],"p0.value.fieldErrors.wallet"),3,"3n_12")],1,null),e("label",null,{for:"email",class:"block text-sm font-medium text-slate-700 dark:text-slate-300"},"Email",3,null),e("input",null,{type:"email",name:"email",id:"email",value:h,class:"mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm py-3 px-3 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm transition-all",onInput$:w("s_DyU1DEK6eOo",[h])},null,3,null),((Q=(W=l.value)==null?void 0:W.fieldErrors)==null?void 0:Q.email)&&e("p",null,{class:"text-red-500 text-sm mt-1"},y(M=>M.value.fieldErrors.email,[l],"p0.value.fieldErrors.email"),3,"3n_13")],1,null),e("div",null,null,[e("label",null,{for:"phone",class:"block text-sm font-medium text-slate-700 dark:text-slate-300"},"Phone",3,null),e("input",null,{type:"tel",name:"phone",id:"phone",value:v,class:"mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm py-3 px-3 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm transition-all",onInput$:w("s_NWWIOlSD3Rw",[v])},null,3,null)],3,null)],1,null),1,null)],1,null),1,null),1,null),e("div",null,{class:"bg-gradient-to-r from-slate-50 to-slate-100 dark:from-slate-700 dark:to-slate-800 px-6 py-4 sm:flex sm:flex-row-reverse"},[e("button",null,{type:"submit",disabled:y(M=>M.isRunning,[l],"p0.isRunning"),class:"w-full inline-flex justify-center items-center rounded-lg border border-transparent shadow-sm px-5 py-2.5 bg-gradient-to-r from-teal-500 to-teal-600 text-base font-medium text-white hover:from-teal-600 hover:to-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 sm:ml-3 sm:w-auto sm:text-sm transition-all duration-200 disabled:opacity-50"},[l.isRunning?d(oe,{class:"animate-spin h-5 w-5 mr-2",[a]:{class:a}},3,"3n_14"):d(Te,{class:"h-5 w-5 mr-2",[a]:{class:a}},3,"3n_15"),"Save Professional"],1,null),e("button",null,{type:"button",class:"mt-3 w-full inline-flex justify-center items-center rounded-lg border border-slate-200 dark:border-slate-600 shadow-sm px-5 py-2.5 bg-white dark:bg-slate-800 text-base font-medium text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm transition-all duration-200",onClick$:w("s_NLbcS0Hh0oA",[i])},[d(fe,{class:"h-5 w-5 mr-2",[a]:{class:a}},3,"3n_16"),"Cancel"],1,null)],1,null),((Z=l.value)==null?void 0:Z.success)===!1&&e("div",null,{class:"p-4 bg-red-100 text-red-800 rounded-b-lg"},[d(ae,{class:"inline h-5 w-5 mr-2",[a]:{class:a}},3,"3n_17"),y(M=>M.value.error,[l],"p0.value.error")],1,"3n_18")],[a]:{action:a,onSubmitCompleted$:a}},1,"3n_19"),1,null)],1,null),1,"3n_20"),o.value&&e("div",null,{class:"fixed inset-0 overflow-y-auto z-50 flex items-center justify-center"},[e("div",null,{class:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick$:w("s_Fw4HsovHP9U",[o])},null,3,null),e("div",null,{class:"relative bg-white dark:bg-slate-800 rounded-xl shadow-2xl w-full max-w-md mx-4 sm:mx-auto z-10 overflow-hidden"},[e("div",null,{class:"bg-gradient-to-r from-blue-500 to-blue-600 py-6 px-6"},[e("h3",null,{class:"text-xl font-semibold text-white flex items-center"},[d(Pe,{class:"h-5 w-5 mr-2",[a]:{class:a}},3,"3n_21"),"Edit Professional"],1,null),e("p",null,{class:"text-blue-100 text-sm mt-1"},"Update the professional's information",3,null)],1,null),d(ee,{action:s,onSubmitCompleted$:g(Ta,"s_mMfvy2XJjqs",[s,o]),children:[e("div",null,{class:"p-6"},e("div",null,{class:"space-y-6"},[e("input",null,{type:"hidden",name:"id",value:y(M=>M.value,[T],"p0.value")},null,3,null),e("div",null,null,[e("label",null,{for:"edit-name",class:"block text-sm font-medium text-slate-700 dark:text-slate-300"},"Name",3,null),e("input",null,{type:"text",name:"name",id:"edit-name",value:E,required:!0,class:"mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm py-3 px-3 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition-all",onInput$:w("s_0ZBxof0L4gU",[E])},null,3,null)],3,null),e("div",null,null,[e("label",null,{for:"edit-role",class:"block text-sm font-medium text-slate-700 dark:text-slate-300"},"Role",3,null),e("input",null,{type:"text",name:"role",id:"edit-role",value:I,required:!0,class:"mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm py-3 px-3 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition-all",onInput$:w("s_6W3vXIVkP74",[I])},null,3,null)],3,null),e("div",null,null,[e("label",null,{for:"edit-wallet",class:"block text-sm font-medium text-slate-700 dark:text-slate-300"},"Wallet Address",3,null),e("input",null,{type:"text",name:"wallet",id:"edit-wallet",value:N,placeholder:"0x...",class:"mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm py-3 px-3 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition-all font-mono",onInput$:w("s_ZAfnG9J9o7g",[N])},null,3,null)],3,null),e("div",null,{class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},[e("div",null,null,[e("label",null,{for:"edit-email",class:"block text-sm font-medium text-slate-700 dark:text-slate-300"},"Email",3,null),e("input",null,{type:"email",name:"email",id:"edit-email",value:D,class:"mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm py-3 px-3 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition-all",onInput$:w("s_kNAqpYnviD8",[D])},null,3,null)],3,null),e("div",null,null,[e("label",null,{for:"edit-phone",class:"block text-sm font-medium text-slate-700 dark:text-slate-300"},"Phone",3,null),e("input",null,{type:"tel",name:"phone",id:"edit-phone",value:R,class:"mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm py-3 px-3 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition-all",onInput$:w("s_0RnaKJYNBv8",[R])},null,3,null)],3,null)],3,null)],3,null),3,null),e("div",null,{class:"bg-gradient-to-r from-slate-50 to-slate-100 dark:from-slate-700 dark:to-slate-800 px-6 py-4 sm:flex sm:flex-row-reverse"},[e("button",null,{type:"submit",disabled:y(M=>M.isRunning,[s],"p0.isRunning"),class:"w-full inline-flex justify-center items-center rounded-lg border border-transparent shadow-sm px-5 py-2.5 bg-gradient-to-r from-blue-500 to-blue-600 text-base font-medium text-white hover:from-blue-600 hover:to-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm transition-all duration-200 disabled:opacity-50"},[s.isRunning?d(oe,{class:"animate-spin h-5 w-5 mr-2",[a]:{class:a}},3,"3n_22"):d(Te,{class:"h-5 w-5 mr-2",[a]:{class:a}},3,"3n_23"),"Update Professional"],1,null),e("button",null,{type:"button",class:"mt-3 w-full inline-flex justify-center items-center rounded-lg border border-slate-200 dark:border-slate-600 shadow-sm px-5 py-2.5 bg-white dark:bg-slate-800 text-base font-medium text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm transition-all duration-200",onClick$:w("s_274GbrB0tgE",[o])},[d(fe,{class:"h-5 w-5 mr-2",[a]:{class:a}},3,"3n_24"),"Cancel"],1,null)],1,null),((le=s.value)==null?void 0:le.success)===!1&&e("div",null,{class:"p-4 bg-red-100 text-red-800 rounded-b-lg"},[d(ae,{class:"inline h-5 w-5 mr-2",[a]:{class:a}},3,"3n_25"),y(M=>M.value.error,[s],"p0.value.error")],1,"3n_26")],[a]:{action:a,onSubmitCompleted$:a}},1,"3n_27")],1,null)],1,"3n_28"),u.value&&e("div",null,{class:"fixed inset-0 overflow-y-auto z-50 flex items-center justify-center"},[e("div",null,{class:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick$:w("s_0ceVdQIKjhg",[u])},null,3,null),e("div",null,{class:"relative bg-white dark:bg-slate-800 rounded-xl shadow-2xl w-full max-w-md mx-4 sm:mx-auto z-10 overflow-hidden"},[e("div",null,{class:"bg-gradient-to-r from-red-500 to-red-600 py-6 px-6"},[e("h3",null,{class:"text-xl font-semibold text-white flex items-center"},[d(ye,{class:"h-5 w-5 mr-2",[a]:{class:a}},3,"3n_29"),"Confirm Deletion"],1,null),e("p",null,{class:"text-red-100 text-sm mt-1"},"This action cannot be undone",3,null)],1,null),d(ee,{action:n,onSubmitCompleted$:g(Sa,"s_eem45vjZWkA",[n,m,u]),children:[e("div",null,{class:"p-6"},[e("input",null,{type:"hidden",name:"id",value:y(M=>M.value,[m],"p0.value")},null,3,null),e("div",null,{class:"text-center mb-6"},[e("div",null,{class:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 dark:bg-red-900/30"},d(ye,{class:"h-6 w-6 text-red-600 dark:text-red-500",[a]:{class:a}},3,"3n_30"),1,null),e("h3",null,{class:"mt-3 text-lg font-medium text-slate-900 dark:text-slate-100"},"Delete Professional",3,null),e("p",null,{class:"mt-2 text-sm text-slate-500 dark:text-slate-400"},"Are you sure you want to delete this professional? This action cannot be undone.",3,null)],1,null)],1,null),e("div",null,{class:"bg-gradient-to-r from-slate-50 to-slate-100 dark:from-slate-700 dark:to-slate-800 px-6 py-4 sm:flex sm:flex-row-reverse"},[e("button",null,{type:"submit",disabled:y(M=>M.isRunning,[n],"p0.isRunning"),class:"w-full inline-flex justify-center items-center rounded-lg border border-transparent shadow-sm px-5 py-2.5 bg-gradient-to-r from-red-500 to-red-600 text-base font-medium text-white hover:from-red-600 hover:to-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm transition-all duration-200 disabled:opacity-50"},[n.isRunning?d(oe,{class:"animate-spin h-5 w-5 mr-2",[a]:{class:a}},3,"3n_31"):d(ye,{class:"h-5 w-5 mr-2",[a]:{class:a}},3,"3n_32"),"Delete"],1,null),e("button",null,{type:"button",class:"mt-3 w-full inline-flex justify-center items-center rounded-lg border border-slate-200 dark:border-slate-600 shadow-sm px-5 py-2.5 bg-white dark:bg-slate-800 text-base font-medium text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm transition-all duration-200",onClick$:w("s_duhryAVQI0Q",[u])},[d(fe,{class:"h-5 w-5 mr-2",[a]:{class:a}},3,"3n_33"),"Cancel"],1,null)],1,null),((re=n.value)==null?void 0:re.success)===!1&&e("div",null,{class:"p-4 bg-red-100 text-red-800 rounded-b-lg"},[d(ae,{class:"inline h-5 w-5 mr-2",[a]:{class:a}},3,"3n_34"),y(M=>M.value.error,[n],"p0.value.error")],1,"3n_35")],[a]:{action:a,onSubmitCompleted$:a}},1,"3n_36")],1,null)],1,"3n_37")],1,"3n_38")},Ca=te(g(Ea,"s_ihBQ0teuNC8")),Da=Object.freeze(Object.defineProperty({__proto__:null,default:Ca,useAddProfessional:Ot,useAuthLoader:Lt,useDeleteProfessional:Pt,useEditProfessional:jt,useProfessionalsLoader:Mt},Symbol.toStringTag,{value:"Module"})),Ra=async t=>{const l=await H(t);if(!(l!=null&&l.isAuthenticated)||!ie(l))throw t.redirect(302,"/auth");return l},Ut=V(g(Ra,"s_HEMMVDaKQS8")),Ia=async t=>{const l=await H(t);if(!ie(l))throw t.fail(401,{error:"Unauthorized"});const r=(await F(t).execute("SELECT * FROM app_settings WHERE id = 1")).rows[0];return{...r,notifications_enabled:!!r.notifications_enabled}},Nt=V(g(Ia,"s_OCPwWYs74WM")),Aa=async(t,l)=>{const s=await H(l);if(!(s!=null&&s.is_admin))return{success:!1,error:"Unauthorized"};const n=F(l);try{return await n.execute({sql:`
          UPDATE app_settings SET 
            company_name = ?, company_email = ?, company_logo_url = ?, 
            invoice_prefix = ?, default_currency = ?, payment_methods = ?, 
            notifications_enabled = ?, theme = ?, updated_at = CURRENT_TIMESTAMP
          WHERE id = 1
        `,args:[t.company_name,t.company_email,t.company_logo_url||null,t.invoice_prefix,t.default_currency,JSON.stringify(t.payment_methods),t.notifications_enabled?1:0,t.theme]}),{success:!0}}catch(r){return console.error(r),{success:!1,error:"Failed to update settings."}}},La={company_name:U.string().min(1),company_email:U.string().email(),company_logo_url:U.string().url().optional().or(U.literal("")),invoice_prefix:U.string().max(10),default_currency:U.string(),payment_methods:U.array(U.string()),notifications_enabled:U.boolean(),theme:U.enum(["light","dark","system"])},$t=Y(g(Aa,"s_XJ5eJM6wJS4"),ne(g(La,"s_qOz9xR07XuY"))),Ma=()=>{var _;X(),Ut();const t=Nt(),l=$t(),s=b(t.value.company_name),n=b(t.value.company_email),r=b(t.value.company_logo_url||""),i=b(t.value.invoice_prefix),o=b(t.value.default_currency),u=b(JSON.parse(t.value.payment_methods||"[]")),m=b(!!t.value.notifications_enabled),c=b(t.value.theme),p=[{value:"bank_transfer",label:"Bank Transfer"},{value:"paypal",label:"PayPal"},{value:"wise",label:"Wise"},{value:"crypto",label:"Crypto"}],h=[{value:"USD",label:"USD - US Dollar"},{value:"EUR",label:"EUR - Euro"}],v=[{value:"light",label:"Light"},{value:"dark",label:"Dark"},{value:"system",label:"System"}];return e("main",null,{class:"min-h-screen bg-gradient-to-br from-slate-50 via-slate-100 to-slate-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900"},e("div",null,{class:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},[e("header",null,{class:"mb-8 bg-gradient-to-r from-slate-100 to-slate-50 dark:from-slate-800 dark:to-slate-700 rounded-xl shadow-sm p-6"},e("div",null,{class:"flex items-center"},[d(yl,{class:"h-8 w-8 text-teal-600 dark:text-teal-500 mr-3",[a]:{class:a}},3,"cI_0"),e("div",null,null,[e("h1",null,{class:"text-2xl sm:text-3xl font-bold text-slate-800 dark:text-slate-100"},"Application Settings",3,null),e("p",null,{class:"text-slate-500 dark:text-slate-400 mt-1"},"Manage global application settings",3,null)],3,null)],1,null),1,null),d(ee,{action:l,class:"space-y-8",children:[e("div",null,{class:"bg-white dark:bg-slate-800 shadow-lg rounded-xl border border-slate-200 dark:border-slate-700"},[e("div",null,{class:"p-6 border-b border-slate-200 dark:border-slate-700 flex items-center"},[d(ml,{class:"h-6 w-6 text-teal-600 dark:text-teal-500 mr-3",[a]:{class:a}},3,"cI_1"),e("h2",null,{class:"text-lg font-semibold text-slate-800 dark:text-slate-100"},"Company Information",3,null)],1,null),e("div",null,{class:"p-6 grid grid-cols-1 md:grid-cols-2 gap-6"},[e("div",null,null,[e("label",null,{for:"company_name",class:"block text-sm font-medium text-slate-700 dark:text-slate-300"},"Company Name",3,null),e("input",null,{type:"text",name:"company_name",id:"company_name",value:s,class:"mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm py-2 px-3 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 focus:outline-none focus:ring-teal-500 focus:border-teal-500",onInput$:w("s_ytQl2RUxF1g",[s])},null,3,null)],3,null),e("div",null,null,[e("label",null,{for:"company_email",class:"block text-sm font-medium text-slate-700 dark:text-slate-300"},"Company Email",3,null),e("input",null,{type:"email",name:"company_email",id:"company_email",value:n,class:"mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm py-2 px-3 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 focus:outline-none focus:ring-teal-500 focus:border-teal-500",onInput$:w("s_4BpnU5fjv4o",[n])},null,3,null)],3,null),e("div",null,{class:"md:col-span-2"},[e("label",null,{for:"company_logo_url",class:"block text-sm font-medium text-slate-700 dark:text-slate-300"},"Logo URL",3,null),e("input",null,{type:"url",name:"company_logo_url",id:"company_logo_url",value:r,class:"mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm py-2 px-3 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 focus:outline-none focus:ring-teal-500 focus:border-teal-500",onInput$:w("s_ENb9DsgOlVs",[r])},null,3,null)],3,null)],3,null)],1,null),e("div",null,{class:"bg-white dark:bg-slate-800 shadow-lg rounded-xl border border-slate-200 dark:border-slate-700"},[e("div",null,{class:"p-6 border-b border-slate-200 dark:border-slate-700 flex items-center"},[d(he,{class:"h-6 w-6 text-teal-600 dark:text-teal-500 mr-3",[a]:{class:a}},3,"cI_2"),e("h2",null,{class:"text-lg font-semibold text-slate-800 dark:text-slate-100"},"Invoice Settings",3,null)],1,null),e("div",null,{class:"p-6 grid grid-cols-1 md:grid-cols-2 gap-6"},[e("div",null,null,[e("label",null,{for:"invoice_prefix",class:"block text-sm font-medium text-slate-700 dark:text-slate-300"},"Invoice Prefix",3,null),e("input",null,{type:"text",name:"invoice_prefix",id:"invoice_prefix",value:i,class:"mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm py-2 px-3 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 focus:outline-none focus:ring-teal-500 focus:border-teal-500",onInput$:w("s_ca07GSOeg1o",[i])},null,3,null)],3,null),e("div",null,null,[e("label",null,{for:"default_currency",class:"block text-sm font-medium text-slate-700 dark:text-slate-300"},"Default Currency",3,null),e("select",null,{name:"default_currency",id:"default_currency",value:o,class:"mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm py-2 px-3 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 focus:outline-none focus:ring-teal-500 focus:border-teal-500",onInput$:w("s_lLUvYLnkacs",[o])},h.map(T=>e("option",{value:A(T,"value")},null,T.label,1,T.value)),1,null)],1,null)],1,null)],1,null),e("div",null,{class:"bg-white dark:bg-slate-800 shadow-lg rounded-xl border border-slate-200 dark:border-slate-700"},[e("div",null,{class:"p-6 border-b border-slate-200 dark:border-slate-700 flex items-center"},[d(pl,{class:"h-6 w-6 text-teal-600 dark:text-teal-500 mr-3",[a]:{class:a}},3,"cI_3"),e("h2",null,{class:"text-lg font-semibold text-slate-800 dark:text-slate-100"},"Payment Methods",3,null)],1,null),e("div",null,{class:"p-6 grid grid-cols-2 md:grid-cols-4 gap-4"},p.map(T=>e("div",null,{class:"flex items-center"},[e("input",{id:`payment-${T.value}`,value:A(T,"value"),checked:u.value.includes(T.value),onChange$:w("s_9IYanuJ7Uic",[T,u])},{type:"checkbox",name:"payment_methods",class:"h-4 w-4 text-teal-600 focus:ring-teal-500 border-slate-300 dark:border-slate-600 rounded"},null,2,null),e("label",{for:`payment-${T.value}`},{class:"ml-2 text-sm text-slate-700 dark:text-slate-300"},A(T,"label"),1,null)],1,T.value)),1,null)],1,null),e("div",null,{class:"bg-white dark:bg-slate-800 shadow-lg rounded-xl border border-slate-200 dark:border-slate-700"},[e("div",null,{class:"p-6 border-b border-slate-200 dark:border-slate-700 flex items-center"},[d(vl,{class:"h-6 w-6 text-teal-600 dark:text-teal-500 mr-3",[a]:{class:a}},3,"cI_4"),e("h2",null,{class:"text-lg font-semibold text-slate-800 dark:text-slate-100"},"Appearance & Notifications",3,null)],1,null),e("div",null,{class:"p-6 grid grid-cols-1 md:grid-cols-2 gap-6 items-center"},[e("div",null,null,[e("label",null,{for:"theme",class:"block text-sm font-medium text-slate-700 dark:text-slate-300"},"Theme",3,null),e("select",null,{name:"theme",id:"theme",value:c,class:"mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm py-2 px-3 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 focus:outline-none focus:ring-teal-500 focus:border-teal-500",onInput$:w("s_6hiRG0tcDe4",[c])},v.map(T=>e("option",{value:A(T,"value")},null,T.label,1,T.value)),1,null)],1,null),e("div",null,{class:"flex items-center pt-6"},[e("input",null,{type:"checkbox",id:"notifications_enabled",name:"notifications_enabled",checked:m,class:"h-4 w-4 text-teal-600 focus:ring-teal-500 border-slate-300 dark:border-slate-600 rounded",onInput$:w("s_8iPCJdppKeA",[m])},null,3,null),e("label",null,{for:"notifications_enabled",class:"ml-2 text-sm font-medium text-slate-700 dark:text-slate-300"},"Enable Notifications",3,null)],3,null)],1,null)],1,null),e("div",null,{class:"flex justify-end items-center pt-4"},[((_=l.value)==null?void 0:_.success)===!1&&e("div",null,{class:"text-red-600 dark:text-red-400 mr-4 flex items-center"},[d(ae,{class:"h-5 w-5 mr-2",[a]:{class:a}},3,"cI_5"),y(T=>T.value.error,[l],"p0.value.error")],1,"cI_6"),e("button",null,{type:"submit",disabled:y(T=>T.isRunning,[l],"p0.isRunning"),class:"inline-flex items-center justify-center px-6 py-3 border border-transparent rounded-lg shadow-sm text-base font-medium text-white bg-gradient-to-r from-teal-500 to-teal-600 hover:from-teal-600 hover:to-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 transition-all duration-200 disabled:opacity-50"},[l.isRunning?d(oe,{class:"animate-spin h-5 w-5 mr-2",[a]:{class:a}},3,"cI_7"):d(Te,{class:"h-5 w-5 mr-2",[a]:{class:a}},3,"cI_8"),"Save Settings"],1,null)],1,null)],[a]:{action:a,class:a}},1,"cI_9")],1,null),1,"cI_10")},Oa=te(g(Ma,"s_pkX8xUp3FVg")),Pa=Object.freeze(Object.defineProperty({__proto__:null,default:Oa,useAuthLoader:Ut,useSettingsLoader:Nt,useUpdateSettings:$t},Symbol.toStringTag,{value:"Module"})),ja=[{inputs:[{internalType:"address",name:"_registry",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[{internalType:"address",name:"owner",type:"address"}],name:"OwnableInvalidOwner",type:"error"},{inputs:[{internalType:"address",name:"account",type:"address"}],name:"OwnableUnauthorizedAccount",type:"error"},{inputs:[],name:"ReentrancyGuardReentrantCall",type:"error"},{inputs:[{internalType:"address",name:"token",type:"address"}],name:"SafeERC20FailedOperation",type:"error"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"lockId",type:"uint256"},{indexed:!0,internalType:"address",name:"token",type:"address"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"},{indexed:!1,internalType:"uint256",name:"releaseTime",type:"uint256"},{indexed:!1,internalType:"address[]",name:"recipients",type:"address[]"},{indexed:!1,internalType:"uint256[]",name:"amounts",type:"uint256[]"},{indexed:!1,internalType:"uint256",name:"invoiceId",type:"uint256"}],name:"LockCreated",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"lockId",type:"uint256"}],name:"LockReleased",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"previousOwner",type:"address"},{indexed:!0,internalType:"address",name:"newOwner",type:"address"}],name:"OwnershipTransferred",type:"event"},{inputs:[{internalType:"address",name:"linkToken",type:"address"},{internalType:"address",name:"to",type:"address"}],name:"cancelUpkeepAndWithdraw",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes",name:"",type:"bytes"}],name:"checkUpkeep",outputs:[{internalType:"bool",name:"upkeepNeeded",type:"bool"},{internalType:"bytes",name:"performData",type:"bytes"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"totalAmount",type:"uint256"},{internalType:"address[]",name:"recipients",type:"address[]"},{internalType:"uint256[]",name:"amounts",type:"uint256[]"},{internalType:"uint256",name:"releaseTime",type:"uint256"},{internalType:"uint256",name:"invoiceId",type:"uint256"}],name:"createLock",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"tokenAddress",type:"address"},{internalType:"address",name:"to",type:"address"}],name:"emergencyWithdraw",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"forwarder",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"getAllLocks",outputs:[{internalType:"uint256[]",name:"ids",type:"uint256[]"},{internalType:"address[]",name:"tokens",type:"address[]"},{internalType:"uint256[]",name:"amounts",type:"uint256[]"},{internalType:"uint256[]",name:"releaseTimes",type:"uint256[]"},{internalType:"bool[]",name:"released",type:"bool[]"},{internalType:"address[][]",name:"recipients",type:"address[][]"},{internalType:"uint256[][]",name:"recipientAmounts",type:"uint256[][]"},{internalType:"uint256[]",name:"invoiceIds",type:"uint256[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"recipient",type:"address"}],name:"getLocksByRecipient",outputs:[{internalType:"uint256[]",name:"ids",type:"uint256[]"},{internalType:"address[]",name:"tokens",type:"address[]"},{internalType:"uint256[]",name:"amounts",type:"uint256[]"},{internalType:"uint256[]",name:"releaseTimes",type:"uint256[]"},{internalType:"bool[]",name:"released",type:"bool[]"},{internalType:"address[][]",name:"recipientsArr",type:"address[][]"},{internalType:"uint256[][]",name:"recipientAmounts",type:"uint256[][]"},{internalType:"uint256[]",name:"invoiceIds",type:"uint256[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"locks",outputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"uint256",name:"releaseTime",type:"uint256"},{internalType:"bool",name:"released",type:"bool"},{internalType:"uint256",name:"invoiceId",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"nextLockId",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes",name:"",type:"bytes"}],name:"performUpkeep",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"registry",outputs:[{internalType:"contract AutomationRegistryInterface",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"renounceOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_forwarder",type:"address"}],name:"setForwarderAddress",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"_id",type:"uint256"}],name:"setUpkeepId",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"newOwner",type:"address"}],name:"transferOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"upkeepId",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"linkToken",type:"address"},{internalType:"address",name:"to",type:"address"}],name:"withdrawAllLink",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"linkToken",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"withdrawLink",outputs:[],stateMutability:"nonpayable",type:"function"}],Ua=async()=>{const[t,l,s]=O();return l.value="MetaMask solo se puede usar en el navegador.",!1},Na=async(t,l,s,n,r,i,o)=>{const[u,m,c,p,h]=O();p.value="Esta acción solo se puede realizar en el navegador."},$a=async()=>{const[t,l,s,n]=O();s.value=!0,l.value="",console.log("[TimeLock] Iniciando carga de locks..."),window.dbLocks&&console.log("[TimeLock] dbLocks:",window.dbLocks);try{const r=al({chain:Ve,transport:nl(Ve.rpcUrls.default.http[0])});console.log("[TimeLock] Llamando a getAllLocks en el contrato:",t);const i=await r.readContract({address:t,abi:ja,functionName:"getAllLocks"});if(console.log("[TimeLock] Resultado de getAllLocks:",i),!i||!Array.isArray(i)||i.length<8){l.value="El contrato no devolvió el formato esperado de locks.",console.error("[TimeLock] Formato inesperado:",i),n.value=[],s.value=!1;return}const[o,u,m,c,p,h,v,_]=i,T=(o||[]).map((E,I)=>({id:E,token:u[I],totalAmount:m[I],releaseTime:c[I],released:p[I],recipients:h[I],amounts:v[I],invoiceId:_[I]}));n.value=T,console.log("[TimeLock] Locks parseados:",T)}catch(r){l.value=r.message||"Error al leer locks",console.error("[TimeLock] Error al leer locks:",r)}s.value=!1},Fa=async()=>{const[t,l,s,n,r]=O();s.value="Esta acción solo se puede realizar en el navegador."};function qa(){const t=b(null),l=b(""),s=b(""),n=b([]),r=b(!1),i=g(Ua,"s_81MCpzm7a6o",[t,s,l]),o="0xa210Fff1cfD0ffBdF4A623682dB2102bef8473D2",u=g(Na,"s_Nk78oOdFUOs",[o,t,i,s,l]),m=g($a,"s_nugdMjWhp0M",[o,s,r,n]);return{address:t,status:l,error:s,locks:n,loadingLocks:r,connect:i,createLock:u,loadLocks:m,performUpkeep:g(Fa,"s_03RWAw0emAM",[o,t,s,m,l])}}const Ba=async t=>{var _;const l=F(t);if(!(await H(t)).isAuthenticated)throw t.fail(401,{error:"Unauthorized"});const n=new URL(t.request.url),r=Number(n.searchParams.get("locksPage")||1),i=Number(n.searchParams.get("locksPerPage")||10),o=(r-1)*i,u=`
    SELECT t.id, t.payment_id, t.invoice_id as facturaId, t.release_timestamp, t.status,
           i.invoice_url, i.amount, i.currency, i.status as invoice_status,
           prof.name, prof.email, prof.wallet,
           c.contract_url, c.id as contract_id
    FROM timelocks t
    LEFT JOIN invoices i ON t.invoice_id = i.id
    LEFT JOIN professionals prof ON i.professional_id = prof.id
    LEFT JOIN contracts c ON i.contract_id = c.id
    ORDER BY t.id DESC
    LIMIT ? OFFSET ?`,m=[i,o],c=await l.execute({sql:u,args:m}),h=((_=(await l.execute("SELECT COUNT(*) as total FROM payments")).rows[0])==null?void 0:_.total)||0,v=await l.execute("SELECT id, name, email, wallet FROM professionals ORDER BY name");return{locks:c.rows,total:h,page:r,limit:i,professionals:v.rows}},Ft=V(g(Ba,"s_vJidTSJ0IPw"));function qt(t){switch(t){case"USDC":return"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48";case"USDT":return"0xdAC17F958D2ee523a2206206994597C13D831ec7";case"DAI":return"0x6B175474E89094C44Da98b954EedeAC495271d0F";case"KNRT":{const l="0x54de10fadf4ea2fbad10ebfc96979d0885dd36fa".replace(/"/g,"");return l&&l.startsWith("0x")?l:void 0}default:return}}const za=async t=>{const l=await H(t);if(!(l!=null&&l.isAuthenticated))throw t.redirect(302,"/auth");return l},Ha=V(g(za,"s_D9LiNjAXUhY")),Wa=async t=>{console.log("[planner-auto] loader: requestEvent",{url:t.request.url});const l=await H(t);if(!l.isAuthenticated)throw t.fail(401,{error:"Unauthorized"});const s=F(t),n=new URL(t.request.url),r=n.searchParams.get("month")||(new Date().getMonth()+1).toString(),i=n.searchParams.get("year")||new Date().getFullYear().toString(),o=`${i}-${String(r).padStart(2,"0")}-01`,m=new Date(Number(i),Number(r),0).getDate(),c=`${i}-${String(r).padStart(2,"0")}-${String(m).padStart(2,"0")}`;let p=`
      SELECT p.id, p.professional_id, prof.name as professional_name, prof.wallet as professional_wallet,
             p.amount, p.currency, p.status, p.due_date, p.description, p.contract_id, c.id as contract_id, c.start_date, c.end_date, c.status as contract_status, c.contract_url
      FROM payments p
      JOIN professionals prof ON p.professional_id = prof.id
      LEFT JOIN contracts c ON p.contract_id = c.id
      WHERE p.due_date BETWEEN ? AND ?`;const h=[o,c];ie(l)||(p+=" AND prof.email = ?",h.push(l.email)),p+=`
      ORDER BY p.due_date ASC`;const v=await s.execute({sql:p,args:h}),_=await s.execute("SELECT id, name, wallet FROM professionals ORDER BY name"),T=await s.execute(`
    SELECT c.id, c.professional_id, c.start_date, c.end_date, c.status, c.contract_url
    FROM contracts c
    WHERE c.status = 'active'
    ORDER BY c.start_date DESC
  `),E={payments:v.rows.map(I=>({...I,amount:Number(I.amount)})),professionals:_.rows,contracts:T.rows,currentMonth:Number(r),currentYear:Number(i)};return console.log("[planner-auto] loader result",JSON.stringify(E,null,2)),E},Bt=V(g(Wa,"s_ciAoTd0tSN0")),Ya=async t=>{const l=F(t),s=await H(t);if(!s.isAuthenticated)throw t.fail(401,{error:"Unauthorized"});const r=(await l.execute("SELECT id, name, role, email, wallet FROM professionals ORDER BY name")).rows,o=(await l.execute(`
    SELECT c.id, c.professional_id, p.name as professional_name, c.start_date, c.end_date, c.status, c.contract_url
    FROM contracts c
    JOIN professionals p ON c.professional_id = p.id
    WHERE c.status = 'active'
    ORDER BY p.name, c.start_date DESC
  `)).rows;let u;ie(s)?u=await l.execute(`
      SELECT s.*, p.name as professional_name, p.email as professional_email
      FROM settlements s
      JOIN professionals p ON s.professional_id = p.id
      ORDER BY s.payment_date DESC, s.id DESC
    `):u=await l.execute({sql:`SELECT s.*, p.name as professional_name, p.email as professional_email
            FROM settlements s
            JOIN professionals p ON s.professional_id = p.id
            WHERE p.email = ?
            ORDER BY s.payment_date DESC, s.id DESC`,args:[s.email]});const m=u.rows;let c;ie(s)?c=await l.execute(`
      SELECT i.id, i.professional_id, p.name as professional_name, i.contract_id, i.amount, i.currency, i.status, i.issue_date, i.paid_date, i.invoice_url, i.created_date 
      FROM invoices i
      JOIN professionals p ON i.professional_id = p.id
      ORDER BY i.created_date DESC
    `):c=await l.execute({sql:`SELECT i.id, i.professional_id, p.name as professional_name, i.contract_id, i.amount, i.currency, i.status, i.issue_date, i.paid_date, i.invoice_url, i.created_date 
            FROM invoices i
            JOIN professionals p ON i.professional_id = p.id
            WHERE p.email = ?
            ORDER BY i.created_date DESC`,args:[s.email]});const p=c.rows.map(h=>({...h,amount:Number(h.amount)}));return{professionals:r,contracts:o,invoices:p,settlements:m,session:s}},zt=V(g(Ya,"s_YeuiPGf0MkM")),Va=async(t,l)=>{const s=F(l),n=await H(l);if(!n.isAuthenticated||!n.userId)return{success:!1,error:"Authentication required."};const r=await s.execute({sql:"SELECT * FROM invoices WHERE id = ?",args:[t.invoiceId]});if(!r.rows.length)return{success:!1,error:"Invoice not found."};const i=r.rows[0];try{return await s.execute({sql:"UPDATE invoices SET status = ? WHERE id = ?",args:["paid",t.invoiceId]}),await s.execute({sql:"INSERT INTO settlements (professional_id, user_id, month, year, total_amount, currency, status, payment_date) VALUES (?, ?, ?, ?, ?, ?, ?, ?)",args:[i.professional_id,n.userId,new Date(i.issue_date).getMonth()+1,new Date(i.issue_date).getFullYear(),i.amount,i.currency,"paid",new Date().toISOString().split("T")[0]]}),Date.now(),await s.execute({sql:"INSERT INTO timelocks (payment_id, invoice_id, release_timestamp, status) VALUES (?, ?, ?, ?)",args:[t.invoiceId,t.invoiceId,t.releaseTimestamp??Math.floor(Date.now()/1e3)+86400,"pending"]}),{success:!0}}catch{return{success:!1,error:"Failed to automate payment."}}},Qa=t=>t.object({invoiceId:t.coerce.number().int().positive(),releaseTimestamp:t.coerce.number().int().positive().optional()}),Ht=Y(g(Va,"s_BtIs65RC1kg"),ne(g(Qa,"s_LgRY0xLp03w"))),Ga=async(t,l)=>{const s=await H(l);if(!s.isAuthenticated||!s.userId)return{success:!1,error:"Authentication required"};const n=F(l);try{return await n.execute({sql:"INSERT INTO settlements (professional_id, user_id, month, year, total_amount, currency, status) VALUES (?, ?, ?, ?, ?, ?, ?)",args:[t.professionalId,s.userId,t.month,t.year,t.totalAmount,t.currency,"pending"]}),{success:!0}}catch(r){return console.error(r),{success:!1,error:"Failed to create settlement."}}},Za=t=>t.object({professionalId:t.coerce.number(),month:t.coerce.number().min(1).max(12),year:t.coerce.number().min(2e3).max(2100),totalAmount:t.coerce.number().positive(),currency:t.string().min(3)}),Ja=Y(g(Ga,"s_igFdqUmxqns"),ne(g(Za,"s_QEe4M0HM2F8"))),Ka=async({id:t,status:l},s)=>{const n=F(s),r=l==="paid"?"pending":"paid",i=r==="paid"?new Date().toISOString().split("T")[0]:null;try{return await n.execute({sql:"UPDATE settlements SET status = ?, payment_date = ? WHERE id = ?",args:[String(r),i?String(i):null,String(t)]}),{success:!0}}catch{return{success:!1,error:"Failed to update status."}}},Xa=Y(g(Ka,"s_9x1ijvU6PpI")),en=async({id:t},l)=>{const s=F(l);try{return await s.execute({sql:"DELETE FROM settlements WHERE id = ?",args:[String(t)]}),{success:!0}}catch{return{success:!1,error:"Failed to delete settlement."}}},tn=Y(g(en,"s_aH8dasVygFA")),Wt=[{value:"1",label:"January"},{value:"2",label:"February"},{value:"3",label:"March"},{value:"4",label:"April"},{value:"5",label:"May"},{value:"6",label:"June"},{value:"7",label:"July"},{value:"8",label:"August"},{value:"9",label:"September"},{value:"10",label:"October"},{value:"11",label:"November"},{value:"12",label:"December"}],Yt=()=>{const t=new Date().getFullYear(),l=[];for(let s=t-3;s<=t+1;s++)l.push({value:s.toString(),label:s.toString()});return l},ln=async()=>{const[t,l,s]=O(),n=l.value;t.value=n.locks,s.value=Number(n.total)},sn=async()=>{const[t,l,s,n,r,i,o,u,m,c,p,h]=O(),v=qt(p.value);if(!v){r.error.value="Unsupported token.";return}if(!h.value){r.error.value="Professional's wallet is required.";return}if(l.value)return;const _=c.value,T=o.value,E=parseInt(u.value,10),I=parseInt(m.value,10),[D,R,N]=T.split("-").map(Number),S=sl.fromObject({year:D,month:R,day:N,hour:E,minute:I},{zone:_||"UTC"}),$=Math.floor(S.toSeconds());if(n.value==null){r.error.value="No se ha seleccionado una factura válida.";return}try{if(await r.createLock(v,i.value.toString(),h.value,i.value.toString(),$.toString(),n.value,t),r.status.value==="Lock creado correctamente"){r.status.value="Timelock creado y factura automatizada.";const C=s.value.invoices.findIndex(z=>z.id===n.value);C!==-1&&(s.value.invoices[C].status="paid"),closeAutomateModal()}}catch(C){r.error.value=(C==null?void 0:C.message)||"Error al crear el timelock en MetaMask."}},an=({track:t})=>{const[l,s,n,r,i,o,u]=O(),m=t(()=>u.value.trim().toLowerCase()),c=t(()=>s.value),p=t(()=>r.value),h=t(()=>l.value),v=t(()=>n.value);i.value=o.value.professionals.filter(_=>{let T=!0;m&&(T=_.name.toLowerCase().includes(m)||(_.email??"").toLowerCase().includes(m));const E=o.value.invoices.filter(S=>S.professional_id===_.id);if(E.length===0&&(c||p||h||v))return!1;const I=!c||E.some(S=>String(new Date(S.issue_date).getUTCMonth()+1)===c),D=!p||E.some(S=>String(new Date(S.issue_date).getUTCFullYear())===p),R=!h||E.some(S=>S.currency===h),N=!v||E.some(S=>S.status===v);return T&&I&&D&&R&&N})},nn=t=>{const[l,s,n,r,i,o,u,m,c,p]=O();n.value=t;const h=l.value.invoices.find(_=>_.id===t);if(!h)return;const v=l.value.professionals.find(_=>_.id===h.professional_id);c.value=h.currency||"USDC",p.value=(v==null?void 0:v.wallet)||"",i.value=h.amount||0,o.value=new Date(Date.now()+864e5).toISOString().split("T")[0],u.value="10",m.value="0",s.value=String(h.contract_id??""),r.value=!0},rn=()=>{const[t,l,s,n]=O();s.value=!1,l.value=null,n.error.value="",n.status.value="",t.value=""},on=({track:t})=>{const[l,s]=O(),n=t(()=>s.status.value);n&&n.includes("Lock creado correctamente")&&(l(),typeof window<"u"&&window.location.reload())},un=async()=>{const[t,l]=O();function s(R,N,S,$,C,z,G=60){const k=[];let L=N;for(;L.length>G;){let f=L.lastIndexOf(" ",G);f===-1&&(f=G),k.push(L.slice(0,f)),L=L.slice(f).trim()}return k.push(L),k.forEach(f=>{R.drawText(f,{x:S,y:$,size:z,font:C}),$-=z+2}),$}await import("tslib");const{PDFDocument:n,rgb:r,StandardFonts:i}=await import("pdf-lib/dist/pdf-lib.esm.js"),o={name:l.name,email:l.email,wallet:l.wallet},u=t.value.contracts.filter(R=>R.professional_id===l.id),m=t.value.invoices.filter(R=>R.professional_id===l.id),c=await n.create(),p=c.addPage([595,842]),h=await c.embedFont(i.Helvetica);let v=800;p.drawText("Resumen de Settlement",{x:50,y:v,size:20,font:h,color:r(0,.5,.7)}),v-=30,p.drawText(`Profesional: ${o.name} (${o.email})`,{x:50,y:v,size:14,font:h}),v-=20,p.drawText(`Wallet: ${o.wallet||"-"}`,{x:50,y:v,size:12,font:h}),v-=30,p.drawText("Contratos:",{x:50,y:v,size:14,font:h}),v-=18;const _="https://saveetimelock-knrt.fly.dev";if(u.length===0?(p.drawText("Sin contratos",{x:60,y:v,size:12,font:h}),v-=16):u.forEach((R,N)=>{let S=R.contract_url?`${_}/api/contracts/view/${R.contract_url}`:"",$=`#${N+1} Estado: ${R.status} | Inicio: ${R.start_date} | Fin: ${R.end_date||"Presente"} | URL: ${S}`;$+=R.type?` | Tipo: ${R.type}`:"",$+=R.amount?` | Monto: ${R.amount} ${R.currency||""}`:"",$+=R.description?` | Descripción: ${R.description}`:"",$+=R.created_at?` | Creado: ${R.created_at}`:"",v=s(p,$,60,v,h,12,60)}),v-=10,p.drawText("Facturas:",{x:50,y:v,size:14,font:h}),v-=18,m.length===0)p.drawText("Sin facturas",{x:60,y:v,size:12,font:h}),v-=16;else{m.forEach((S,$)=>{let C=S.invoice_url?`${_}/api/invoices/view/${S.invoice_url}`:"",z=`#${$+1} Estado: ${S.status} | Monto: ${S.amount} ${S.currency} | Emitida: ${S.issue_date}`;z+=S.paid_date?` | Pagada: ${S.paid_date}`:"",z+=C?` | URL: ${C}`:"",z+=S.description?` | Descripción: ${S.description}`:"",z+=S.created_at?` | Creado: ${S.created_at}`:"",z+=S.updated_at?` | Actualizado: ${S.updated_at}`:"",z+=S.professional_name?` | Profesional: ${S.professional_name}`:"",v=s(p,z,60,v,h,12,60)});const R=m.filter(S=>S.status==="paid").reduce((S,$)=>S+(Number($.amount)||0),0),N=m.filter(S=>S.status==="pending").reduce((S,$)=>S+(Number($.amount)||0),0);v-=10,p.drawText(`Total pagado: ${R} USD`,{x:60,y:v,size:13,font:h,color:r(0,.5,0)}),v-=16,p.drawText(`Total pendiente: ${N} USD`,{x:60,y:v,size:13,font:h,color:r(.7,.5,0)}),v-=18}const T=await c.save(),E=new Blob([new Uint8Array(T)],{type:"application/pdf"}),I=URL.createObjectURL(E),D=document.createElement("a");D.href=I,D.download=`settlement_${o.name}.pdf`,document.body.appendChild(D),D.click(),setTimeout(()=>{document.body.removeChild(D),URL.revokeObjectURL(I)},100)},dn=()=>{X();const t=b(!0),l=b([]),s=b(1),n=b(0),r=Ft();Se(w("s_e46ZeN7c0po",[g(ln,"s_DU0gmHOYIVM",[l,r,n]),s,t]));const o=zt(),u=Ht(),m=b(""),c=b(!1),p=b(null),h=b(""),v=qa(),_=b("USDC"),T=b(Intl.DateTimeFormat().resolvedOptions().timeZone||"UTC"),E=b(""),I=b(0),D=b(new Date(Date.now()+864e5).toISOString().split("T")[0]),R=b("10"),N=b("0"),S=b(""),$=b(new Date),C=b(new Date),z=b(new Date);Se(w("s_BclXGPWLo4M",[h,$,C,z,c,D,R,N,T]));const G=g(sn,"s_QJi0lpNmFpU",[u,h,o,p,v,I,D,R,N,T,_,E]),k=b(String(new Date().getMonth()+1)),L=b(String(new Date().getFullYear())),f=b(""),q=b(""),W=b(o.value.professionals);ce(g(an,"s_sozVq3kqzM4",[f,k,q,L,W,o,m]));const Q=x=>o.value.contracts.filter(j=>j.professional_id===x),Z=x=>o.value.invoices.filter(j=>j.professional_id===x),le=g(nn,"s_006zcKdtEVo",[o,S,p,c,I,D,R,N,_,E]),re=g(rn,"s_BhwBmIFt2cA",[h,p,c,v]);ce(g(on,"s_IVinuTb0nCs",[re,v]));const M=x=>{const j=new Date(Number(x)*1e3);return j.toLocaleDateString()+" "+j.toLocaleTimeString()};Bt();const xe=b(!1);return b(null),Se(w("s_AhJYVb2Md5Q",[xe,v])),e("main",null,{class:"min-h-screen bg-gradient-to-br from-slate-50 via-slate-100 to-slate-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900"},e("div",null,{class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},[e("header",null,{class:"mb-8 bg-gradient-to-r from-slate-100 to-slate-50 dark:from-slate-800 dark:to-slate-700 rounded-xl shadow-sm p-6"},[e("div",null,{class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},[e("h1",null,{class:"text-2xl font-bold text-slate-800 dark:text-slate-100"},"Settlements Dashboard",3,null),e("div",null,{class:"flex flex-col sm:flex-row items-center gap-3"},o.value.session&&ie(o.value.session)&&e("button",null,{class:"inline-flex items-center px-4 py-2 rounded-lg bg-gradient-to-r from-indigo-500 to-purple-500 text-white font-medium text-sm shadow-md hover:from-indigo-600 hover:to-purple-600 transition-all",onClick$:w("s_yR9FJvWweUY",[xe,v])},v.address.value?d(We,{children:[d(Ze,{class:"h-5 w-5 mr-2",[a]:{class:a}},3,"3q_0")," ",y(x=>x.value?"Ocultar Timelocks":"Ver Timelocks",[xe],'p0.value?"Ocultar Timelocks":"Ver Timelocks"')]},1,"3q_1"):d(We,{children:[d(Cl,{class:"h-5 w-5 mr-2",[a]:{class:a}},3,"3q_2")," Conectar Wallet"]},1,"3q_3"),1,"3q_4"),1,null)],1,null),e("div",null,{class:"mt-4 flex flex-wrap gap-3"},[e("input",null,{type:"text",value:m,class:"block w-full sm:w-64 pl-3 pr-3 py-2 border border-slate-200 dark:border-slate-600 rounded-md bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 placeholder-slate-400 shadow-sm hover:border-teal-400 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm transition-all duration-200",placeholder:"Buscar profesional...",onInput$:w("s_vJmrtKGFO3c",[m])},null,3,null),e("select",null,{value:k,class:"block w-full sm:w-auto pl-2 pr-8 py-2 border border-slate-200 dark:border-slate-600 rounded-md bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200",onInput$:w("s_a0YfR8J25OE",[k])},[e("option",null,{value:""},"Mes",3,null),Wt.map(x=>e("option",{value:A(x,"value")},null,x.label,1,x.value))],1,null),e("select",null,{value:L,class:"block w-full sm:w-auto pl-2 pr-8 py-2 border border-slate-200 dark:border-slate-600 rounded-md bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200",onInput$:w("s_mna5SON6m2o",[L])},[e("option",null,{value:""},"Año",3,null),Yt().map(x=>e("option",{value:A(x,"value")},null,x.label,1,x.value))],1,null),e("select",null,{value:f,class:"block w-full sm:w-auto pl-2 pr-8 py-2 border border-slate-200 dark:border-slate-600 rounded-md bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200",onInput$:w("s_VaHxRamqf68",[f])},[e("option",null,{value:""},"Moneda",3,null),e("option",null,{value:"USDC"},"USDC",3,null),e("option",null,{value:"USDT"},"USDT",3,null),e("option",null,{value:"DAI"},"DAI",3,null),e("option",null,{value:"KNRT"},"KNRT",3,null)],3,null),e("select",null,{value:q,class:"block w-full sm:w-auto pl-2 pr-8 py-2 border border-slate-200 dark:border-slate-600 rounded-md bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200",onInput$:w("s_Ek68hxw2Bqk",[q])},[e("option",null,{value:""},"Estado",3,null),e("option",null,{value:"pending"},"Pendiente",3,null),e("option",null,{value:"paid"},"Pagado",3,null)],3,null)],1,null)],1,null),v.address.value&&xe.value&&e("div",null,{class:"mb-8 bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-900/30 dark:to-purple-900/30 rounded-xl shadow-md p-6 border border-indigo-100 dark:border-indigo-800/50"},[e("div",null,{class:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4"},[e("div",null,null,[e("div",null,{class:"flex items-center"},[d(Oe,{class:"h-6 w-6 text-indigo-600 dark:text-indigo-400 mr-2",[a]:{class:a}},3,"3q_5"),e("h2",null,{class:"text-xl font-bold text-slate-800 dark:text-slate-200"},"TimeLock Smart Contract",3,null)],1,null),e("p",null,{class:"text-sm text-slate-600 dark:text-slate-400 mt-1"},["Wallet: ",y(x=>x.address.value,[v],"p0.address.value")],3,null)],1,null),e("div",null,{class:"mt-4 sm:mt-0 space-x-2"},[e("button",{onClick$:v.loadLocks},{class:"inline-flex items-center px-3 py-1.5 rounded-lg bg-indigo-100 hover:bg-indigo-200 dark:bg-indigo-900/50 dark:hover:bg-indigo-800/70 text-indigo-700 dark:text-indigo-300 text-sm transition-all"},[d(kl,{get class(){return`h-4 w-4 mr-1.5 ${v.loadingLocks.value?"animate-spin":""}`},[a]:{class:y(x=>`h-4 w-4 mr-1.5 ${x.loadingLocks.value?"animate-spin":""}`,[v],'`h-4 w-4 mr-1.5 ${p0.loadingLocks.value?"animate-spin":""}`')}},3,"3q_6")," Refrescar"],0,null),e("button",{onClick$:v.performUpkeep},{class:"inline-flex items-center px-3 py-1.5 rounded-lg bg-emerald-100 hover:bg-emerald-200 dark:bg-emerald-900/50 dark:hover:bg-emerald-800/70 text-emerald-700 dark:text-emerald-300 text-sm transition-all"},[d(Ze,{class:"h-4 w-4 mr-1.5",[a]:{class:a}},3,"3q_7")," Ejecutar Pagos"],0,null)],1,null)],1,null),v.error.value&&e("div",null,{class:"mt-2 p-2 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 rounded-lg text-sm"},[d(ae,{class:"inline-block h-4 w-4 mr-1",[a]:{class:a}},3,"3q_8")," ",y(x=>x.error.value,[v],"p0.error.value")],1,"3q_9"),v.status.value&&e("div",null,{class:"mt-2 p-2 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded-lg text-sm"},[d(Ge,{class:"inline-block h-4 w-4 mr-1",[a]:{class:a}},3,"3q_10")," ",y(x=>x.status.value,[v],"p0.status.value")],1,"3q_11"),(()=>{X();const x=b(1),j=b(10),me=[...v.locks.value].slice().reverse(),ue=Math.ceil(me.length/j.value),ge=me.slice((x.value-1)*j.value,x.value*j.value);return e("div",null,{class:"mt-4 overflow-auto rounded-lg border border-slate-200 dark:border-slate-700/50"},[e("table",null,{class:"w-full bg-white dark:bg-slate-800/50 text-left text-sm"},[e("thead",null,{class:"bg-slate-50 dark:bg-slate-700/50"},e("tr",null,null,[e("th",null,{class:"px-4 py-3 text-slate-600 dark:text-slate-300 font-semibold"},"ID",3,null),e("th",null,{class:"px-4 py-3 text-slate-600 dark:text-slate-300 font-semibold"},"Factura",3,null),e("th",null,{class:"px-4 py-3 text-slate-600 dark:text-slate-300 font-semibold"},"Token",3,null),e("th",null,{class:"px-4 py-3 text-slate-600 dark:text-slate-300 font-semibold"},"Monto",3,null),e("th",null,{class:"px-4 py-3 text-slate-600 dark:text-slate-300 font-semibold"},"Fecha Liberación",3,null),e("th",null,{class:"px-4 py-3 text-slate-600 dark:text-slate-300 font-semibold"},"Time Remaining",3,null),e("th",null,{class:"px-4 py-3 text-slate-600 dark:text-slate-300 font-semibold"},"Estado",3,null),e("th",null,{class:"px-4 py-3 text-slate-600 dark:text-slate-300 font-semibold"},"Destinatarios",3,null),e("th",null,{class:"px-4 py-3 text-slate-600 dark:text-slate-300 font-semibold"},"Profesional",3,null),e("th",null,{class:"px-4 py-3 text-slate-600 dark:text-slate-300 font-semibold"},"Email",3,null)],3,null),3,null),e("tbody",null,{class:"divide-y divide-slate-200 dark:divide-slate-700/50"},v.loadingLocks.value?e("tr",null,null,e("td",null,{colSpan:8,class:"px-4 py-6 text-center text-slate-500 dark:text-slate-400"},[d(oe,{class:"animate-spin h-6 w-6 mx-auto mb-2",[a]:{class:a}},3,"3q_12"),"Cargando locks..."],1,null),1,"3q_13"):ge.length===0?e("tr",null,null,e("td",null,{colSpan:8,class:"px-4 py-6 text-center text-slate-500 dark:text-slate-400"},"No hay locks creados aún.",3,null),3,"3q_14"):ge.map(B=>e("tr",null,{class:"hover:bg-slate-50 dark:hover:bg-slate-700/30"},[e("td",null,{class:"px-4 py-3 text-slate-700 dark:text-slate-300"},A(B,"id"),1,null),e("td",null,{class:"px-4 py-3 text-slate-700 dark:text-slate-300"},B.invoiceId!==void 0&&B.invoiceId!==null&&Number(B.invoiceId)!==0?e("span",null,{class:"font-mono"},String(B.invoiceId),1,"3q_15"):e("span",null,{class:"text-slate-400"},"-",3,null),1,null),e("td",null,{class:"px-4 py-3 text-slate-700 dark:text-slate-300"},[B.token.slice(0,6),"...",B.token.slice(-4)],1,null),e("td",null,{class:"px-4 py-3 text-slate-700 dark:text-slate-300"},[(Number(B.totalAmount)/1e18).toFixed(4)," ETH"],1,null),e("td",null,{class:"px-4 py-3 text-slate-700 dark:text-slate-300"},M(B.releaseTime),1,null),e("td",null,{class:"px-4 py-3 text-slate-700 dark:text-slate-300"},(()=>{const de=Math.floor(Date.now()/1e3),se=Number(B.releaseTime)-de;if(B.released)return e("span",null,{class:"text-emerald-600 dark:text-emerald-300"},"-",3,"3q_16");if(se<=0)return e("span",null,{class:"text-amber-600 dark:text-amber-300"},"Ready",3,"3q_17");const J=Math.floor(se/86400),pe=Math.floor(se%86400/3600),Le=Math.floor(se%3600/60),He=se%60;return e("span",null,null,[J>0&&`${J}d `,pe>0&&`${pe}h `,Le>0&&`${Le}m `,He>0&&J===0&&pe===0&&Le===0?`${He}s`:""],1,"3q_18")})(),1,null),e("td",null,{class:"px-4 py-3"},e("span",{class:`px-2 py-1 rounded-full text-xs font-medium ${B.released?"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-300":"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-300"}`},null,B.released?"Liberado":"Pendiente",1,null),1,null),e("td",null,{class:"px-4 py-3 text-slate-700 dark:text-slate-300"},B.recipients.map((de,se)=>e("div",null,{class:"text-xs"},[de.slice(0,6),"...",de.slice(-4)," (",B.amounts[se].toString(),")"],1,se)),1,null),e("td",null,{class:"px-4 py-3 text-slate-700 dark:text-slate-300"},Array.isArray(B.recipients)&&B.recipients.length>0?B.recipients.map((de,se)=>{const J=(r.value.professionals??[]).find(pe=>pe.wallet&&pe.wallet.toLowerCase()===de.toLowerCase());return e("div",null,{class:"text-xs"},J&&typeof J.name=="string"?J.name:String((J==null?void 0:J.name)??"-"),1,se)}):"-",1,null),e("td",null,{class:"px-4 py-3 text-slate-700 dark:text-slate-300"},Array.isArray(B.recipients)&&B.recipients.length>0?B.recipients.map((de,se)=>{const J=(r.value.professionals??[]).find(pe=>pe.wallet&&pe.wallet.toLowerCase()===de.toLowerCase());return e("div",null,{class:"text-xs"},J&&typeof J.email=="string"?J.email:String((J==null?void 0:J.email)??"-"),1,se)}):"-",1,null)],1,B.id)),1,null)],1,null),e("div",null,{class:"flex justify-between items-center py-4 px-2"},[e("span",null,{class:"text-xs text-slate-500 dark:text-slate-400"},["Mostrando página ",y(B=>B.value,[x],"p0.value")," de ",ue],1,null),e("div",null,{class:"flex gap-2"},[e("button",null,{class:"px-3 py-1 rounded bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-200 text-xs font-medium disabled:opacity-50",disabled:y(B=>B.value===1,[x],"p0.value===1"),onClick$:w("s_yEon4XCUfYw",[x])},"Anterior",3,null),e("button",{disabled:x.value>=ue,onClick$:w("s_BTsFleKlXfQ",[x,ue])},{class:"px-3 py-1 rounded bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-200 text-xs font-medium disabled:opacity-50"},"Siguiente",2,null)],1,null)],1,null)],1,"3q_19")})()],1,"3q_20"),e("div",null,{class:"grid gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"},W.value.map(x=>e("div",null,{class:"bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl shadow-md p-5 flex flex-col gap-4 hover:shadow-lg transition-all duration-200"},[e("div",null,{class:"flex items-center gap-3"},[e("div",null,{class:"w-10 h-10 rounded-full bg-teal-100 dark:bg-teal-900 flex items-center justify-center text-teal-700 dark:text-teal-300 font-bold text-lg shrink-0"},x.name[0],1,null),e("div",null,{class:"flex-grow"},[e("div",null,{class:"font-bold text-slate-800 dark:text-slate-100 text-lg"},A(x,"name"),1,null),x.email&&e("div",null,{class:"text-xs text-slate-500 dark:text-slate-400 truncate"},A(x,"email"),1,"3q_21")],1,null),x.wallet&&e("span",{title:A(x,"wallet")},{class:"ml-auto px-2 py-1 text-xs rounded bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 shrink-0"},[x.wallet.slice(0,6),"...",x.wallet.slice(-4)],1,"3q_22")],1,null),e("div",null,null,[e("div",null,{class:"font-semibold text-xs text-slate-500 dark:text-slate-400 mb-1"},"Contratos Activos",3,null),e("div",null,{class:"flex flex-wrap gap-2"},[Q(x.id).length===0&&e("span",null,{class:"text-xs text-slate-400"},"Sin contratos",3,"3q_23"),Q(x.id).map(j=>e("span",{title:j.contract_url??""},{class:"px-2 py-1 rounded bg-slate-100 dark:bg-slate-700 text-xs text-slate-700 dark:text-slate-200"},[e("span",null,{class:"text-green-600 dark:text-green-400 font-semibold"},A(j,"status"),1,null)," ",e("span",null,null,["(",A(j,"start_date")," - ",j.end_date??"Presente",")"],1,null)],1,j.id))],1,null)],1,null),e("div",null,null,[e("div",null,{class:"font-semibold text-xs text-slate-500 dark:text-slate-400 mb-1"},"Facturas",3,null),e("div",null,{class:"flex flex-col gap-2"},[Z(x.id).length===0&&e("span",null,{class:"text-xs text-slate-400"},"Sin facturas",3,"3q_24"),Z(x.id).map(j=>{X();const me=l.value.find(de=>de.facturaId===j.id);let ue,ge,B;return j.status==="paid"?(ue="Pagado",ge="bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300",B=d(Ge,null,3,"3q_25")):me?me.released||(ue="Pendiente",ge="bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300",B=d(ae,null,3,"3q_26")):(ue="Pendiente",ge="bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300",B=d(ae,null,3,"3q_27")),e("div",null,{class:"flex items-center gap-2 bg-slate-50 dark:bg-slate-900/50 rounded-lg px-2 py-1.5"},[e("span",{class:`px-2 py-0.5 rounded text-xs font-semibold text-center min-w-[90px] inline-flex items-center justify-center gap-1 ${ge}`},null,[B," ",ue],1,null),e("span",{title:`Emitida: ${j.issue_date}${j.paid_date?" | Pagada: "+j.paid_date:""}`},{class:"text-xs text-slate-700 dark:text-slate-200 font-mono"},[A(j,"amount")," ",A(j,"currency")],1,null),e("div",null,{class:"ml-auto flex items-center gap-1"},[j.invoice_url?e("a",{href:`/api/invoices/view/${j.invoice_url}`},{target:"_blank",rel:"noopener noreferrer",class:"text-teal-500 hover:text-teal-400 text-sm",title:"Ver factura"},d(he,null,3,"3q_28"),1,"3q_29"):null,o.value.session&&ie(o.value.session)&&e("button",{disabled:ue!=="Pendiente",onClick$:w("s_VW70ImrmQW4",[j,le])},{class:"px-2 py-1 text-xs rounded bg-teal-500 text-white hover:bg-teal-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Automatizar pago"},"Automatizar",2,"3q_30")],1,null)],1,j.id)})],1,null)],1,null),e("div",null,{class:"mt-4 flex justify-end"},e("button",{onClick$:g(un,"s_fJwo6na0UpA",[o,x])},{class:"px-4 py-2 rounded-lg bg-gradient-to-r from-teal-500 to-teal-600 text-white font-medium text-sm shadow-md hover:from-teal-600 hover:to-teal-700 transition-all",title:"Descargar resumen PDF"},"Descargar resumen PDF",2,null),1,null)],1,x.id)),1,null),c.value&&e("div",null,{class:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},e("div",null,{class:"flex items-center justify-center min-h-screen p-4 text-center"},[e("div",null,{class:"fixed inset-0 bg-slate-700/70 dark:bg-slate-900/80 backdrop-blur-sm transition-opacity","aria-hidden":"true",onClick$:re},null,3,null),e("div",null,{class:"inline-block bg-white dark:bg-slate-800 rounded-2xl text-left overflow-hidden shadow-2xl transform transition-all border border-slate-200/50 dark:border-slate-700/50 my-8 sm:max-w-md w-full"},e("div",null,{class:"p-6 sm:p-8"},[e("div",null,{class:"flex items-center gap-4 mb-6"},[e("div",null,{class:"w-12 h-12 rounded-full bg-teal-100 dark:bg-teal-900 flex items-center justify-center text-teal-600 dark:text-teal-300 text-2xl shrink-0"},d(it,null,3,"3q_31"),1,null),e("div",null,null,[e("h2",null,{class:"text-xl font-bold text-slate-800 dark:text-slate-100",id:"modal-title"},"Automatizar pago",3,null),e("p",null,{class:"text-sm text-slate-500 dark:text-slate-400"},"Programar un Timelock para esta factura.",3,null)],3,null)],1,null),e("div",null,{class:"space-y-4"},[e("div",null,null,[e("label",null,{class:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1"},"Token",3,null),e("select",null,{value:_,class:"block w-full border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm py-2 px-3 bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-200 focus:outline-none focus:ring-2 focus:ring-teal-500",onInput$:w("s_ELKq3QjyadY",[_])},[e("option",null,{value:"USDC"},"USDC",3,null),e("option",null,{value:"USDT"},"USDT",3,null),e("option",null,{value:"DAI"},"DAI",3,null),e("option",null,{value:"KNRT"},"KNRT",3,null)],3,null)],3,null),e("div",null,null,[e("label",null,{class:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1"},"Wallet del profesional",3,null),e("input",null,{type:"text",value:E,placeholder:"0x...",class:"block w-full border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm py-2 px-3 bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-200 font-mono focus:outline-none focus:ring-2 focus:ring-teal-500",onInput$:w("s_Se2m5CYvyNk",[E])},null,3,null)],3,null),e("div",null,null,[e("label",null,{class:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1"},"Monto a transferir",3,null),e("input",null,{type:"number",min:"0",step:"any",value:I,class:"block w-full border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm py-2 px-3 bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-200 focus:outline-none focus:ring-2 focus:ring-teal-500",onInput$:w("s_cDv1msy1boU",[I])},null,3,null)],3,null),e("div",null,null,[e("label",null,{class:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1"},"Fecha y Hora de Liberación",3,null),e("div",null,{class:"grid grid-cols-3 gap-2"},[e("input",null,{type:"date",value:D,class:"col-span-3 block w-full border border-slate-300 dark:border-slate-600 rounded-lg py-2 px-3 bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-200 focus:outline-none focus:ring-2 focus:ring-teal-500",onInput$:w("s_jHJwhp2hmjg",[D])},null,3,null),e("select",null,{value:R,class:"block w-full border border-slate-300 dark:border-slate-600 rounded-lg py-2 px-3 bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-200",onInput$:w("s_odul3p2keAc",[R])},[e("option",null,{value:""},"Hora",3,null),Array.from({length:24},(x,j)=>e("option",{value:j},null,j.toString().padStart(2,"0"),1,j))],1,null),e("select",null,{value:N,class:"block w-full border border-slate-300 dark:border-slate-600 rounded-lg py-2 px-3 bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-200",onInput$:w("s_wKPTp48jC2g",[N])},[e("option",null,{value:""},"Min",3,null),e("option",null,{value:"0"},"00",3,null),e("option",null,{value:"15"},"15",3,null),e("option",null,{value:"30"},"30",3,null),e("option",null,{value:"45"},"45",3,null)],3,null)],1,null)],1,null),e("div",null,null,[e("label",null,{class:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1"},"Zona Horaria",3,null),e("select",null,{value:T,class:"block w-full border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm py-2 px-3 bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-200 focus:outline-none focus:ring-2 focus:ring-teal-500",onInput$:w("s_oi2aRktV3SQ",[T])},[e("option",null,{value:"UTC"},"UTC",3,null),e("option",null,{value:"America/Mexico_City"},"America/Mexico_City",3,null),e("option",null,{value:"America/Caracas"},"America/Caracas",3,null),e("option",null,{value:"America/New_York"},"America/New_York",3,null),e("option",null,{value:"Europe/Madrid"},"Europe/Madrid",3,null),e("option",null,{value:"America/Argentina/Buenos_Aires"},"America/Argentina/Buenos_Aires",3,null),e("option",null,{value:"America/Bogota"},"America/Bogota",3,null),e("option",null,{value:"America/Lima"},"America/Lima",3,null),e("option",null,{value:"America/Santiago"},"America/Santiago",3,null)],3,null)],3,null),e("div",null,{class:"mt-2 p-2 bg-slate-100 dark:bg-slate-700/50 rounded-lg text-xs space-y-1"},[e("p",null,{class:"text-slate-600 dark:text-slate-400"},[e("b",null,null,"Actual (UTC):",3,null)," ",$.value.toLocaleString("en-GB",{timeZone:"UTC"})],1,null),e("p",null,{class:"text-slate-600 dark:text-slate-400"},[e("b",null,null,["Liberación (",y(x=>x.value,[T],"p0.value"),"):"],3,null)," ",C.value.toLocaleString("en-GB",{timeZone:T.value})],1,null),e("p",null,{class:"text-slate-600 dark:text-slate-400"},[e("b",null,null,"Liberación (UTC):",3,null)," ",z.value.toLocaleString("en-GB",{timeZone:"UTC"})],1,null)],1,null)],1,null),e("div",null,{class:"mt-8 flex justify-end gap-3"},[e("button",null,{class:"px-5 py-2.5 rounded-lg bg-slate-200 dark:bg-slate-600 text-slate-800 dark:text-slate-100 font-medium hover:bg-slate-300 dark:hover:bg-slate-500 transition-colors",onClick$:re},"Cancelar",3,null),e("button",null,{class:"px-5 py-2.5 rounded-lg bg-gradient-to-r from-teal-500 to-teal-600 text-white font-semibold hover:from-teal-600 hover:to-teal-700 transition-all shadow-md disabled:opacity-50 disabled:cursor-not-allowed",disabled:y((x,j)=>!!x.value||j.status.value==="loading",[h,v],'!!p0.value||p1.status.value==="loading"'),onClick$:G},y(x=>x.status.value==="loading"?"Procesando...":"Automatizar",[v],'p0.status.value==="loading"?"Procesando...":"Automatizar"'),3,null)],3,null),v.status.value&&e("div",null,{class:"mt-4 text-green-700 dark:text-green-300 text-sm font-medium bg-green-50 dark:bg-green-900/30 rounded-lg p-3 text-center"},y(x=>x.status.value,[v],"p0.status.value"),3,"3q_32"),v.error.value&&e("div",null,{class:"mt-4 text-red-700 dark:text-red-300 text-sm font-medium bg-red-50 dark:bg-red-900/30 rounded-lg p-3 text-center"},y(x=>x.error.value,[v],"p0.error.value"),3,"3q_33"),h.value&&e("div",null,{class:"mt-4 text-red-700 dark:text-red-300 text-sm font-medium bg-red-50 dark:bg-red-900/30 rounded-lg p-3 text-center"},[d(ae,{class:"inline-block mr-2",[a]:{class:a}},3,"3q_34")," ",y(x=>x.value,[h],"p0.value")],1,"3q_35")],1,null),1,null)],1,null),1,"3q_36")],1,null),1,"3q_37")},cn=te(g(dn,"s_0ONN1Cu1fDg")),mn=Object.freeze(Object.defineProperty({__proto__:null,_auto_getTokenAddress:qt,_auto_getYears:Yt,_auto_months:Wt,default:cn,useAddSettlement:Ja,useAuthLoader:Ha,useAutomateInvoicePayment:Ht,useDeleteSettlement:tn,useLocksLoader:Ft,usePaymentsLoader:Bt,useSettlementsLoader:zt,useUpdateSettlementStatus:Xa},Symbol.toStringTag,{value:"Module"})),pn=async t=>{const l=await H(t);if(!(l!=null&&l.isAuthenticated)&&!(l!=null&&l.is_admin))throw t.redirect(302,"/auth");return l},Vt=V(g(pn,"s_BLJtw2HBn0Y")),fn=async t=>{const l=F(t);try{return(await l.execute("SELECT id, username, name, role, email, active FROM users ORDER BY name ASC")).rows.map(n=>({...n,active:!!n.active}))}catch(s){return console.error("Error loading users:",s),[]}},Qt=V(g(fn,"s_iX0RZbkDTAw")),xn=async(t,l)=>{var p;const s=await H(l);if(!s.isAuthenticated||!s.is_admin)return{success:!1,error:"Unauthorized"};const n=F(l),{id:r,username:i,name:o,role:u,email:m,password:c}=t;try{if(r){const h=[{key:"username",value:i},{key:"name",value:o},{key:"role",value:u},{key:"email",value:m}];c&&h.push({key:"password_hash",value:c});const v=h.map(T=>`${T.key} = ?`).join(", "),_=h.map(T=>T.value);_.push(String(r)),await n.execute({sql:`UPDATE users SET ${v} WHERE id = ?`,args:_})}else{const h=c;await n.execute({sql:"INSERT INTO users (username, name, role, email, password_hash, active) VALUES (?, ?, ?, ?, ?, ?)",args:[i??"",o??"",u??"viewer",m??"",h??"",!0]})}return{success:!0}}catch(h){return(p=h.message)!=null&&p.includes("UNIQUE constraint failed: users.username")?{success:!1,error:"Username already exists."}:(console.error(h),{success:!1,error:"Failed to save user."})}},gn={id:U.coerce.number().optional(),username:U.string().min(3,"Username must be at least 3 characters."),name:U.string().min(2,"Name is required."),role:U.enum(["admin","manager","viewer"]),email:U.string().email("Invalid email address."),password:U.string().min(8,"Password must be at least 8 characters.").optional().or(U.literal(""))},Gt=Y(g(xn,"s_a0o72IlKDPU"),ne(g(gn,"s_oYjGP9s7ZYM"))),bn=async({id:t,active:l},s)=>{const n=await H(s);if(!(n!=null&&n.is_admin))return{success:!1,error:"Unauthorized"};const r=F(s);try{return await r.execute({sql:"UPDATE users SET active = ? WHERE id = ?",args:[!l,String(t)]}),{success:!0}}catch{return{success:!1,error:"Failed to update status."}}},Zt=Y(g(bn,"s_6EomhBuNxNI")),hn=async({id:t},l)=>{const s=await H(l);if(!(s!=null&&s.is_admin))return{success:!1,error:"Unauthorized"};const n=F(l);try{return await n.execute({sql:"DELETE FROM users WHERE id = ?",args:[String(t)]}),{success:!0}}catch{return{success:!1,error:"Failed to delete user."}}},Jt=Y(g(hn,"s_1r9Y6zzr2R0")),vn=t=>{const[l,s,n,r,i,o,u]=O();t?(s.value=t.id,n.value=t.name,o.value=t.username,l.value=t.email,i.value=t.role,r.value=""):(s.value=void 0,n.value="",o.value="",l.value="",i.value="viewer",r.value=""),u.value=!0},wn=()=>{var s;const[t,l]=O();(s=t.value)!=null&&s.success&&(l.value=!1)},kn=()=>{var _,T,E,I,D,R,N,S,$;X(),Vt();const t=Qt(),l=Gt(),s=Zt(),n=Jt(),r=b(!1),i=b(void 0),o=b(""),u=b(""),m=b(""),c=b("viewer"),p=b(""),h=g(vn,"s_22z0CwgGRjQ",[m,i,o,p,c,u,r]),v=[{value:"admin",label:"Administrator"},{value:"manager",label:"Manager"},{value:"viewer",label:"Viewer"}];return e("main",null,{class:"min-h-screen bg-gradient-to-br from-slate-50 via-slate-100 to-slate-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900"},[e("div",null,{class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},[e("header",null,{class:"mb-8 bg-gradient-to-r from-slate-100 to-slate-50 dark:from-slate-800 dark:to-slate-700 rounded-xl shadow-sm p-6"},e("div",null,{class:"flex flex-col sm:flex-row sm:items-center sm:justify-between"},[e("div",null,{class:"flex items-center"},[d(ve,{class:"h-8 w-8 text-teal-600 dark:text-teal-500 mr-3",[a]:{class:a}},3,"pv_0"),e("div",null,null,[e("h1",null,{class:"text-2xl sm:text-3xl font-bold text-slate-800 dark:text-slate-100"},"User Administration",3,null),e("p",null,{class:"text-slate-500 dark:text-slate-400 mt-1"},"Manage users and their permissions",3,null)],3,null)],1,null),e("button",null,{class:"mt-4 sm:mt-0 inline-flex items-center justify-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-gradient-to-r from-teal-500 to-teal-600 hover:from-teal-600 hover:to-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 transition-all duration-200",onClick$:w("s_97298IyYAwg",[h])},[d(Ae,{class:"mr-2 h-4 w-4",[a]:{class:a}},3,"pv_1"),"Add User"],1,null)],1,null),1,null),e("div",null,{class:"bg-white dark:bg-slate-800 shadow-lg rounded-xl overflow-hidden border border-slate-200 dark:border-slate-700"},e("div",null,{class:"overflow-x-auto"},e("table",null,{class:"min-w-full divide-y divide-slate-200 dark:divide-slate-700"},[e("thead",null,{class:"bg-gradient-to-r from-slate-100 to-slate-50 dark:from-slate-800 dark:to-slate-700"},e("tr",null,null,[e("th",null,{class:"px-6 py-4 text-left text-xs font-medium text-slate-600 dark:text-slate-300 uppercase tracking-wider"},"User",3,null),e("th",null,{class:"px-6 py-4 text-left text-xs font-medium text-slate-600 dark:text-slate-300 uppercase tracking-wider"},"Role",3,null),e("th",null,{class:"px-6 py-4 text-left text-xs font-medium text-slate-600 dark:text-slate-300 uppercase tracking-wider"},"Status",3,null),e("th",null,{class:"px-6 py-4 text-right text-xs font-medium text-slate-600 dark:text-slate-300 uppercase tracking-wider"},"Actions",3,null)],3,null),3,null),e("tbody",null,{class:"bg-white dark:bg-slate-800 divide-y divide-slate-200 dark:divide-slate-700"},t.value.map(C=>X(e("tr",null,{class:"hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-all duration-200 group"},[e("td",null,{class:"px-6 py-4 whitespace-nowrap"},[e("div",null,{class:"text-sm font-medium text-slate-800 dark:text-slate-100"},A(C,"name"),1,null),e("div",null,{class:"text-sm text-slate-500 dark:text-slate-400"},A(C,"email"),1,null)],1,null),e("td",null,{class:"px-6 py-4 whitespace-nowrap text-sm text-slate-600 dark:text-slate-300"},A(C,"role"),1,null),e("td",null,{class:"px-6 py-4 whitespace-nowrap"},e("span",{class:`px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${C.active?"bg-gradient-to-r from-emerald-50 to-emerald-100 text-emerald-700 dark:from-emerald-900/30 dark:to-emerald-800/30 dark:text-emerald-400":"bg-gradient-to-r from-slate-100 to-slate-200 text-slate-600 dark:from-slate-700 dark:to-slate-600 dark:text-slate-300"}`},null,C.active?"Active":"Inactive",1,null),1,null),e("td",null,{class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},e("div",null,{class:"flex justify-end space-x-2"},[e("button",{onClick$:w("s_O4CvBodU74s",[h,C])},{class:"p-1.5 text-slate-600 dark:text-slate-400 hover:text-blue-600 hover:bg-blue-50 dark:hover:text-blue-400 dark:hover:bg-blue-900/20 rounded-full transition-all",title:"Edit User"},d(Pe,{class:"h-5 w-5",[a]:{class:a}},3,"pv_2"),0,null),d(ee,{action:s,children:[e("input",{value:A(C,"id")},{type:"hidden",name:"id"},null,3,null),e("input",{value:C.active?"true":"false"},{type:"hidden",name:"active"},null,3,null),e("button",{class:`p-1.5 rounded-full transition-all ${C.active?"text-slate-600 dark:text-slate-400 hover:text-yellow-600 hover:bg-yellow-50 dark:hover:text-yellow-400 dark:hover:bg-yellow-900/20":"text-slate-600 dark:text-slate-400 hover:text-green-600 hover:bg-green-50 dark:hover:text-green-400 dark:hover:bg-green-900/20"}`,title:C.active?"Deactivate":"Activate"},{type:"submit"},C.active?d(Tl,{class:"h-5 w-5",[a]:{class:a}},3,"pv_3"):d(_l,{class:"h-5 w-5",[a]:{class:a}},3,"pv_4"),1,null)],[a]:{action:a}},1,"pv_5"),d(ee,{action:n,children:[e("input",{value:A(C,"id")},{type:"hidden",name:"id"},null,3,null),e("button",null,{type:"submit",class:"p-1.5 text-slate-600 dark:text-slate-400 hover:text-red-600 hover:bg-red-50 dark:hover:text-red-400 dark:hover:bg-red-900/20 rounded-full transition-all",title:"Delete User"},d(ye,{class:"h-5 w-5",[a]:{class:a}},3,"pv_6"),1,null)],[a]:{action:a}},1,"pv_7")],1,null),1,null)],1,C.id))),1,null)],1,null),1,null),1,null)],1,null),r.value&&e("div",null,{class:"fixed inset-0 z-50 overflow-y-auto"},e("div",null,{class:"flex items-end sm:items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},[e("div",null,{class:"fixed inset-0 bg-slate-700/70 dark:bg-slate-900/80 backdrop-blur-md transition-opacity","aria-hidden":"true",onClick$:w("s_0VJKs3Cj51k",[r])},null,3,null),e("div",null,{class:"inline-block align-bottom bg-white/95 dark:bg-slate-800/95 backdrop-blur-md rounded-xl text-left overflow-hidden shadow-2xl transform transition-all border border-slate-100/50 dark:border-slate-700/50 sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},d(ee,{action:l,onSubmitCompleted$:g(wn,"s_uctbYNgi4OY",[l,r]),children:[e("div",null,{class:"px-6 pt-5 pb-4 sm:p-6 sm:pb-4"},[e("h3",null,{class:"text-xl leading-6 font-medium text-slate-800 dark:text-slate-100"},[y(C=>C.value?"Edit":"Add",[i],'p0.value?"Edit":"Add"')," User"],3,null),e("input",null,{type:"hidden",name:"id",value:y(C=>C.value,[i],"p0.value")},null,3,null),e("div",null,{class:"mt-4 space-y-4"},[e("div",null,{class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},[e("div",null,null,[e("label",null,{for:"name",class:"block text-sm font-medium text-slate-700 dark:text-slate-300"},"Full Name",3,null),e("input",null,{type:"text",name:"name",id:"name",value:o,class:"mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm py-3 px-3 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm",onInput$:w("s_oN0ORdmSBQk",[o])},null,3,null),((T=(_=l.value)==null?void 0:_.fieldErrors)==null?void 0:T.name)&&e("p",null,{class:"text-red-500 text-sm mt-1"},y(C=>C.value.fieldErrors.name,[l],"p0.value.fieldErrors.name"),3,"pv_8")],1,null),e("div",null,null,[e("label",null,{for:"username",class:"block text-sm font-medium text-slate-700 dark:text-slate-300"},"Username",3,null),e("input",null,{type:"text",name:"username",id:"username",value:u,class:"mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm py-3 px-3 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm",onInput$:w("s_s0IUkW8ve40",[u])},null,3,null),((I=(E=l.value)==null?void 0:E.fieldErrors)==null?void 0:I.username)&&e("p",null,{class:"text-red-500 text-sm mt-1"},y(C=>C.value.fieldErrors.username,[l],"p0.value.fieldErrors.username"),3,"pv_9")],1,null)],1,null),e("div",null,null,[e("label",null,{for:"email",class:"block text-sm font-medium text-slate-700 dark:text-slate-300"},"Email",3,null),e("input",null,{type:"email",name:"email",id:"email",value:m,class:"mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm py-3 px-3 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm",onInput$:w("s_n0pakWINAc8",[m])},null,3,null),((R=(D=l.value)==null?void 0:D.fieldErrors)==null?void 0:R.email)&&e("p",null,{class:"text-red-500 text-sm mt-1"},y(C=>C.value.fieldErrors.email,[l],"p0.value.fieldErrors.email"),3,"pv_10")],1,null),e("div",null,{class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},[e("div",null,null,[e("label",null,{for:"role",class:"block text-sm font-medium text-slate-700 dark:text-slate-300"},"Role",3,null),e("select",null,{name:"role",id:"role",value:c,class:"mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm py-3 px-3 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm",onInput$:w("s_dia70tVBw94",[c])},v.map(C=>e("option",{value:A(C,"value")},null,C.label,1,C.value)),1,null)],1,null),e("div",null,null,[e("label",null,{for:"password",class:"block text-sm font-medium text-slate-700 dark:text-slate-300"},"Password",3,null),e("input",null,{type:"password",name:"password",id:"password",value:p,placeholder:y(C=>C.value?"Leave blank to keep current":"",[i],'p0.value?"Leave blank to keep current":""'),class:"mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm py-3 px-3 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm",onInput$:w("s_Xj20SVtNgHs",[p])},null,3,null),((S=(N=l.value)==null?void 0:N.fieldErrors)==null?void 0:S.password)&&e("p",null,{class:"text-red-500 text-sm mt-1"},y(C=>C.value.fieldErrors.password,[l],"p0.value.fieldErrors.password"),3,"pv_11")],1,null)],1,null)],1,null)],1,null),e("div",null,{class:"bg-gradient-to-r from-slate-50 to-slate-100 dark:from-slate-700 dark:to-slate-800 px-6 py-4 sm:flex sm:flex-row-reverse"},[e("button",null,{type:"submit",disabled:y(C=>C.isRunning,[l],"p0.isRunning"),class:"w-full inline-flex justify-center items-center rounded-lg border border-transparent shadow-sm px-5 py-2.5 bg-gradient-to-r from-teal-500 to-teal-600 text-base font-medium text-white hover:from-teal-600 hover:to-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 sm:ml-3 sm:w-auto sm:text-sm transition-all duration-200 disabled:opacity-50"},[l.isRunning?d(oe,{class:"animate-spin h-5 w-5 mr-2",[a]:{class:a}},3,"pv_12"):d(Te,{class:"h-5 w-5 mr-2",[a]:{class:a}},3,"pv_13"),"Save User"],1,null),e("button",null,{type:"button",class:"mt-3 w-full inline-flex justify-center items-center rounded-lg border border-slate-200 dark:border-slate-600 shadow-sm px-5 py-2.5 bg-white dark:bg-slate-800 text-base font-medium text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm transition-all duration-200",onClick$:w("s_iD3Bt7nAzVc",[r])},[d(fe,{class:"h-5 w-5 mr-2",[a]:{class:a}},3,"pv_14"),"Cancel"],1,null)],1,null),(($=l.value)==null?void 0:$.success)===!1&&e("div",null,{class:"p-4 bg-red-100 text-red-800 rounded-b-lg"},[d(ae,{class:"inline h-5 w-5 mr-2",[a]:{class:a}},3,"pv_15"),y(C=>C.value.error,[l],"p0.value.error")],1,"pv_16")],[a]:{action:a,onSubmitCompleted$:a}},1,"pv_17"),1,null)],1,null),1,"pv_18")],1,"pv_19")},yn=te(g(kn,"s_bCkyk2JlVAo")),_n=Object.freeze(Object.defineProperty({__proto__:null,default:yn,useAuthLoader:Vt,useDeleteUser:Jt,useSaveUser:Gt,useToggleUserStatus:Zt,useUsersLoader:Qt},Symbol.toStringTag,{value:"Module"})),Tn=[],Ke=()=>il,K=()=>Nl,Sn=[["/",[K,()=>Hl],"/",["q-Lx7a7v7Z.js","q-X3NpOCi4.js"]],["api/settlements/pdf/",[K,()=>Vl],"/api/settlements/pdf/",["q-Lx7a7v7Z.js"]],["api/contracts/view/[fileName]/",[K,()=>Zl],"/api/contracts/view/[fileName]/",["q-Lx7a7v7Z.js"]],["api/invoices/view/[fileName]/",[K,()=>Xl],"/api/invoices/view/[fileName]/",["q-Lx7a7v7Z.js"]],["api/upload-contract/",[K,()=>ts],"/api/upload-contract/",["q-Lx7a7v7Z.js"]],["api/upload-image/",[K,()=>ss],"/api/upload-image/",["q-Lx7a7v7Z.js"]],["api/upload-invoice/",[K,()=>ns],"/api/upload-invoice/",["q-Lx7a7v7Z.js"]],["auth/logout/",[K,Ke,()=>ds],"/auth/logout/",["q-Lx7a7v7Z.js","q-DEdXx7jt.js","q-B84PIur3.js"]],["auth/",[K,Ke,()=>ys],"/auth/",["q-Lx7a7v7Z.js","q-DEdXx7jt.js","q-DC6mpsYv.js"]],["contracts/",[K,()=>Us],"/contracts/",["q-Lx7a7v7Z.js","q-B-nsmmq0.js"]],["invoices/",[K,()=>ea],"/invoices/",["q-Lx7a7v7Z.js","q-DwOyYmCF.js"]],["planner/",[K,()=>da],"/planner/",["q-Lx7a7v7Z.js","q-BBIWpWkx.js"]],["professionals/",[K,()=>Da],"/professionals/",["q-Lx7a7v7Z.js","q-0Nl6v67A.js"]],["settings/",[K,()=>Pa],"/settings/",["q-Lx7a7v7Z.js","q-CnqzC-d9.js"]],["settlements/",[K,()=>mn],"/settlements/",["q-Lx7a7v7Z.js","q-DiPtcX4W.js"]],["user-admin/",[K,()=>_n],"/user-admin/",["q-Lx7a7v7Z.js","q-3wyGEI9V.js"]]],En=[],Cn=!0,Dn="/",Rn=!0,Bn={routes:Sn,serverPlugins:Tn,menus:En,trailingSlash:Cn,basePathname:Dn,cacheModules:Rn};export{Dn as basePathname,Rn as cacheModules,Bn as default,En as menus,Sn as routes,Tn as serverPlugins,Cn as trailingSlash};
